<html data-reactroot=""><head><title>viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><h1 id="custom-viewers">Custom Viewers</h1></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do</a></p>
</li>
<li>
<p><a href="#examples">Examples</a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer</a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer</a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors</a></p>
<ul>
<li><a href="#runtime">Runtime</a></li>
<li><a href="#import">Import</a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype</a></p>
</li>
</ul></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="8:32-102"><cell startpos="5:1-40" endpos="8:32-102"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></cell></section>
<section depth="2" class="" startpos="10:1-104" endpos="43:4-492"><cell startpos="10:1-104" endpos="10:12-115"><h2 id="examples">Examples</h2></cell><section depth="3" class="" startpos="12:1-117" endpos="43:4-492"><cell startpos="12:1-117" endpos="12:32-148"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></cell><cell startpos="14:1-150" endpos="18:4-269" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({value}, {React}) =&gt; {
  return `${value} Foooooo! React: ${!!React}`
}
</code></pre></codecell></cell><cell startpos="21:1-272" endpos="21:30-301"><p>Not used in the default case:</p></cell><cell startpos="23:1-303" endpos="25:4-317" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Bar
</code></pre></codecell></cell><cell startpos="27:1-319" endpos="27:41-359"><p>Only when using the <code>!inline</code> directive:</p></cell><cell startpos="29:1-361" endpos="31:4-383" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="foo">Baz
</code></pre></codecell></cell><cell startpos="33:1-385" endpos="33:38-422"><p>or <code>viewer=xxx</code> attribute is present:</p></cell><cell startpos="35:1-424" endpos="37:4-449" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Quz
</code></pre></codecell></cell><cell startpos="39:1-451" endpos="39:25-475"><p>or it is an output cell:</p></cell><cell startpos="41:1-477" endpos="43:4-492" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><output><pre><code class="foo">Qux
</code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="45:1-494" endpos="56:4-776"><cell startpos="45:1-494" endpos="45:27-520"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></cell><cell startpos="47:1-522" endpos="52:4-682" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = (node,{React}) =&gt; {
  const view = React.createElement(&#x27;pre&#x27;, null, JSON.stringify(node,null,2))
  return view
}
</code></pre></codecell></cell><cell startpos="54:1-684" endpos="56:4-776" class="code"><codecell class="local"><span class="meta"><span class="lang">txt</span><span class="filename">file.txt</span><ul class="tags"><li><span class="tag">example</span></li></ul><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="txt">show meta content instead
</code></pre></codecell></cell></section>
<section depth="3" class="" startpos="58:1-778" endpos="125:77-2597"><cell startpos="58:1-778" endpos="60:39-845"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>ToDo: convert to a generalised viewer.</p></cell><cell startpos="62:1-847" endpos="109:4-2363" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = (node, {React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
    //fetch(&#x27;/manifest.json&#x27;).then(res =&gt; res.json()).then(data =&gt; {
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; n.backlinks ? n.backlinks.length : 1)
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
        const { nodes, links } = Graph.graphData()
        const node = nodes.filter( n =&gt; n.id === thisfile)[0]
        Graph.centerAt(node.x, node.y, 1000);
        Graph.zoom(2, 1000);
        // Graph.zoomToFit(1000, 2, (node) =&gt; node.id === thisfile)
        }, 2000)

    //});
  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></cell><cell startpos="111:1-2365" endpos="120:4-2478" class="code"><codecell class="local"><span class="meta"><span class="lang">graph</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="graph">{
&quot;nodes&quot;:[
{&quot;id&quot;: &quot;foo&quot;},
{&quot;id&quot;: &quot;bar&quot;}
],
&quot;links&quot;: [
{&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
]}
</code></pre></codecell></cell><cell startpos="122:1-2480" endpos="123:4-2519" class="code"><codecell class="local"><span class="meta"><span class="lang">graph</span><span class="source">&lt; ../manifest.json</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="graph"></code></pre></codecell></cell><cell startpos="125:1-2521" endpos="125:77-2597"><p>The above automatically fetches manifest and focuses on the current document</p></cell></section>
<section depth="2" class="" startpos="127:1-2599" endpos="136:140-2876"><cell startpos="127:1-2599" endpos="127:10-2608"><h2 id="errors">Errors</h2></cell><section depth="3" class="" startpos="129:1-2610" endpos="136:140-2876"><cell startpos="129:1-2610" endpos="129:12-2621"><h3 id="runtime">Runtime</h3></cell><cell startpos="131:1-2623" endpos="135:4-2736" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = (node) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></cell><cell startpos="136:1-2737" endpos="136:140-2876"><p>The above viewer breaks the document render, destroying the page, but therefore use of it is not persisted. Consider adding <code>ErrorBoundry</code>.</p></cell></section></section>
<section depth="3" class="" startpos="138:1-2878" endpos="145:4-3019"><cell startpos="138:1-2878" endpos="138:11-2888"><h3 id="import">Import</h3></cell><cell startpos="140:1-2890" endpos="145:4-3019" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = (node) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></cell></section>
<section depth="2" class="" startpos="147:1-3021" endpos="170:4-3457"><cell startpos="147:1-3021" endpos="147:21-3041"><h2 id="initial-prototype">Initial prototype</h2></cell><cell startpos="149:1-3043" endpos="170:4-3457" class="code"><codecell class="local"><span class="meta"><span class="lang">html</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       alert(&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></codecell></cell></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="Statch Pad" href="/scratch_pad.html">Statch Pad</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>