<html data-reactroot=""><head><title>viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><h1 id="custom-viewers">Custom Viewers</h1></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do</a></p>
</li>
<li>
<p><a href="#examples">Examples</a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer</a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer</a></li>
<li><a href="#example-vega">Example: Vega</a></li>
<li><a href="#example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</a></li>
<li><a href="#example-plantuml-viewer">Example: Plant<code>UML</code> viewer</a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors</a></p>
<ul>
<li><a href="#runtime">Runtime</a></li>
<li><a href="#import">Import</a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype</a></p>
</li>
</ul></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="8:32-102"><cell startpos="5:1-40" endpos="8:32-102"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></cell></section>
<section depth="2" class="" startpos="10:1-104" endpos="43:4-494"><cell startpos="10:1-104" endpos="10:12-115"><h2 id="examples">Examples</h2></cell><section depth="3" class="" startpos="12:1-117" endpos="43:4-494"><cell startpos="12:1-117" endpos="12:32-148"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></cell><cell startpos="14:1-150" endpos="18:4-271" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  return `${node.value} Foooooo! React: ${!!React}`
}
</code></pre></codecell></cell><cell startpos="21:1-274" endpos="21:30-303"><p>Not used in the default case:</p></cell><cell startpos="23:1-305" endpos="25:4-319" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Bar
</code></pre></codecell></cell><cell startpos="27:1-321" endpos="27:41-361"><p>Only when using the <code>!inline</code> directive:</p></cell><cell startpos="29:1-363" endpos="31:4-385" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="foo">Baz
</code></pre></codecell></cell><cell startpos="33:1-387" endpos="33:38-424"><p>or <code>viewer=xxx</code> attribute is present:</p></cell><cell startpos="35:1-426" endpos="37:4-451" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Quz
</code></pre></codecell></cell><cell startpos="39:1-453" endpos="39:25-477"><p>or it is an output cell:</p></cell><cell startpos="41:1-479" endpos="43:4-494" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><output><pre><code class="foo">Qux
</code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="45:1-496" endpos="56:4-778"><cell startpos="45:1-496" endpos="45:27-522"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></cell><cell startpos="47:1-524" endpos="52:4-684" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node,React}) =&gt; {
  const view = React.createElement(&#x27;pre&#x27;, null, JSON.stringify(node,null,2))
  return view
}
</code></pre></codecell></cell><cell startpos="54:1-686" endpos="56:4-778" class="code"><codecell class="local"><span class="meta"><span class="lang">txt</span><span class="filename">file.txt</span><ul class="tags"><li><span class="tag">example</span></li></ul><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="txt">show meta content instead
</code></pre></codecell></cell></section>
<section depth="3" class="" startpos="58:1-780" endpos="124:92-2588"><cell startpos="58:1-780" endpos="60:73-881"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>âœ… This viewer has been folded into <code>.lit</code> as one of the default viewers.</p></cell><cell startpos="62:1-883" endpos="107:4-2304" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></cell><cell startpos="109:1-2306" endpos="119:4-2447" class="code"><codecell class="local"><span class="meta"><span class="lang">custom-graph</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="custom-graph">{
  &quot;nodes&quot;:[
    {&quot;id&quot;: &quot;foo&quot;},
    {&quot;id&quot;: &quot;bar&quot;}
  ],
  &quot;links&quot;: [
    {&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
  ]
}
</code></pre></codecell></cell><cell startpos="121:1-2449" endpos="122:4-2495" class="code"><codecell class="local"><span class="meta"><span class="lang">custom-graph</span><span class="source">&lt; ../manifest.json</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="custom-graph"></code></pre></codecell></cell><cell startpos="124:1-2497" endpos="124:92-2588"><p>The above automatically transcludes the <code>.lit</code> manifest and focuses on the current document</p></cell></section>
<section depth="3" class="" startpos="126:1-2590" endpos="170:4-3788"><cell startpos="126:1-2590" endpos="129:71-2707"><h3 id="example-vega">Example: Vega</h3><p>Still a <em>Work in progress</em>
Docs: <a href="https://vega.github.io/vega-lite/usage/compile.html">vega-lite</a></p></cell><cell startpos="131:1-2709" endpos="170:4-3788" class="code"><codecell class="local"><span class="meta"><span class="lang">iframe</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Embedding Vega-Lite&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega@5.19.1&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.0.0&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.15.1&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;vis&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      var yourVlSpec = {
        $schema: &#x27;https://vega.github.io/schema/vega-lite/v5.json&#x27;,
        description: &#x27;A simple bar chart with embedded data.&#x27;,
        data: {
          values: [
            {a: &#x27;A&#x27;, b: 28},
            {a: &#x27;B&#x27;, b: 55},
            {a: &#x27;C&#x27;, b: 43},
            {a: &#x27;D&#x27;, b: 91},
            {a: &#x27;E&#x27;, b: 81},
            {a: &#x27;F&#x27;, b: 53},
            {a: &#x27;G&#x27;, b: 19},
            {a: &#x27;H&#x27;, b: 87},
            {a: &#x27;I&#x27;, b: 52}
          ]
        },
        mark: &#x27;bar&#x27;,
        encoding: {
          x: {field: &#x27;a&#x27;, type: &#x27;ordinal&#x27;},
          y: {field: &#x27;b&#x27;, type: &#x27;quantitative&#x27;}
        }
      };
      vegaEmbed(&#x27;#vis&#x27;, yourVlSpec);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></cell></section>
<section depth="3" class="" startpos="172:1-3790" endpos="229:95-5029"><cell startpos="172:1-3790" endpos="174:53-3881"><h3 id="example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</h3><p>Docs: <a href="https://github.com/magjac/d3-graphviz#examples">https://github.com/magjac/d3-graphviz#examples</a></p></cell><cell startpos="176:1-3883" endpos="194:4-4436" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;${node.value.trim()}&#x27;);

&lt;/script&gt;`})
   return el
}
</code></pre></codecell></cell><cell startpos="196:1-4438" endpos="198:4-4469" class="code"><codecell class="local"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot">digraph  { a -&gt; b }
</code></pre></output></codecell></cell><cell startpos="200:1-4471" endpos="227:4-4933" class="code"><codecell class="local"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot">digraph Q {

  node [shape=record];


  nd_1   [label = &quot;Node 1&quot;];
  nd_2   [label = &quot;Node 2&quot;];
  nd_3_a [label = &quot;Above Right Node 3&quot;];
  nd_3_l [label = &quot;Left of Node 3&quot;];
  nd_3   [label = &quot;Node 3&quot;];
  nd_3_r [label = &quot;Right of Node 3&quot;];
  nd_4   [label = &quot;Node 4&quot;];


  nd_3_a -&gt; nd_3_r;
  nd_1 -&gt; nd_2 -&gt; nd_3 -&gt; nd_4;

  subgraph cluster_R {

    {rank=same nd_3_l nd_3 nd_3_r}

    nd_3_l -&gt; nd_3 -&gt; nd_3_r [color=grey arrowhead=none];

  }

}
</code></pre></output></codecell></cell><cell startpos="229:1-4935" endpos="229:95-5029"><p>The above mildly more complex example doesn&#x27;t render, likely due to not being actual graphviz.</p></cell></section>
<section depth="3" class="" startpos="231:1-5031" endpos="323:4-7698"><cell startpos="231:1-5031" endpos="231:31-5061"><h3 id="example-plantuml-viewer">Example: Plant<code>UML</code> viewer</h3></cell><cell startpos="233:1-5063" endpos="299:4-7211" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const ref = React.createRef();
   const [height, setHeight] = React.useState(null)
   let [id] = React.useState(Math.round(Math.random() * 10000000).toString())

  React.useEffect(() =&gt; {
    const handler = event =&gt; {
      if (ref &amp;&amp; ref.current &amp;&amp; event &amp;&amp; event.data &amp;&amp; typeof event.data === &#x27;string&#x27;) {
          const data = JSON.parse(event.data)
          if (id === data.source) {
             console.log(&quot;Message: &quot;, data)
             setHeight(data.height)
          }

      }
    }

    window.addEventListener(&quot;message&quot;, handler)

    // clean up
    return () =&gt; window.removeEventListener(&quot;message&quot;, handler)
  }, []) // empty array =&gt; run only once

   const el = c(&#x27;iframe&#x27;, {ref: ref, style: {height: ( height ? (height + &#x27;px&#x27;) : &#x27;auto&#x27;) },srcDoc: `&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;${id}&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;${node.value.replace(/\n/g, &#x27;\\n&#x27;)}&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;`})
   console.log(&quot;PlantViewer iframe ref:&quot;, el.ref.current)
   return el
}
</code></pre></codecell></cell><cell startpos="301:1-7213" endpos="303:4-7235" class="code"><codecell class="local"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">[A] -&gt; [B]
</code></pre></output></codecell></cell><cell startpos="305:1-7237" endpos="323:4-7698" class="code"><codecell class="local"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">@startuml
participant participant as Foo
actor       actor       as Foo1
boundary    boundary    as Foo2
control     control     as Foo3
entity      entity      as Foo4
database    database    as Foo5
collections collections as Foo6
queue       queue       as Foo7
Foo -&gt; Foo1 : To actor 
Foo -&gt; Foo2 : To boundary
Foo -&gt; Foo3 : To control
Foo -&gt; Foo4 : To entity
Foo -&gt; Foo5 : To database
Foo -&gt; Foo6 : To collections
Foo -&gt; Foo7 : To queue
@enduml
</code></pre></output></codecell></cell></section>
<section depth="2" class="" startpos="325:1-7700" endpos="335:4-7857"><cell startpos="325:1-7700" endpos="325:10-7709"><h2 id="errors">Errors</h2></cell><section depth="3" class="" startpos="327:1-7711" endpos="335:4-7857"><cell startpos="327:1-7711" endpos="327:12-7722"><h3 id="runtime">Runtime</h3></cell><cell startpos="329:1-7724" endpos="333:4-7839" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></cell><cell startpos="334:1-7840" endpos="335:4-7857" class="code"><codecell class="local"><span class="meta"><span class="lang">testerror</span></span><output><pre><code class="testerror"></code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="337:1-7859" endpos="344:4-8002"><cell startpos="337:1-7859" endpos="337:11-7869"><h3 id="import">Import</h3></cell><cell startpos="339:1-7871" endpos="344:4-8002" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = ({node}) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></cell></section>
<section depth="2" class="" startpos="346:1-8004" endpos="369:4-8440"><cell startpos="346:1-8004" endpos="346:21-8024"><h2 id="initial-prototype">Initial prototype</h2></cell><cell startpos="348:1-8026" endpos="369:4-8440" class="code"><codecell class="local"><span class="meta"><span class="lang">html</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       alert(&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></codecell></cell></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="Statch Pad" href="/scratch_pad.html">Statch Pad</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>