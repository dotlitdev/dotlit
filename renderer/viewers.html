<html data-reactroot=""><head><title>Custom Viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu><div class="lit-messages"><div class="lit-message"><span class="message">Plugin Error (unknown): Cannot find module &#x27;https://cdn.skypack.dev/react-diff-viewer&#x27;
Require stack:
- </span><span class="name">196:1-250:4</span></div></div></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><div class="cell-content"><h1 id="custom-viewers">Custom Viewers</h1></div></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><div class="cell-content"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do<span class="linkIcon">§</span></a></p>
</li>
<li>
<p><a href="#examples">Examples<span class="linkIcon">§</span></a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-react-viewer">Example: React viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-css-viewer">Example: <code>css</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-md-viewer">Example: <code>md</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-katex-viewer">Example: <code>KaTeX</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-diff-viewer">Example: <code>diff</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-vega">Example: Vega<span class="linkIcon">§</span></a></li>
<li><a href="#example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-plantuml-viewer">Example: Plant<code>UML</code> viewer<span class="linkIcon">§</span></a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors<span class="linkIcon">§</span></a></p>
<ul>
<li><a href="#runtime">Runtime<span class="linkIcon">§</span></a></li>
<li><a href="#import">Import<span class="linkIcon">§</span></a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype<span class="linkIcon">§</span></a></p>
</li>
<li>
<p><a href="#experiments">Experiments<span class="linkIcon">§</span></a></p>
</li>
</ul></div></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="9:31-126"><cell startpos="5:1-40" endpos="9:31-126"><div class="cell-content"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Doppelgänger page?</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></div></cell></section>
<section depth="2" class="" startpos="11:1-128" endpos="48:4-499"><cell startpos="11:1-128" endpos="11:12-139"><div class="cell-content"><h2 id="examples">Examples</h2></div></cell><section depth="3" class="" startpos="13:1-141" endpos="48:4-499"><cell startpos="13:1-141" endpos="13:32-172"><div class="cell-content"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></div></cell><cell startpos="15:1-174" endpos="19:4-270" class="code"><div class="cell-content"><codecell class="dir-plugin lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=foo</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  return `${node.value} Foooooo!`
}
</code></pre></codecell></div></cell><cell startpos="22:1-273" endpos="22:30-302"><div class="cell-content"><p>Not used in the default case:</p></div></cell><cell startpos="24:1-304" endpos="26:4-318" class="code"><div class="cell-content"><codecell class="lang-foo local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Bar
</code></pre></codecell></div></cell><cell startpos="28:1-320" endpos="28:41-360"><div class="cell-content"><p>Only when using the <code>!inline</code> directive:</p></div></cell><cell startpos="30:1-362" endpos="32:4-386" class="code"><div class="cell-content"><codecell class="dir-inline lang-foo local"><span class="meta"><span class="lang">foo</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span>Baz 1
 Foooooo!</codecell></div></cell><cell startpos="38:1-392" endpos="38:38-429"><div class="cell-content"><p>or <code>viewer=xxx</code> attribute is present:</p></div></cell><cell startpos="40:1-431" endpos="42:4-456" class="code"><div class="cell-content"><codecell class="lang-bar local"><span class="meta"><span class="lang">bar</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=foo</span></span>Quz
 Foooooo!</codecell></div></cell><cell startpos="44:1-458" endpos="44:25-482"><div class="cell-content"><p>or it is an output cell:</p></div></cell><cell startpos="46:1-484" endpos="48:4-499" class="code output"><div class="cell-content"><codecell class="lang-foo local output"><span class="meta"><span class="lang">foo</span></span>Qux
 Foooooo!</codecell></div></cell></section></section>
<section depth="3" class="" startpos="51:1-502" endpos="73:4-1017"><cell startpos="51:1-502" endpos="51:26-527"><div class="cell-content"><h3 id="example-react-viewer">Example: React viewer</h3></div></cell><cell startpos="53:1-529" endpos="69:4-981" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=bar</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [content, setContent] = useState(&#x27;Loading...&#x27;)
  const src = node.data.value
  useEffect(()=&gt;{
    setContent(&quot;Loaded. &quot; + node.data.value)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;custom-react-view&#x27;,
  }, content)
}
</code></pre></codecell></div></cell><cell startpos="71:1-983" endpos="73:4-1017" class="code"><div class="cell-content"><codecell class="dir-below lang-bar local"><span class="meta"><span class="lang">bar</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="bar">Custom Content 3
</code></pre><div class="custom-react-view">Loading...</div></codecell></div></cell></section>
<section depth="3" class="" startpos="75:1-1019" endpos="109:4-1809"><cell startpos="75:1-1019" endpos="75:26-1044"><div class="cell-content"><h3 id="example-css-viewer">Example: <code>css</code> viewer</h3></div></cell><cell startpos="77:1-1046" endpos="96:4-1429" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=css</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const meta = node.properties 
               &amp;&amp; node.properties.meta

  const link = meta &amp;&amp; meta.uri

  if (link) return rc(&#x27;link&#x27;, {
    rel: &#x27;stylesheet&#x27;,
    href: link
  })

  return rc(&#x27;style&#x27;, {
    dangerouslySetInnerHTML: {
      __html: node.value
    }
  })
}
</code></pre></codecell></div></cell><cell startpos="98:1-1431" endpos="103:4-1509" class="code output"><div class="cell-content"><codecell class="dir-below lang-css local output"><span class="meta"><span class="lang">css</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="css">#lit-header {
  color: purple;
  font-family: sans-serif;
}
</code></pre><style>#lit-header {
  color: purple;
  font-family: sans-serif;
}
</style></codecell></div></cell><cell startpos="105:1-1511" endpos="106:4-1629" class="code"><div class="cell-content"><codecell class="dir-inline dir-hidemeta lang-css local"><span class="meta"><span class="lang">css</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#964f82" class="directive dir-hidemeta">hidemeta</span></span><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/solarized-light.min.css"/></codecell></div></cell><cell startpos="107:1-1630" endpos="109:4-1809" class="code output"><div class="cell-content"><codecell class="dir-inline dir-info lang-md local output"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#03164a" class="directive dir-info">info</span></span><div class="md-block dir-inline dir-info">
<p>👀 There is an invisible <code>css</code> cell (using <code>!inline</code> and <code>!hidemeta</code> directives) above which pulls a new solarised light highlight.js theme into the page.</p>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="111:1-1811" endpos="151:4-2263"><cell startpos="111:1-1811" endpos="113:92-1928"><div class="cell-content"><h3 id="example-md-viewer">Example: <code>md</code> viewer</h3><p>Less of an example but rather a work in progress before moving it into <code>.lit</code> as a default.</p></div></cell><cell startpos="115:1-1930" endpos="117:4-1988" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=md</span><span class="source">&lt; viewers/md/index.jsx</span></span><pre><code class="js">export const viewer = ({children,node, React}) =&gt; {

  const ch = children
  const chc = ch[0].props.children
  const rc = React.createElement
  const np = node.properties

  const meta = np &amp;&amp; np.meta
  const dirs = meta &amp;&amp; meta.directives
  const tags = meta &amp;&amp; meta.tags
  
  const dc = dirs &amp;&amp; dirs.map(d=&gt;&#x27;dir-&#x27;+d)
  const tc = tags &amp;&amp; tags.map(t=&gt;&#x27;tag-&#x27;+t)

  const classes = [&#x27;md-block&#x27;]
  const add = arr =&gt; arr.forEach( c =&gt; { 
                        classes.push(c)
                     })
  if (dc) add(dc)
  if (tc) add(tc)

  const className = classes
                    .filter(x=&gt;x)
                    .join(&#x27; &#x27;)
                    .trim()

  return rc(&#x27;div&#x27;, {className}, chc)
}

</code></pre></codecell></div></cell><cell startpos="123:1-1994" endpos="125:4-2037" class="code"><div class="cell-content"><codecell class="dir-below lang-md local"><span class="meta"><span class="lang">md</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="md">*Markdown* Viewer **DONE**
</code></pre><div class="md-block dir-below">
<p><em>Markdown</em> Viewer <strong>DONE</strong></p>
</div></codecell></div></cell><cell startpos="127:1-2039" endpos="129:4-2077" class="code output"><div class="cell-content"><codecell class="lang-md local output"><span class="meta"><span class="lang">md</span></span><div class="md-block">
<p><em>Markdown</em> Viewer <strong>FIXED</strong></p>
</div></codecell></div></cell><cell startpos="141:1-2089" endpos="145:4-2206" class="code"><div class="cell-content"><codecell class="dir-success lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#90b540" class="directive dir-success">success</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=md</span></span><div class="md-block dir-success">
<p><strong>✅ Admonitions</strong></p>
<p>See <a href="renderer/viewers/md/admonitions.html?file=renderer/viewers/md/admonitions.lit" title="renderer/viewers/md/admonitions" wikilink="true">renderer/viewers/md/admonitions</a> for more examples and usages.</p>
</div></codecell></div></cell><cell startpos="147:1-2208" endpos="151:4-2263" class="code"><div class="cell-content"><codecell class="dir-inline lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><div class="md-block dir-inline">
<codecell class="local"><pre><code class="plaintext"></code></pre></codecell>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="153:1-2265" endpos="174:4-3496"><cell startpos="153:1-2265" endpos="153:28-2292"><div class="cell-content"><h3 id="example-katex-viewer">Example: <code>KaTeX</code> viewer</h3></div></cell><cell startpos="155:1-2294" endpos="174:4-3496" class="code"><div class="cell-content"><codecell class="dir-inline lang-html local"><span class="meta"><span class="lang">html</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=iframe</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;!-- KaTeX requires the use of the HTML5 doctype. Without it, KaTeX may not render properly --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css&quot; integrity=&quot;sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5&quot; crossorigin=&quot;anonymous&quot;&gt;

    &lt;!-- The loading of KaTeX is deferred to speed up page rendering --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js&quot; integrity=&quot;sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

    &lt;!-- To automatically render math in text elements, include the auto-render extension: --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl&quot; crossorigin=&quot;anonymous&quot;
        onload=&quot;katex.render(document.body.innerHTML, document.body,{throwOnError: false});&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;% \f is defined as #1f(#2) using the macro
\f\relax{x} = \int_{-\infty}^\infty
    \f\hat\xi\,e^{2 \pi i \xi x}
    \,d\xi&lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="177:1-3499" endpos="188:4-3776"><cell startpos="177:1-3499" endpos="177:27-3525"><div class="cell-content"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></div></cell><cell startpos="178:1-3526" endpos="182:4-3707" class="code output"><div class="cell-content"><codecell class="dir-plugin lang-js local output"><a name="viewers/meta.js"></a><span class="meta"><span class="lang">js</span><span class="filename">viewers/meta.js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=meta</span></span><output><pre><code class="js">export const viewer = ({node,React, lit}) =&gt; {
  return React.createElement(&#x27;pre&#x27;, {style: {color: &#x27;black&#x27;}}, lit?.utils?.inspect(node))
}
</code></pre></output></codecell></div></cell><cell startpos="186:1-3711" endpos="188:4-3776" class="code"><div class="cell-content"><codecell class="dir-below lang-txt local"><span class="meta"><span class="lang">txt</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=meta</span><span class="source">&lt; file.txt</span></span><pre><code class="txt"></code></pre><pre style="color:black"></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="190:1-3778" endpos="257:4-5356"><cell startpos="190:1-3778" endpos="194:51-3937"><div class="cell-content"><h3 id="example-diff-viewer">Example: <code>diff</code> viewer</h3><p>v1 <code>https://cdn.skypack.dev/diff</code> didn&#x27;t work (via skyPack) but added to utils.</p><p>v2 <code>https://github.com/praneshr/react-diff-viewer</code></p></div></cell><cell startpos="196:1-3939" endpos="250:4-5103" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=diff</span></span><pre><code class="js">import diff from &#x27;https://cdn.skypack.dev/react-diff-viewer&#x27;
export const viewer = ({node,React}) =&gt; {
  const rc = React.createElement
 const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [content, setContent] = useState(&#x27;Loading...&#x27;)
  const src = node.data.value
  useEffect(async () =&gt; {

  const styles = {
    lineNumber: {
      fontWeight: &#x27;bold&#x27;
    },
    gutter: {
      minWidth: &#x27;0.6em&#x27;,
      padding: &#x27;0 0.2em&#x27;,
    },
    marker: {
      width: &#x27;auto&#x27;,
      padding: &#x27;0 0.2em&#x27;
    },
    contentText: {
      lineHeight: &#x27;1em !important&#x27;,
      wordBreak: &#x27;break-all&#x27;,
    },
    content: {
      width: &#x27;auto&#x27;,
      padding: 0,
    }
  }

  const view = rc(diff, {
    newValue: node.properties.data.originalSource,
    rightTitle: &#x27;local&#x27;,
    oldValue: src,
    leftTitle: &#x27;remote&#x27;,
    splitView: meta &amp;&amp; meta.split === &#x27;true&#x27;,
    styles,
    compareMethod: diff[(meta &amp;&amp; meta.method &amp;&amp; meta.method.toUpperCase()) || &#x27;CHARS&#x27;]
  })


    setContent(view)
  },[src])

  

  return rc(&#x27;div&#x27;, {
    className: &#x27;custom-diff-view&#x27;,
  }, content)

}
</code></pre></codecell></div></cell><cell startpos="251:1-5104" endpos="257:4-5356" class="code"><div class="cell-content"><codecell class="dir-inline lang-diff local"><span class="meta"><span class="lang">diff</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="source">&lt; difftestA.txt</span></span><pre><code class="diff">Custom Content as an initial value
for testing diff viewer
initially created as a txt file output
plan to flip to transclude and modify cell
giving a node with data.value and data.properties.data.originalSource 
</code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="259:1-5358" endpos="325:92-7176"><cell startpos="259:1-5358" endpos="261:73-5459"><div class="cell-content"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>✅ This viewer has been folded into <code>.lit</code> as one of the default viewers.</p></div></cell><cell startpos="263:1-5461" endpos="308:4-6892" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=custom-graph</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="310:1-6894" endpos="320:4-7035" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><iframe srcDoc="&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = {
  &quot;nodes&quot;:[
    {&quot;id&quot;: &quot;foo&quot;},
    {&quot;id&quot;: &quot;bar&quot;}
  ],
  &quot;links&quot;: [
    {&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
  ]
}
;
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;"></iframe></codecell></div></cell><cell startpos="322:1-7037" endpos="323:4-7083" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="source">&lt; ../manifest.json</span></span><iframe srcDoc="&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = undefined;
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;"></iframe></codecell></div></cell><cell startpos="325:1-7085" endpos="325:92-7176"><div class="cell-content"><p>The above automatically transcludes the <code>.lit</code> manifest and focuses on the current document</p></div></cell></section>
<section depth="3" class="" startpos="327:1-7178" endpos="371:4-8389"><cell startpos="327:1-7178" endpos="330:71-7295"><div class="cell-content"><h3 id="example-vega">Example: Vega</h3><p>Still a <em>Work in progress</em>
Docs: <a href="https://vega.github.io/vega-lite/usage/compile.html">vega-lite<span class="linkIcon">↗</span></a></p></div></cell><cell startpos="332:1-7297" endpos="371:4-8389" class="code output"><div class="cell-content"><codecell class="lang-iframe local output"><span class="meta"><span class="lang">iframe</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Embedding Vega-Lite&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega@5.19.1&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.0.0&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.15.1&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;vis&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      var yourVlSpec = {
        $schema: &#x27;https://vega.github.io/schema/vega-lite/v5.json&#x27;,
        description: &#x27;A simple bar chart with embedded data.&#x27;,
        data: {
          values: [
            {a: &#x27;A&#x27;, b: 28},
            {a: &#x27;B&#x27;, b: 55},
            {a: &#x27;C&#x27;, b: 43},
            {a: &#x27;D&#x27;, b: 91},
            {a: &#x27;E&#x27;, b: 81},
            {a: &#x27;F&#x27;, b: 53},
            {a: &#x27;G&#x27;, b: 19},
            {a: &#x27;H&#x27;, b: 87},
            {a: &#x27;I&#x27;, b: 52}
          ]
        },
        mark: &#x27;bar&#x27;,
        encoding: {
          x: {field: &#x27;a&#x27;, type: &#x27;ordinal&#x27;},
          y: {field: &#x27;b&#x27;, type: &#x27;quantitative&#x27;}
        }
      };
      vegaEmbed(&#x27;#vis&#x27;, yourVlSpec);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="373:1-8391" endpos="430:95-9653"><cell startpos="373:1-8391" endpos="375:53-8482"><div class="cell-content"><h3 id="example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</h3><p>Docs: <a href="https://github.com/magjac/d3-graphviz#examples">https://github.com/magjac/d3-graphviz#examples<span class="linkIcon">↗</span></a></p></div></cell><cell startpos="377:1-8484" endpos="395:4-9047" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=dot</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;${node.value.trim()}&#x27;);

&lt;/script&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="397:1-9049" endpos="399:4-9093" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;digraph  { a -&gt; b }&#x27;);

&lt;/script&gt;"></iframe></codecell></div></cell><cell startpos="401:1-9095" endpos="428:4-9557" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;digraph Q {

  node [shape=record];


  nd_1   [label = &quot;Node 1&quot;];
  nd_2   [label = &quot;Node 2&quot;];
  nd_3_a [label = &quot;Above Right Node 3&quot;];
  nd_3_l [label = &quot;Left of Node 3&quot;];
  nd_3   [label = &quot;Node 3&quot;];
  nd_3_r [label = &quot;Right of Node 3&quot;];
  nd_4   [label = &quot;Node 4&quot;];


  nd_3_a -&gt; nd_3_r;
  nd_1 -&gt; nd_2 -&gt; nd_3 -&gt; nd_4;

  subgraph cluster_R {

    {rank=same nd_3_l nd_3 nd_3_r}

    nd_3_l -&gt; nd_3 -&gt; nd_3_r [color=grey arrowhead=none];

  }

}&#x27;);

&lt;/script&gt;"></iframe></codecell></div></cell><cell startpos="430:1-9559" endpos="430:95-9653"><div class="cell-content"><p>The above mildly more complex example doesn&#x27;t render, likely due to not being actual graphviz.</p></div></cell></section>
<section depth="3" class="" startpos="432:1-9655" endpos="524:4-12339"><cell startpos="432:1-9655" endpos="432:31-9685"><div class="cell-content"><h3 id="example-plantuml-viewer">Example: Plant<code>UML</code> viewer</h3></div></cell><cell startpos="434:1-9687" endpos="500:4-11845" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=uml</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const ref = React.createRef();
   const [height, setHeight] = React.useState(null)
   let [id] = React.useState(Math.round(Math.random() * 10000000).toString())

  React.useEffect(() =&gt; {
    const handler = event =&gt; {
      if (ref &amp;&amp; ref.current &amp;&amp; event &amp;&amp; event.data &amp;&amp; typeof event.data === &#x27;string&#x27;) {
          const data = JSON.parse(event.data)
          if (id === data.source) {
             console.log(&quot;Message: &quot;, data)
             setHeight(data.height)
          }

      }
    }

    window.addEventListener(&quot;message&quot;, handler)

    // clean up
    return () =&gt; window.removeEventListener(&quot;message&quot;, handler)
  }, []) // empty array =&gt; run only once

   const el = c(&#x27;iframe&#x27;, {ref: ref, style: {height: ( height ? (height + &#x27;px&#x27;) : &#x27;auto&#x27;) },srcDoc: `&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;${id}&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;${node.value.replace(/\n/g, &#x27;\\n&#x27;)}&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;`})
   console.log(&quot;PlantViewer iframe ref:&quot;, el.ref.current)
   return el
}
</code></pre></codecell></div></cell><cell startpos="502:1-11847" endpos="504:4-11876" class="code"><div class="cell-content"><codecell class="dir-inline lang-uml local"><span class="meta"><span class="lang">uml</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><iframe style="height:auto" srcDoc="&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;4950285&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;[A] -&gt; [B]\n&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;"></iframe></codecell></div></cell><cell startpos="506:1-11878" endpos="524:4-12339" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><iframe style="height:auto" srcDoc="&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;7198374&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;@startuml\nparticipant participant as Foo\nactor       actor       as Foo1\nboundary    boundary    as Foo2\ncontrol     control     as Foo3\nentity      entity      as Foo4\ndatabase    database    as Foo5\ncollections collections as Foo6\nqueue       queue       as Foo7\nFoo -&gt; Foo1 : To actor \nFoo -&gt; Foo2 : To boundary\nFoo -&gt; Foo3 : To control\nFoo -&gt; Foo4 : To entity\nFoo -&gt; Foo5 : To database\nFoo -&gt; Foo6 : To collections\nFoo -&gt; Foo7 : To queue\n@enduml\n&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;"></iframe></codecell></div></cell></section>
<section depth="2" class="" startpos="526:1-12341" endpos="547:4-12712"><cell startpos="526:1-12341" endpos="526:10-12350"><div class="cell-content"><h2 id="errors">Errors</h2></div></cell><section depth="3" class="" startpos="528:1-12352" endpos="547:4-12712"><cell startpos="528:1-12352" endpos="528:12-12363"><div class="cell-content"><h3 id="runtime">Runtime</h3></div></cell><cell startpos="530:1-12365" endpos="534:4-12489" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></div></cell><cell startpos="536:1-12491" endpos="540:4-12618" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=syntaxerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Syntax Error: Broken Viewer&quot;
}
</code></pre></codecell></div></cell><cell startpos="541:1-12619" endpos="543:4-12659" class="code output"><div class="cell-content"><codecell class="lang-testerror local output"><span class="meta"><span class="lang">testerror</span></span><output><pre><code class="testerror">Viewer throws an Error
</code></pre></output></codecell></div></cell><cell startpos="545:1-12661" endpos="547:4-12712" class="code output"><div class="cell-content"><codecell class="lang-syntaxerror local output"><span class="meta"><span class="lang">syntaxerror</span></span><output><pre><code class="syntaxerror">TODO: Viewer has a syntax error
</code></pre></output></codecell></div></cell></section></section>
<section depth="3" class="" startpos="549:1-12714" endpos="559:4-12908"><cell startpos="549:1-12714" endpos="549:11-12724"><div class="cell-content"><h3 id="import">Import</h3></div></cell><cell startpos="551:1-12726" endpos="556:4-12866" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror2</span></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = ({node}) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></div></cell><cell startpos="557:1-12867" endpos="559:4-12908" class="code output"><div class="cell-content"><codecell class="lang-testerror2 local output"><span class="meta"><span class="lang">testerror2</span></span><output><pre><code class="testerror2">Viewer throws an Error
</code></pre></output></codecell></div></cell></section>
<section depth="2" class="" startpos="561:1-12910" endpos="584:4-13388"><cell startpos="561:1-12910" endpos="561:21-12930"><div class="cell-content"><h2 id="initial-prototype">Initial prototype</h2></div></cell><cell startpos="563:1-12932" endpos="584:4-13388" class="code"><div class="cell-content"><codecell class="dir-below lang-html local"><span class="meta"><span class="lang">html</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=iframe</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       document.body.innerHTML = (&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       document.body.innerHTML = (&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="2" class="" startpos="586:1-13390" endpos="642:4-14773"><cell startpos="586:1-13390" endpos="586:15-13404"><div class="cell-content"><h2 id="experiments">Experiments</h2></div></cell><cell startpos="588:1-13406" endpos="617:4-14253" class="code"><div class="cell-content"><codecell class="dir-plugin lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=plantuml2</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [url, setUrl] = useState(null)

  async function encodePlantUML(src) {
      console.log(&quot;encoding&quot;, src)
      const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
      const encoded = module.encode(src) //.replace(/\n/g, &#x27;\\n&#x27;))
      console.log(encoded)
      return encoded
  }

  const src = node.value
  useEffect(async ()=&gt; {
    const encoded = await encodePlantUML(node.data.value)
    const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
    setUrl(url)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;lit-viewer-plantuml2&#x27;,
  }, url ? rc(&#x27;img&#x27;, {
    src: url,
  }) : &quot;Loading...&quot;)
}
</code></pre></codecell></div></cell><cell startpos="619:1-14255" endpos="623:4-14311" class="code"><div class="cell-content"><codecell class="dir-inline lang-plantuml2 local"><span class="meta"><span class="lang">plantuml2</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><div class="lit-viewer-plantuml2">Loading...</div></codecell></div></cell><cell startpos="624:1-14312" endpos="642:4-14773" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><iframe style="height:auto" srcDoc="&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;3435876&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;@startuml\nparticipant participant as Foo\nactor       actor       as Foo1\nboundary    boundary    as Foo2\ncontrol     control     as Foo3\nentity      entity      as Foo4\ndatabase    database    as Foo5\ncollections collections as Foo6\nqueue       queue       as Foo7\nFoo -&gt; Foo1 : To actor \nFoo -&gt; Foo2 : To boundary\nFoo -&gt; Foo3 : To control\nFoo -&gt; Foo4 : To entity\nFoo -&gt; Foo5 : To database\nFoo -&gt; Foo6 : To collections\nFoo -&gt; Foo7 : To queue\n@enduml\n&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;"></iframe></codecell></div></cell></section></div></div><div id="backlinks"><h4>Backlinks (4)</h4><ol><li><a title="Executing code cells" href="/execute_code_cells.html">Executing code cells</a></li><li><a title="Executing code cells" href="/execute_code_cells.html">Executing code cells</a></li><li><a title="Renderer" href="/renderer/renderer.html">Renderer</a></li><li><a title="🔥 Scratch ⚠️ Pad 🔬" href="/scratch_pad.html">🔥 Scratch ⚠️ Pad 🔬</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>