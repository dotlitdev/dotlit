<html data-reactroot=""><head><title>Custom Viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu><div class="lit-messages"><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=foo</span><span class="name">15:1-19:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=bar !collapse</span><span class="name">53:1-69:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=css !collapse</span><span class="name">77:1-96:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=md !collapse &lt;  viewers/md/index.jsx</span><span class="name">115:1-117:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for viewers/meta.js !plugin of=meta</span><span class="name">178:1-182:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=diff !collapse</span><span class="name">196:1-250:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=custom-graph !collapse</span><span class="name">263:1-308:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=dot !collapse</span><span class="name">377:1-395:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=uml !collapse</span><span class="name">434:1-500:4</span></div><div class="lit-message"><span class="message">Plugin Error (unknown): No plugin exported from module. for !plugin of=plantuml2</span><span class="name">588:1-617:4</span></div></div></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><div class="cell-content"><h1 id="custom-viewers">Custom Viewers</h1></div></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><div class="cell-content"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a href="#examples">Examples<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-react-viewer">Example: React viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-css-viewer">Example: <code>css</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-md-viewer">Example: <code>md</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-katex-viewer">Example: <code>KaTeX</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-diff-viewer">Example: <code>diff</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-vega">Example: Vega<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer<span class="linkIcon">¬ß</span></a></li>
<li><a href="#example-plantuml-viewer">Example: Plant<code>UML</code> viewer<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a href="#runtime">Runtime<span class="linkIcon">¬ß</span></a></li>
<li><a href="#import">Import<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a href="#experiments">Experiments<span class="linkIcon">¬ß</span></a></p>
</li>
</ul></div></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="9:31-126"><cell startpos="5:1-40" endpos="9:31-126"><div class="cell-content"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Doppelg√§nger page?</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></div></cell></section>
<section depth="2" class="" startpos="11:1-128" endpos="48:4-499"><cell startpos="11:1-128" endpos="11:12-139"><div class="cell-content"><h2 id="examples">Examples</h2></div></cell><section depth="3" class="" startpos="13:1-141" endpos="48:4-499"><cell startpos="13:1-141" endpos="13:32-172"><div class="cell-content"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></div></cell><cell startpos="15:1-174" endpos="19:4-270" class="code"><div class="cell-content"><codecell class="dir-plugin lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=foo</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  return `${node.value} Foooooo!`
}
</code></pre></codecell></div></cell><cell startpos="22:1-273" endpos="22:30-302"><div class="cell-content"><p>Not used in the default case:</p></div></cell><cell startpos="24:1-304" endpos="26:4-318" class="code"><div class="cell-content"><codecell class="lang-foo local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Bar
</code></pre></codecell></div></cell><cell startpos="28:1-320" endpos="28:41-360"><div class="cell-content"><p>Only when using the <code>!inline</code> directive:</p></div></cell><cell startpos="30:1-362" endpos="32:4-386" class="code"><div class="cell-content"><codecell class="dir-inline lang-foo local"><span class="meta"><span class="lang">foo</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="foo">Baz 1
</code></pre></codecell></div></cell><cell startpos="38:1-392" endpos="38:38-429"><div class="cell-content"><p>or <code>viewer=xxx</code> attribute is present:</p></div></cell><cell startpos="40:1-431" endpos="42:4-456" class="code"><div class="cell-content"><codecell class="lang-bar local"><span class="meta"><span class="lang">bar</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=foo</span></span><pre><code class="bar">Quz
</code></pre></codecell></div></cell><cell startpos="44:1-458" endpos="44:25-482"><div class="cell-content"><p>or it is an output cell:</p></div></cell><cell startpos="46:1-484" endpos="48:4-499" class="code output"><div class="cell-content"><codecell class="lang-foo local output"><span class="meta"><span class="lang">foo</span></span><output><pre><code class="foo">Qux
</code></pre></output></codecell></div></cell></section></section>
<section depth="3" class="" startpos="51:1-502" endpos="73:4-1017"><cell startpos="51:1-502" endpos="51:26-527"><div class="cell-content"><h3 id="example-react-viewer">Example: React viewer</h3></div></cell><cell startpos="53:1-529" endpos="69:4-981" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=bar</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [content, setContent] = useState(&#x27;Loading...&#x27;)
  const src = node.data.value
  useEffect(()=&gt;{
    setContent(&quot;Loaded. &quot; + node.data.value)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;custom-react-view&#x27;,
  }, content)
}
</code></pre></codecell></div></cell><cell startpos="71:1-983" endpos="73:4-1017" class="code"><div class="cell-content"><codecell class="dir-below lang-bar local"><span class="meta"><span class="lang">bar</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="bar">Custom Content 3
</code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="75:1-1019" endpos="109:4-1809"><cell startpos="75:1-1019" endpos="75:26-1044"><div class="cell-content"><h3 id="example-css-viewer">Example: <code>css</code> viewer</h3></div></cell><cell startpos="77:1-1046" endpos="96:4-1429" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=css</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const meta = node.properties 
               &amp;&amp; node.properties.meta

  const link = meta &amp;&amp; meta.uri

  if (link) return rc(&#x27;link&#x27;, {
    rel: &#x27;stylesheet&#x27;,
    href: link
  })

  return rc(&#x27;style&#x27;, {
    dangerouslySetInnerHTML: {
      __html: node.value
    }
  })
}
</code></pre></codecell></div></cell><cell startpos="98:1-1431" endpos="103:4-1509" class="code output"><div class="cell-content"><codecell class="dir-below lang-css local output"><span class="meta"><span class="lang">css</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><output><pre><code class="css">#lit-header {
  color: purple;
  font-family: sans-serif;
}
</code></pre></output></codecell></div></cell><cell startpos="105:1-1511" endpos="106:4-1629" class="code"><div class="cell-content"><codecell class="dir-inline dir-hidemeta lang-css local"><span class="meta"><span class="lang">css</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#964f82" class="directive dir-hidemeta">hidemeta</span></span><pre><code class="css"></code></pre></codecell></div></cell><cell startpos="107:1-1630" endpos="109:4-1809" class="code output"><div class="cell-content"><codecell class="dir-inline dir-info lang-md local output"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#03164a" class="directive dir-info">info</span></span><div class="md-block dir-inline dir-info">
<p>üëÄ There is an invisible <code>css</code> cell (using <code>!inline</code> and <code>!hidemeta</code> directives) above which pulls a new solarised light highlight.js theme into the page.</p>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="111:1-1811" endpos="151:4-2263"><cell startpos="111:1-1811" endpos="113:92-1928"><div class="cell-content"><h3 id="example-md-viewer">Example: <code>md</code> viewer</h3><p>Less of an example but rather a work in progress before moving it into <code>.lit</code> as a default.</p></div></cell><cell startpos="115:1-1930" endpos="117:4-1988" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=md</span><span class="source">&lt; viewers/md/index.jsx</span></span><pre><code class="js">export const viewer = ({children,node, React}) =&gt; {

  const ch = children
  const chc = ch[0].props.children
  const rc = React.createElement
  const np = node.properties

  const meta = np &amp;&amp; np.meta
  const dirs = meta &amp;&amp; meta.directives
  const tags = meta &amp;&amp; meta.tags
  
  const dc = dirs &amp;&amp; dirs.map(d=&gt;&#x27;dir-&#x27;+d)
  const tc = tags &amp;&amp; tags.map(t=&gt;&#x27;tag-&#x27;+t)

  const classes = [&#x27;md-block&#x27;]
  const add = arr =&gt; arr.forEach( c =&gt; { 
                        classes.push(c)
                     })
  if (dc) add(dc)
  if (tc) add(tc)

  const className = classes
                    .filter(x=&gt;x)
                    .join(&#x27; &#x27;)
                    .trim()

  return rc(&#x27;div&#x27;, {className}, chc)
}

</code></pre></codecell></div></cell><cell startpos="123:1-1994" endpos="125:4-2037" class="code"><div class="cell-content"><codecell class="dir-below lang-md local"><span class="meta"><span class="lang">md</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="md">*Markdown* Viewer **DONE**
</code></pre><div class="md-block dir-below">
<p><em>Markdown</em> Viewer <strong>DONE</strong></p>
</div></codecell></div></cell><cell startpos="127:1-2039" endpos="129:4-2077" class="code output"><div class="cell-content"><codecell class="lang-md local output"><span class="meta"><span class="lang">md</span></span><div class="md-block">
<p><em>Markdown</em> Viewer <strong>FIXED</strong></p>
</div></codecell></div></cell><cell startpos="141:1-2089" endpos="145:4-2206" class="code"><div class="cell-content"><codecell class="dir-success lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#90b540" class="directive dir-success">success</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=md</span></span><div class="md-block dir-success">
<p><strong>‚úÖ Admonitions</strong></p>
<p>See <a href="renderer/viewers/md/admonitions.html?file=renderer/viewers/md/admonitions.lit" title="renderer/viewers/md/admonitions" wikilink="true">renderer/viewers/md/admonitions</a> for more examples and usages.</p>
</div></codecell></div></cell><cell startpos="147:1-2208" endpos="151:4-2263" class="code"><div class="cell-content"><codecell class="dir-inline lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><div class="md-block dir-inline">
<codecell class="local"><pre><code class="plaintext"></code></pre></codecell>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="153:1-2265" endpos="174:4-3496"><cell startpos="153:1-2265" endpos="153:28-2292"><div class="cell-content"><h3 id="example-katex-viewer">Example: <code>KaTeX</code> viewer</h3></div></cell><cell startpos="155:1-2294" endpos="174:4-3496" class="code"><div class="cell-content"><codecell class="dir-inline lang-html local"><span class="meta"><span class="lang">html</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=iframe</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;!-- KaTeX requires the use of the HTML5 doctype. Without it, KaTeX may not render properly --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css&quot; integrity=&quot;sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5&quot; crossorigin=&quot;anonymous&quot;&gt;

    &lt;!-- The loading of KaTeX is deferred to speed up page rendering --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js&quot; integrity=&quot;sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

    &lt;!-- To automatically render math in text elements, include the auto-render extension: --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl&quot; crossorigin=&quot;anonymous&quot;
        onload=&quot;katex.render(document.body.innerHTML, document.body,{throwOnError: false});&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;% \f is defined as #1f(#2) using the macro
\f\relax{x} = \int_{-\infty}^\infty
    \f\hat\xi\,e^{2 \pi i \xi x}
    \,d\xi&lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="177:1-3499" endpos="188:4-3769"><cell startpos="177:1-3499" endpos="177:27-3525"><div class="cell-content"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></div></cell><cell startpos="178:1-3526" endpos="182:4-3700" class="code output"><div class="cell-content"><codecell class="dir-plugin lang-js local output"><a name="viewers/meta.js"></a><span class="meta"><span class="lang">js</span><span class="filename">viewers/meta.js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=meta</span></span><output><pre><code class="js">export const viewer = ({node,React}) =&gt; {
  return React.createElement(&#x27;pre&#x27;, {style: {color: &#x27;black&#x27;}}, lit.utils.inspect(node))
}
</code></pre></output></codecell></div></cell><cell startpos="186:1-3704" endpos="188:4-3769" class="code"><div class="cell-content"><codecell class="dir-below lang-txt local"><span class="meta"><span class="lang">txt</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=meta</span><span class="source">&lt; file.txt</span></span><pre><code class="txt"></code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="190:1-3771" endpos="257:4-5349"><cell startpos="190:1-3771" endpos="194:51-3930"><div class="cell-content"><h3 id="example-diff-viewer">Example: <code>diff</code> viewer</h3><p>v1 <code>https://cdn.skypack.dev/diff</code> didn&#x27;t work (via skyPack) but added to utils.</p><p>v2 <code>https://github.com/praneshr/react-diff-viewer</code></p></div></cell><cell startpos="196:1-3932" endpos="250:4-5096" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=diff</span></span><pre><code class="js">import diff from &#x27;https://cdn.skypack.dev/react-diff-viewer&#x27;
export const viewer = ({node,React}) =&gt; {
  const rc = React.createElement
 const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [content, setContent] = useState(&#x27;Loading...&#x27;)
  const src = node.data.value
  useEffect(async () =&gt; {

  const styles = {
    lineNumber: {
      fontWeight: &#x27;bold&#x27;
    },
    gutter: {
      minWidth: &#x27;0.6em&#x27;,
      padding: &#x27;0 0.2em&#x27;,
    },
    marker: {
      width: &#x27;auto&#x27;,
      padding: &#x27;0 0.2em&#x27;
    },
    contentText: {
      lineHeight: &#x27;1em !important&#x27;,
      wordBreak: &#x27;break-all&#x27;,
    },
    content: {
      width: &#x27;auto&#x27;,
      padding: 0,
    }
  }

  const view = rc(diff, {
    newValue: node.properties.data.originalSource,
    rightTitle: &#x27;local&#x27;,
    oldValue: src,
    leftTitle: &#x27;remote&#x27;,
    splitView: meta &amp;&amp; meta.split === &#x27;true&#x27;,
    styles,
    compareMethod: diff[(meta &amp;&amp; meta.method &amp;&amp; meta.method.toUpperCase()) || &#x27;CHARS&#x27;]
  })


    setContent(view)
  },[src])

  

  return rc(&#x27;div&#x27;, {
    className: &#x27;custom-diff-view&#x27;,
  }, content)

}
</code></pre></codecell></div></cell><cell startpos="251:1-5097" endpos="257:4-5349" class="code"><div class="cell-content"><codecell class="dir-inline lang-diff local"><span class="meta"><span class="lang">diff</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="source">&lt; difftestA.txt</span></span><pre><code class="diff">Custom Content as an initial value
for testing diff viewer
initially created as a txt file output
plan to flip to transclude and modify cell
giving a node with data.value and data.properties.data.originalSource 
</code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="259:1-5351" endpos="325:92-7169"><cell startpos="259:1-5351" endpos="261:73-5452"><div class="cell-content"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>‚úÖ This viewer has been folded into <code>.lit</code> as one of the default viewers.</p></div></cell><cell startpos="263:1-5454" endpos="308:4-6885" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=custom-graph</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="310:1-6887" endpos="320:4-7028" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="custom-graph">{
  &quot;nodes&quot;:[
    {&quot;id&quot;: &quot;foo&quot;},
    {&quot;id&quot;: &quot;bar&quot;}
  ],
  &quot;links&quot;: [
    {&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
  ]
}
</code></pre></codecell></div></cell><cell startpos="322:1-7030" endpos="323:4-7076" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="source">&lt; ../manifest.json</span></span><pre><code class="custom-graph"></code></pre></codecell></div></cell><cell startpos="325:1-7078" endpos="325:92-7169"><div class="cell-content"><p>The above automatically transcludes the <code>.lit</code> manifest and focuses on the current document</p></div></cell></section>
<section depth="3" class="" startpos="327:1-7171" endpos="371:4-8382"><cell startpos="327:1-7171" endpos="330:71-7288"><div class="cell-content"><h3 id="example-vega">Example: Vega</h3><p>Still a <em>Work in progress</em>
Docs: <a href="https://vega.github.io/vega-lite/usage/compile.html">vega-lite<span class="linkIcon">‚Üó</span></a></p></div></cell><cell startpos="332:1-7290" endpos="371:4-8382" class="code output"><div class="cell-content"><codecell class="lang-iframe local output"><span class="meta"><span class="lang">iframe</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Embedding Vega-Lite&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega@5.19.1&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.0.0&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.15.1&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;vis&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      var yourVlSpec = {
        $schema: &#x27;https://vega.github.io/schema/vega-lite/v5.json&#x27;,
        description: &#x27;A simple bar chart with embedded data.&#x27;,
        data: {
          values: [
            {a: &#x27;A&#x27;, b: 28},
            {a: &#x27;B&#x27;, b: 55},
            {a: &#x27;C&#x27;, b: 43},
            {a: &#x27;D&#x27;, b: 91},
            {a: &#x27;E&#x27;, b: 81},
            {a: &#x27;F&#x27;, b: 53},
            {a: &#x27;G&#x27;, b: 19},
            {a: &#x27;H&#x27;, b: 87},
            {a: &#x27;I&#x27;, b: 52}
          ]
        },
        mark: &#x27;bar&#x27;,
        encoding: {
          x: {field: &#x27;a&#x27;, type: &#x27;ordinal&#x27;},
          y: {field: &#x27;b&#x27;, type: &#x27;quantitative&#x27;}
        }
      };
      vegaEmbed(&#x27;#vis&#x27;, yourVlSpec);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="373:1-8384" endpos="430:95-9646"><cell startpos="373:1-8384" endpos="375:53-8475"><div class="cell-content"><h3 id="example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</h3><p>Docs: <a href="https://github.com/magjac/d3-graphviz#examples">https://github.com/magjac/d3-graphviz#examples<span class="linkIcon">‚Üó</span></a></p></div></cell><cell startpos="377:1-8477" endpos="395:4-9040" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=dot</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;${node.value.trim()}&#x27;);

&lt;/script&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="397:1-9042" endpos="399:4-9086" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><output><pre><code class="dot">digraph  { a -&gt; b }
</code></pre></output></codecell></div></cell><cell startpos="401:1-9088" endpos="428:4-9550" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot">digraph Q {

  node [shape=record];


  nd_1   [label = &quot;Node 1&quot;];
  nd_2   [label = &quot;Node 2&quot;];
  nd_3_a [label = &quot;Above Right Node 3&quot;];
  nd_3_l [label = &quot;Left of Node 3&quot;];
  nd_3   [label = &quot;Node 3&quot;];
  nd_3_r [label = &quot;Right of Node 3&quot;];
  nd_4   [label = &quot;Node 4&quot;];


  nd_3_a -&gt; nd_3_r;
  nd_1 -&gt; nd_2 -&gt; nd_3 -&gt; nd_4;

  subgraph cluster_R {

    {rank=same nd_3_l nd_3 nd_3_r}

    nd_3_l -&gt; nd_3 -&gt; nd_3_r [color=grey arrowhead=none];

  }

}
</code></pre></output></codecell></div></cell><cell startpos="430:1-9552" endpos="430:95-9646"><div class="cell-content"><p>The above mildly more complex example doesn&#x27;t render, likely due to not being actual graphviz.</p></div></cell></section>
<section depth="3" class="" startpos="432:1-9648" endpos="524:4-12332"><cell startpos="432:1-9648" endpos="432:31-9678"><div class="cell-content"><h3 id="example-plantuml-viewer">Example: Plant<code>UML</code> viewer</h3></div></cell><cell startpos="434:1-9680" endpos="500:4-11838" class="code"><div class="cell-content"><codecell class="dir-plugin dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=uml</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const ref = React.createRef();
   const [height, setHeight] = React.useState(null)
   let [id] = React.useState(Math.round(Math.random() * 10000000).toString())

  React.useEffect(() =&gt; {
    const handler = event =&gt; {
      if (ref &amp;&amp; ref.current &amp;&amp; event &amp;&amp; event.data &amp;&amp; typeof event.data === &#x27;string&#x27;) {
          const data = JSON.parse(event.data)
          if (id === data.source) {
             console.log(&quot;Message: &quot;, data)
             setHeight(data.height)
          }

      }
    }

    window.addEventListener(&quot;message&quot;, handler)

    // clean up
    return () =&gt; window.removeEventListener(&quot;message&quot;, handler)
  }, []) // empty array =&gt; run only once

   const el = c(&#x27;iframe&#x27;, {ref: ref, style: {height: ( height ? (height + &#x27;px&#x27;) : &#x27;auto&#x27;) },srcDoc: `&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;${id}&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;${node.value.replace(/\n/g, &#x27;\\n&#x27;)}&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;`})
   console.log(&quot;PlantViewer iframe ref:&quot;, el.ref.current)
   return el
}
</code></pre></codecell></div></cell><cell startpos="502:1-11840" endpos="504:4-11869" class="code"><div class="cell-content"><codecell class="dir-inline lang-uml local"><span class="meta"><span class="lang">uml</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="uml">[A] -&gt; [B]
</code></pre></codecell></div></cell><cell startpos="506:1-11871" endpos="524:4-12332" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">@startuml
participant participant as Foo
actor       actor       as Foo1
boundary    boundary    as Foo2
control     control     as Foo3
entity      entity      as Foo4
database    database    as Foo5
collections collections as Foo6
queue       queue       as Foo7
Foo -&gt; Foo1 : To actor 
Foo -&gt; Foo2 : To boundary
Foo -&gt; Foo3 : To control
Foo -&gt; Foo4 : To entity
Foo -&gt; Foo5 : To database
Foo -&gt; Foo6 : To collections
Foo -&gt; Foo7 : To queue
@enduml
</code></pre></output></codecell></div></cell></section>
<section depth="2" class="" startpos="526:1-12334" endpos="547:4-12705"><cell startpos="526:1-12334" endpos="526:10-12343"><div class="cell-content"><h2 id="errors">Errors</h2></div></cell><section depth="3" class="" startpos="528:1-12345" endpos="547:4-12705"><cell startpos="528:1-12345" endpos="528:12-12356"><div class="cell-content"><h3 id="runtime">Runtime</h3></div></cell><cell startpos="530:1-12358" endpos="534:4-12482" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></div></cell><cell startpos="536:1-12484" endpos="540:4-12611" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=syntaxerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Syntax Error: Broken Viewer&quot;
}
</code></pre></codecell></div></cell><cell startpos="541:1-12612" endpos="543:4-12652" class="code output"><div class="cell-content"><codecell class="lang-testerror local output"><span class="meta"><span class="lang">testerror</span></span><output><pre><code class="testerror">Viewer throws an Error
</code></pre></output></codecell></div></cell><cell startpos="545:1-12654" endpos="547:4-12705" class="code output"><div class="cell-content"><codecell class="lang-syntaxerror local output"><span class="meta"><span class="lang">syntaxerror</span></span><output><pre><code class="syntaxerror">TODO: Viewer has a syntax error
</code></pre></output></codecell></div></cell></section></section>
<section depth="3" class="" startpos="549:1-12707" endpos="559:4-12901"><cell startpos="549:1-12707" endpos="549:11-12717"><div class="cell-content"><h3 id="import">Import</h3></div></cell><cell startpos="551:1-12719" endpos="556:4-12859" class="code"><div class="cell-content"><codecell class="dir-plugin-disabled lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#dd74b7" class="directive dir-plugin-disabled">plugin-disabled</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror2</span></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = ({node}) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></div></cell><cell startpos="557:1-12860" endpos="559:4-12901" class="code output"><div class="cell-content"><codecell class="lang-testerror2 local output"><span class="meta"><span class="lang">testerror2</span></span><output><pre><code class="testerror2">Viewer throws an Error
</code></pre></output></codecell></div></cell></section>
<section depth="2" class="" startpos="561:1-12903" endpos="584:4-13381"><cell startpos="561:1-12903" endpos="561:21-12923"><div class="cell-content"><h2 id="initial-prototype">Initial prototype</h2></div></cell><cell startpos="563:1-12925" endpos="584:4-13381" class="code"><div class="cell-content"><codecell class="dir-below lang-html local"><span class="meta"><span class="lang">html</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=iframe</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       document.body.innerHTML = (&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       document.body.innerHTML = (&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="2" class="" startpos="586:1-13383" endpos="642:4-14766"><cell startpos="586:1-13383" endpos="586:15-13397"><div class="cell-content"><h2 id="experiments">Experiments</h2></div></cell><cell startpos="588:1-13399" endpos="617:4-14246" class="code"><div class="cell-content"><codecell class="dir-plugin lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=plantuml2</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [url, setUrl] = useState(null)

  async function encodePlantUML(src) {
      console.log(&quot;encoding&quot;, src)
      const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
      const encoded = module.encode(src) //.replace(/\n/g, &#x27;\\n&#x27;))
      console.log(encoded)
      return encoded
  }

  const src = node.value
  useEffect(async ()=&gt; {
    const encoded = await encodePlantUML(node.data.value)
    const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
    setUrl(url)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;lit-viewer-plantuml2&#x27;,
  }, url ? rc(&#x27;img&#x27;, {
    src: url,
  }) : &quot;Loading...&quot;)
}
</code></pre></codecell></div></cell><cell startpos="619:1-14248" endpos="623:4-14304" class="code"><div class="cell-content"><codecell class="dir-inline lang-plantuml2 local"><span class="meta"><span class="lang">plantuml2</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="plantuml2">@startuml
class Example
@enduml
</code></pre></codecell></div></cell><cell startpos="624:1-14305" endpos="642:4-14766" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">@startuml
participant participant as Foo
actor       actor       as Foo1
boundary    boundary    as Foo2
control     control     as Foo3
entity      entity      as Foo4
database    database    as Foo5
collections collections as Foo6
queue       queue       as Foo7
Foo -&gt; Foo1 : To actor 
Foo -&gt; Foo2 : To boundary
Foo -&gt; Foo3 : To control
Foo -&gt; Foo4 : To entity
Foo -&gt; Foo5 : To database
Foo -&gt; Foo6 : To collections
Foo -&gt; Foo7 : To queue
@enduml
</code></pre></output></codecell></div></cell></section></div></div><div id="backlinks"><h4>Backlinks (5)</h4><ol><li><a title="Executing code cells" href="/execute_code_cells.html">Executing code cells</a></li><li><a title="Executing code cells" href="/execute_code_cells.html">Executing code cells</a></li><li><a title="üé® Styling &amp; Themes" href="/meta/styling_and_themes.html">üé® Styling &amp; Themes</a></li><li><a title="Renderer" href="/renderer/renderer.html">Renderer</a></li><li><a title="üî• Scratch ‚ö†Ô∏è Pad üî¨" href="/scratch_pad.html">üî• Scratch ‚ö†Ô∏è Pad üî¨</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>