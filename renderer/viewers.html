<html data-reactroot=""><head><title>viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><h1 id="custom-viewers">Custom Viewers</h1></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do</a></p>
</li>
<li>
<p><a href="#examples">Examples</a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</a></li>
<li><a href="#example-md-viewer">Example: <code>md</code> viewer</a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer</a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer</a></li>
<li><a href="#example-vega">Example: Vega</a></li>
<li><a href="#example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</a></li>
<li><a href="#example-plantuml-viewer">Example: Plant<code>UML</code> viewer</a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors</a></p>
<ul>
<li><a href="#runtime">Runtime</a></li>
<li><a href="#import">Import</a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype</a></p>
</li>
</ul></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="8:32-102"><cell startpos="5:1-40" endpos="8:32-102"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></cell></section>
<section depth="2" class="" startpos="10:1-104" endpos="43:4-507"><cell startpos="10:1-104" endpos="10:12-115"><h2 id="examples">Examples</h2></cell><section depth="3" class="" startpos="12:1-117" endpos="43:4-507"><cell startpos="12:1-117" endpos="12:32-148"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></cell><cell startpos="14:1-150" endpos="18:4-271" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  return `${node.value} Foooooo! React: ${!!React}`
}
</code></pre></codecell></cell><cell startpos="21:1-274" endpos="21:30-303"><p>Not used in the default case:</p></cell><cell startpos="23:1-305" endpos="25:4-332" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Bar
</code></pre></codecell></cell><cell startpos="27:1-334" endpos="27:41-374"><p>Only when using the <code>!inline</code> directive:</p></cell><cell startpos="29:1-376" endpos="31:4-398" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="foo">Baz
</code></pre></codecell></cell><cell startpos="33:1-400" endpos="33:38-437"><p>or <code>viewer=xxx</code> attribute is present:</p></cell><cell startpos="35:1-439" endpos="37:4-464" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><pre><code class="foo">Quz
</code></pre></codecell></cell><cell startpos="39:1-466" endpos="39:25-490"><p>or it is an output cell:</p></cell><cell startpos="41:1-492" endpos="43:4-507" class="code"><codecell class="local"><span class="meta"><span class="lang">foo</span></span><output><pre><code class="foo"></code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="45:1-509" endpos="60:4-790"><cell startpos="45:1-509" endpos="45:25-533"><h3 id="example-md-viewer">Example: <code>md</code> viewer</h3></cell><cell startpos="47:1-535" endpos="52:4-679" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node,React}) =&gt; {
  const view = React.createElement(&#x27;div&#x27;, null, node.children)
  return view
}
</code></pre></codecell></cell><cell startpos="54:1-681" endpos="56:4-738" class="code"><codecell class="local"><span class="meta"><span class="lang">md</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="md">*Markdown* Viewer **TODO**
</code></pre></codecell></cell><cell startpos="58:1-740" endpos="60:4-790" class="code"><codecell class="local"><span class="meta"><span class="lang">md</span></span><output><pre><code class="md">*Markdown* Viewer **TODO**
</code></pre></output></codecell></cell></section>
<section depth="3" class="" startpos="62:1-792" endpos="73:4-1074"><cell startpos="62:1-792" endpos="62:27-818"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></cell><cell startpos="64:1-820" endpos="69:4-980" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node,React}) =&gt; {
  const view = React.createElement(&#x27;pre&#x27;, null, JSON.stringify(node,null,2))
  return view
}
</code></pre></codecell></cell><cell startpos="71:1-982" endpos="73:4-1074" class="code"><codecell class="local"><span class="meta"><span class="lang">txt</span><span class="filename">file.txt</span><ul class="tags"><li><span class="tag">example</span></li></ul><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="txt">show meta content instead
</code></pre></codecell></cell></section>
<section depth="3" class="" startpos="75:1-1076" endpos="141:92-2884"><cell startpos="75:1-1076" endpos="77:73-1177"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>âœ… This viewer has been folded into <code>.lit</code> as one of the default viewers.</p></cell><cell startpos="79:1-1179" endpos="124:4-2600" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></cell><cell startpos="126:1-2602" endpos="136:4-2743" class="code"><codecell class="local"><span class="meta"><span class="lang">custom-graph</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="custom-graph">{
  &quot;nodes&quot;:[
    {&quot;id&quot;: &quot;foo&quot;},
    {&quot;id&quot;: &quot;bar&quot;}
  ],
  &quot;links&quot;: [
    {&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
  ]
}
</code></pre></codecell></cell><cell startpos="138:1-2745" endpos="139:4-2791" class="code"><codecell class="local"><span class="meta"><span class="lang">custom-graph</span><span class="source">&lt; ../manifest.json</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="custom-graph"></code></pre></codecell></cell><cell startpos="141:1-2793" endpos="141:92-2884"><p>The above automatically transcludes the <code>.lit</code> manifest and focuses on the current document</p></cell></section>
<section depth="3" class="" startpos="143:1-2886" endpos="187:4-4097"><cell startpos="143:1-2886" endpos="146:71-3003"><h3 id="example-vega">Example: Vega</h3><p>Still a <em>Work in progress</em>
Docs: <a href="https://vega.github.io/vega-lite/usage/compile.html">vega-lite</a></p></cell><cell startpos="148:1-3005" endpos="187:4-4097" class="code"><codecell class="local"><span class="meta"><span class="lang">iframe</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Embedding Vega-Lite&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega@5.19.1&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.0.0&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.15.1&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;vis&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      var yourVlSpec = {
        $schema: &#x27;https://vega.github.io/schema/vega-lite/v5.json&#x27;,
        description: &#x27;A simple bar chart with embedded data.&#x27;,
        data: {
          values: [
            {a: &#x27;A&#x27;, b: 28},
            {a: &#x27;B&#x27;, b: 55},
            {a: &#x27;C&#x27;, b: 43},
            {a: &#x27;D&#x27;, b: 91},
            {a: &#x27;E&#x27;, b: 81},
            {a: &#x27;F&#x27;, b: 53},
            {a: &#x27;G&#x27;, b: 19},
            {a: &#x27;H&#x27;, b: 87},
            {a: &#x27;I&#x27;, b: 52}
          ]
        },
        mark: &#x27;bar&#x27;,
        encoding: {
          x: {field: &#x27;a&#x27;, type: &#x27;ordinal&#x27;},
          y: {field: &#x27;b&#x27;, type: &#x27;quantitative&#x27;}
        }
      };
      vegaEmbed(&#x27;#vis&#x27;, yourVlSpec);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></cell></section>
<section depth="3" class="" startpos="189:1-4099" endpos="246:95-5338"><cell startpos="189:1-4099" endpos="191:53-4190"><h3 id="example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</h3><p>Docs: <a href="https://github.com/magjac/d3-graphviz#examples">https://github.com/magjac/d3-graphviz#examples</a></p></cell><cell startpos="193:1-4192" endpos="211:4-4745" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;${node.value.trim()}&#x27;);

&lt;/script&gt;`})
   return el
}
</code></pre></codecell></cell><cell startpos="213:1-4747" endpos="215:4-4778" class="code"><codecell class="local"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot"></code></pre></output></codecell></cell><cell startpos="217:1-4780" endpos="244:4-5242" class="code"><codecell class="local"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot"></code></pre></output></codecell></cell><cell startpos="246:1-5244" endpos="246:95-5338"><p>The above mildly more complex example doesn&#x27;t render, likely due to not being actual graphviz.</p></cell></section>
<section depth="3" class="" startpos="248:1-5340" endpos="340:4-8014"><cell startpos="248:1-5340" endpos="248:31-5370"><h3 id="example-plantuml-viewer">Example: Plant<code>UML</code> viewer</h3></cell><cell startpos="250:1-5372" endpos="316:4-7520" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const ref = React.createRef();
   const [height, setHeight] = React.useState(null)
   let [id] = React.useState(Math.round(Math.random() * 10000000).toString())

  React.useEffect(() =&gt; {
    const handler = event =&gt; {
      if (ref &amp;&amp; ref.current &amp;&amp; event &amp;&amp; event.data &amp;&amp; typeof event.data === &#x27;string&#x27;) {
          const data = JSON.parse(event.data)
          if (id === data.source) {
             console.log(&quot;Message: &quot;, data)
             setHeight(data.height)
          }

      }
    }

    window.addEventListener(&quot;message&quot;, handler)

    // clean up
    return () =&gt; window.removeEventListener(&quot;message&quot;, handler)
  }, []) // empty array =&gt; run only once

   const el = c(&#x27;iframe&#x27;, {ref: ref, style: {height: ( height ? (height + &#x27;px&#x27;) : &#x27;auto&#x27;) },srcDoc: `&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;${id}&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;${node.value.replace(/\n/g, &#x27;\\n&#x27;)}&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;`})
   console.log(&quot;PlantViewer iframe ref:&quot;, el.ref.current)
   return el
}
</code></pre></codecell></cell><cell startpos="318:1-7522" endpos="320:4-7551" class="code"><codecell class="local"><span class="meta"><span class="lang">uml</span><ul class="directives"><li><span class="directive">inline</span></li></ul></span><pre><code class="uml">[A] -&gt; [B]
</code></pre></codecell></cell><cell startpos="322:1-7553" endpos="340:4-8014" class="code"><codecell class="local"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml"></code></pre></output></codecell></cell></section>
<section depth="2" class="" startpos="342:1-8016" endpos="352:4-8173"><cell startpos="342:1-8016" endpos="342:10-8025"><h2 id="errors">Errors</h2></cell><section depth="3" class="" startpos="344:1-8027" endpos="352:4-8173"><cell startpos="344:1-8027" endpos="344:12-8038"><h3 id="runtime">Runtime</h3></cell><cell startpos="346:1-8040" endpos="350:4-8155" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></cell><cell startpos="351:1-8156" endpos="352:4-8173" class="code"><codecell class="local"><span class="meta"><span class="lang">testerror</span></span><output><pre><code class="testerror"></code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="354:1-8175" endpos="361:4-8318"><cell startpos="354:1-8175" endpos="354:11-8185"><h3 id="import">Import</h3></cell><cell startpos="356:1-8187" endpos="361:4-8318" class="code"><codecell class="local"><span class="meta"><span class="lang">js</span><ul class="directives"><li><span class="directive">viewer</span></li></ul></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = ({node}) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></cell></section>
<section depth="2" class="" startpos="363:1-8320" endpos="386:4-8756"><cell startpos="363:1-8320" endpos="363:21-8340"><h2 id="initial-prototype">Initial prototype</h2></cell><cell startpos="365:1-8342" endpos="386:4-8756" class="code"><codecell class="local"><span class="meta"><span class="lang">html</span></span><pre><code class="html"></code></pre></codecell></cell></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="Statch Pad" href="/scratch_pad.html">Statch Pad</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>