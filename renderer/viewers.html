<html data-reactroot=""><head><title>Custom Viewers</title><meta name="litsrc" value="renderer/viewers.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu><div class="lit-messages"><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">15:1-19:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">57:1-73:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">81:1-100:4</span></div><div class="lit-message"><span class="message">Viewer Error: No module.exports when loaded as commonjs</span><span class="name">119:1-121:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">183:1-188:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">198:1-243:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">312:1-330:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">369:1-435:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">465:1-469:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">471:1-475:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">486:1-491:4</span></div><div class="lit-message"><span class="message">Viewer Error: Unexpected token &#x27;export&#x27;</span><span class="name">520:1-549:4</span></div></div></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-38"><cell startpos="1:1-0" endpos="1:17-16"><div class="cell-content"><h1 id="custom-viewers">Custom Viewers</h1></div></cell><section depth="2" class="" startpos="3:1-18" endpos="3:21-38"><cell startpos="3:1-18" endpos="3:21-38"><div class="cell-content"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#to-do">To Do<span class="linkIcon">§</span></a></p>
</li>
<li>
<p><a href="#examples">Examples<span class="linkIcon">§</span></a></p>
<ul>
<li><a href="#example-basic-foo-viewer">Example: Basic <code>foo</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-react-viewer">Example: React viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-css-viewer">Example: <code>css</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-md-viewer">Example: <code>md</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-katex-viewer">Example: <code>KaTeX</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-meta-viewer">Example: <code>meta</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-graph-viewer">Example: <code>graph</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-vega">Example: Vega<span class="linkIcon">§</span></a></li>
<li><a href="#example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer<span class="linkIcon">§</span></a></li>
<li><a href="#example-plantuml-viewer">Example: Plant<code>UML</code> viewer<span class="linkIcon">§</span></a></li>
</ul>
</li>
<li>
<p><a href="#errors">Errors<span class="linkIcon">§</span></a></p>
<ul>
<li><a href="#runtime">Runtime<span class="linkIcon">§</span></a></li>
<li><a href="#import">Import<span class="linkIcon">§</span></a></li>
</ul>
</li>
<li>
<p><a href="#initial-prototype">Initial prototype<span class="linkIcon">§</span></a></p>
</li>
<li>
<p><a href="#experiments">Experiments<span class="linkIcon">§</span></a></p>
</li>
</ul></div></cell></section></section>
<section depth="2" class="" startpos="5:1-40" endpos="9:31-126"><cell startpos="5:1-40" endpos="9:31-126"><div class="cell-content"><h2 id="to-do">To Do</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Doppelgänger page?</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Error handling</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Sharing across documents</li>
</ul></div></cell></section>
<section depth="2" class="" startpos="11:1-128" endpos="52:4-583"><cell startpos="11:1-128" endpos="11:12-139"><div class="cell-content"><h2 id="examples">Examples</h2></div></cell><section depth="3" class="" startpos="13:1-141" endpos="52:4-583"><cell startpos="13:1-141" endpos="13:32-172"><div class="cell-content"><h3 id="example-basic-foo-viewer">Example: Basic <code>foo</code> viewer</h3></div></cell><cell startpos="15:1-174" endpos="19:4-295" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=foo</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  return `${node.value} Foooooo! React: ${!!React}`
}
</code></pre></codecell></div></cell><cell startpos="22:1-298" endpos="22:30-327"><div class="cell-content"><p>Not used in the default case:</p></div></cell><cell startpos="24:1-329" endpos="26:4-356" class="code"><div class="cell-content"><codecell class="lang-foo local"><span class="meta"><span class="lang">foo</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><pre><code class="foo">Bar
</code></pre></codecell></div></cell><cell startpos="28:1-358" endpos="28:41-398"><div class="cell-content"><p>Only when using the <code>!inline</code> directive:</p></div></cell><cell startpos="30:1-400" endpos="32:4-424" class="code"><div class="cell-content"><codecell class="dir-inline lang-foo local"><span class="meta"><span class="lang">foo</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="foo">Baz 1
</code></pre></codecell></div></cell><cell startpos="34:1-426" endpos="36:4-449" class="code"><div class="cell-content"><codecell class="dir-above lang-foo local"><span class="meta"><span class="lang">foo</span><span style="color:white;background-color:#585239" class="directive dir-above">above</span></span><pre><code class="foo">Baz 2
</code></pre></codecell></div></cell><cell startpos="38:1-451" endpos="40:4-474" class="code"><div class="cell-content"><codecell class="dir-below lang-foo local"><span class="meta"><span class="lang">foo</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="foo">Baz 3
</code></pre></codecell></div></cell><cell startpos="42:1-476" endpos="42:38-513"><div class="cell-content"><p>or <code>viewer=xxx</code> attribute is present:</p></div></cell><cell startpos="44:1-515" endpos="46:4-540" class="code"><div class="cell-content"><codecell class="lang-bar local"><span class="meta"><span class="lang">bar</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=foo</span></span><pre><code class="bar">Quz
</code></pre></codecell></div></cell><cell startpos="48:1-542" endpos="48:25-566"><div class="cell-content"><p>or it is an output cell:</p></div></cell><cell startpos="50:1-568" endpos="52:4-583" class="code output"><div class="cell-content"><codecell class="lang-foo local output"><span class="meta"><span class="lang">foo</span></span><output><pre><code class="foo">Qux
</code></pre></output></codecell></div></cell></section></section>
<section depth="3" class="" startpos="55:1-586" endpos="77:4-1091"><cell startpos="55:1-586" endpos="55:26-611"><div class="cell-content"><h3 id="example-react-viewer">Example: React viewer</h3></div></cell><cell startpos="57:1-613" endpos="73:4-1055" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=bar</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [content, setContent] = useState(&#x27;Loading...&#x27;)
  const src = node.data.value
  useEffect(()=&gt;{
    setContent(&quot;Loaded. &quot; + node.data.value)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;custom-react-view&#x27;,
  }, content)
}
</code></pre></codecell></div></cell><cell startpos="75:1-1057" endpos="77:4-1091" class="code"><div class="cell-content"><codecell class="dir-below lang-bar local"><span class="meta"><span class="lang">bar</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="bar">Custom Content 3
</code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="79:1-1093" endpos="113:4-1867"><cell startpos="79:1-1093" endpos="79:26-1118"><div class="cell-content"><h3 id="example-css-viewer">Example: <code>css</code> viewer</h3></div></cell><cell startpos="81:1-1120" endpos="100:4-1493" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=css</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const meta = node.properties 
               &amp;&amp; node.properties.meta

  const link = meta &amp;&amp; meta.uri

  if (link) return rc(&#x27;link&#x27;, {
    rel: &#x27;stylesheet&#x27;,
    href: link
  })

  return rc(&#x27;style&#x27;, {
    dangerouslySetInnerHTML: {
      __html: node.value
    }
  })
}
</code></pre></codecell></div></cell><cell startpos="102:1-1495" endpos="107:4-1567" class="code"><div class="cell-content"><codecell class="dir-below lang-css local"><span class="meta"><span class="lang">css</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="css">#header {
  color: purple;
  font-family: monospace;
}
</code></pre></codecell></div></cell><cell startpos="109:1-1569" endpos="110:4-1687" class="code"><div class="cell-content"><codecell class="dir-inline dir-hidemeta lang-css local"><span class="meta"><span class="lang">css</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#964f82" class="directive dir-hidemeta">hidemeta</span></span><pre><code class="css"></code></pre></codecell></div></cell><cell startpos="111:1-1688" endpos="113:4-1867" class="code output"><div class="cell-content"><codecell class="dir-inline dir-info lang-md local output"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span style="color:white;background-color:#03164a" class="directive dir-info">info</span></span><div class="md-block dir-inline dir-info">
<p>👀 There is an invisible <code>css</code> cell (using <code>!inline</code> and <code>!hidemeta</code> directives) above which pulls a new solarised light highlight.js theme into the page.</p>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="115:1-1869" endpos="155:4-2325"><cell startpos="115:1-1869" endpos="117:92-1986"><div class="cell-content"><h3 id="example-md-viewer">Example: <code>md</code> viewer</h3><p>Less of an example but rather a work in progress before moving it into <code>.lit</code> as a default.</p></div></cell><cell startpos="119:1-1988" endpos="121:4-2036" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span class="source">&lt; viewers/md/index.jsx</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=md</span></span><pre><code class="js"></code></pre></codecell></div></cell><cell startpos="127:1-2042" endpos="129:4-2099" class="code"><div class="cell-content"><codecell class="dir-inline lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><div class="md-block dir-inline">
<p><em>Markdown</em> Viewer <strong>DONE</strong></p>
</div></codecell></div></cell><cell startpos="131:1-2101" endpos="133:4-2139" class="code output"><div class="cell-content"><codecell class="lang-md local output"><span class="meta"><span class="lang">md</span></span><div class="md-block">
<p><em>Markdown</em> Viewer <strong>FIXED</strong></p>
</div></codecell></div></cell><cell startpos="145:1-2151" endpos="149:4-2268" class="code"><div class="cell-content"><codecell class="dir-success lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#90b540" class="directive dir-success">success</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=md</span></span><div class="md-block dir-success">
<p><strong>✅ Admonitions</strong></p>
<p>See <a href="renderer/viewers/md/admonitions.html?file=renderer/viewers/md/admonitions.lit" title="renderer/viewers/md/admonitions" wikilink="true">renderer/viewers/md/admonitions</a> for more examples and usages.</p>
</div></codecell></div></cell><cell startpos="151:1-2270" endpos="155:4-2325" class="code"><div class="cell-content"><codecell class="dir-inline lang-md local"><span class="meta"><span class="lang">md</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><div class="md-block dir-inline">
<codecell class="local"><pre><code class="plaintext"></code></pre></codecell>
</div></codecell></div></cell></section>
<section depth="3" class="" startpos="157:1-2327" endpos="178:4-3557"><cell startpos="157:1-2327" endpos="157:28-2354"><div class="cell-content"><h3 id="example-katex-viewer">Example: <code>KaTeX</code> viewer</h3></div></cell><cell startpos="159:1-2356" endpos="178:4-3557" class="code"><div class="cell-content"><codecell class="dir-below lang-html local"><span class="meta"><span class="lang">html</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=iframe</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;!-- KaTeX requires the use of the HTML5 doctype. Without it, KaTeX may not render properly --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css&quot; integrity=&quot;sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5&quot; crossorigin=&quot;anonymous&quot;&gt;

    &lt;!-- The loading of KaTeX is deferred to speed up page rendering --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js&quot; integrity=&quot;sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

    &lt;!-- To automatically render math in text elements, include the auto-render extension: --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl&quot; crossorigin=&quot;anonymous&quot;
        onload=&quot;katex.render(document.body.innerHTML, document.body,{throwOnError: false});&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;% \f is defined as #1f(#2) using the macro
\f\relax{x} = \int_{-\infty}^\infty
    \f\hat\xi\,e^{2 \pi i \xi x}
    \,d\xi&lt;/body&gt;
&lt;/html&gt;
</code></pre><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;!-- KaTeX requires the use of the HTML5 doctype. Without it, KaTeX may not render properly --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css&quot; integrity=&quot;sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5&quot; crossorigin=&quot;anonymous&quot;&gt;

    &lt;!-- The loading of KaTeX is deferred to speed up page rendering --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js&quot; integrity=&quot;sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

    &lt;!-- To automatically render math in text elements, include the auto-render extension: --&gt;
    &lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl&quot; crossorigin=&quot;anonymous&quot;
        onload=&quot;katex.render(document.body.innerHTML, document.body,{throwOnError: false});&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;% \f is defined as #1f(#2) using the macro
\f\relax{x} = \int_{-\infty}^\infty
    \f\hat\xi\,e^{2 \pi i \xi x}
    \,d\xi&lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="181:1-3560" endpos="192:4-3860"><cell startpos="181:1-3560" endpos="181:27-3586"><div class="cell-content"><h3 id="example-meta-viewer">Example: <code>meta</code> viewer</h3></div></cell><cell startpos="183:1-3588" endpos="188:4-3769" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=meta</span></span><pre><code class="js">export const viewer = ({node,React}) =&gt; {
  const view = React.createElement(&#x27;pre&#x27;, {style: {color: &#x27;black&#x27;}}, JSON.stringify(node,null,2))
  return view
}
</code></pre></codecell></div></cell><cell startpos="190:1-3771" endpos="192:4-3860" class="code"><div class="cell-content"><codecell class="dir-below lang-txt local"><span class="meta"><span class="lang">txt</span><span class="filename">file.txt</span><span class="output">&gt; json filename.json !foo</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=meta</span></span><pre><code class="txt">show meta content below:
</code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="194:1-3862" endpos="260:92-5670"><cell startpos="194:1-3862" endpos="196:73-3963"><div class="cell-content"><h3 id="example-graph-viewer">Example: <code>graph</code> viewer</h3><p>✅ This viewer has been folded into <code>.lit</code> as one of the default viewers.</p></div></cell><cell startpos="198:1-3965" endpos="243:4-5386" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=custom-graph</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const data = node.value

   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;head&gt;
  &lt;style&gt; body { margin: 0; } &lt;/style&gt;
  &lt;script src=&quot;https://unpkg.com/force-graph&quot;&gt;&lt;/script&gt;
  &lt;!-- from: https://github.com/vasturiano/force-graph --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
    const data = ${data};
      const thisfile = window.parent.lit.location.src
      // alert(thisfile)
      const elem = document.getElementById(&#x27;graph&#x27;)
      const Graph = ForceGraph()(elem)
        .graphData(data)
        .nodeId(&#x27;id&#x27;)
        .nodeVal((n) =&gt; 2 * (n.backlinks &amp;&amp; n.backlinks.length ? n.backlinks.length : 1))
        .nodeLabel(&#x27;id&#x27;)
        .nodeAutoColorBy(&#x27;type&#x27;)
        
        // .linkColor(d =&gt; data.nodes[d.source].exists ? &#x27;red&#x27; : &#x27;lightblue&#x27;)
        .linkDirectionalArrowLength(6)
        .onNodeHover(node =&gt; elem.style.cursor = node ? &#x27;pointer&#x27; : null)
        .onNodeClick(node =&gt; {
          // Center/zoom on node
          Graph.centerAt(node.x, node.y, 1000);
          Graph.zoom(2, 2000);
        });

        setTimeout( () =&gt; {
            const { nodes, links } = Graph.graphData()
            const node = nodes.filter( n =&gt; n.id === thisfile)[0]
            Graph.centerAt(node.x, node.y, 1000);
            Graph.zoom(2, 2000);

        }, 2000)

  &lt;/script&gt;
&lt;/body&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="245:1-5388" endpos="255:4-5529" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="custom-graph">{
  &quot;nodes&quot;:[
    {&quot;id&quot;: &quot;foo&quot;},
    {&quot;id&quot;: &quot;bar&quot;}
  ],
  &quot;links&quot;: [
    {&quot;source&quot;: &quot;foo&quot;, &quot;target&quot;: &quot;bar&quot;}
  ]
}
</code></pre></codecell></div></cell><cell startpos="257:1-5531" endpos="258:4-5577" class="code"><div class="cell-content"><codecell class="dir-inline lang-custom-graph local"><span class="meta"><span class="lang">custom-graph</span><span class="source">&lt; ../manifest.json</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="custom-graph"></code></pre></codecell></div></cell><cell startpos="260:1-5579" endpos="260:92-5670"><div class="cell-content"><p>The above automatically transcludes the <code>.lit</code> manifest and focuses on the current document</p></div></cell></section>
<section depth="3" class="" startpos="262:1-5672" endpos="306:4-6883"><cell startpos="262:1-5672" endpos="265:71-5789"><div class="cell-content"><h3 id="example-vega">Example: Vega</h3><p>Still a <em>Work in progress</em>
Docs: <a href="https://vega.github.io/vega-lite/usage/compile.html">vega-lite<span class="linkIcon">↗</span></a></p></div></cell><cell startpos="267:1-5791" endpos="306:4-6883" class="code output"><div class="cell-content"><codecell class="lang-iframe local output"><span class="meta"><span class="lang">iframe</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><iframe srcDoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Embedding Vega-Lite&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega@5.19.1&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.0.0&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.15.1&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;vis&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      var yourVlSpec = {
        $schema: &#x27;https://vega.github.io/schema/vega-lite/v5.json&#x27;,
        description: &#x27;A simple bar chart with embedded data.&#x27;,
        data: {
          values: [
            {a: &#x27;A&#x27;, b: 28},
            {a: &#x27;B&#x27;, b: 55},
            {a: &#x27;C&#x27;, b: 43},
            {a: &#x27;D&#x27;, b: 91},
            {a: &#x27;E&#x27;, b: 81},
            {a: &#x27;F&#x27;, b: 53},
            {a: &#x27;G&#x27;, b: 19},
            {a: &#x27;H&#x27;, b: 87},
            {a: &#x27;I&#x27;, b: 52}
          ]
        },
        mark: &#x27;bar&#x27;,
        encoding: {
          x: {field: &#x27;a&#x27;, type: &#x27;ordinal&#x27;},
          y: {field: &#x27;b&#x27;, type: &#x27;quantitative&#x27;}
        }
      };
      vegaEmbed(&#x27;#vis&#x27;, yourVlSpec);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
" style="aspect-ratio:1.6"></iframe></codecell></div></cell></section>
<section depth="3" class="" startpos="308:1-6885" endpos="365:95-8137"><cell startpos="308:1-6885" endpos="310:53-6976"><div class="cell-content"><h3 id="example-d3-graphviz-dot-viewer">Example: D3 Graphviz <code>dot</code> viewer</h3><p>Docs: <a href="https://github.com/magjac/d3-graphviz#examples">https://github.com/magjac/d3-graphviz#examples<span class="linkIcon">↗</span></a></p></div></cell><cell startpos="312:1-6978" endpos="330:4-7531" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=dot</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const el = c(&#x27;iframe&#x27;, {srcDoc: `&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;body&gt;
&lt;script src=&quot;//d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js&quot;&gt;&lt;/script&gt;
&lt;div id=&quot;graph&quot; style=&quot;text-align: center;&quot;&gt;&lt;/div&gt;
&lt;script&gt;

d3.select(&quot;#graph&quot;).graphviz()
    .renderDot(&#x27;${node.value.trim()}&#x27;);

&lt;/script&gt;`})
   return el
}
</code></pre></codecell></div></cell><cell startpos="332:1-7533" endpos="334:4-7577" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span><span class="attribute attr-xviewer" style="color:white;background-color:#9b3ef8">xviewer=meta</span></span><output><pre><code class="dot">digraph  { a -&gt; b }
</code></pre></output></codecell></div></cell><cell startpos="336:1-7579" endpos="363:4-8041" class="code output"><div class="cell-content"><codecell class="lang-dot local output"><span class="meta"><span class="lang">dot</span></span><output><pre><code class="dot">digraph Q {

  node [shape=record];


  nd_1   [label = &quot;Node 1&quot;];
  nd_2   [label = &quot;Node 2&quot;];
  nd_3_a [label = &quot;Above Right Node 3&quot;];
  nd_3_l [label = &quot;Left of Node 3&quot;];
  nd_3   [label = &quot;Node 3&quot;];
  nd_3_r [label = &quot;Right of Node 3&quot;];
  nd_4   [label = &quot;Node 4&quot;];


  nd_3_a -&gt; nd_3_r;
  nd_1 -&gt; nd_2 -&gt; nd_3 -&gt; nd_4;

  subgraph cluster_R {

    {rank=same nd_3_l nd_3 nd_3_r}

    nd_3_l -&gt; nd_3 -&gt; nd_3_r [color=grey arrowhead=none];

  }

}
</code></pre></output></codecell></div></cell><cell startpos="365:1-8043" endpos="365:95-8137"><div class="cell-content"><p>The above mildly more complex example doesn&#x27;t render, likely due to not being actual graphviz.</p></div></cell></section>
<section depth="3" class="" startpos="367:1-8139" endpos="459:4-10813"><cell startpos="367:1-8139" endpos="367:31-8169"><div class="cell-content"><h3 id="example-plantuml-viewer">Example: Plant<code>UML</code> viewer</h3></div></cell><cell startpos="369:1-8171" endpos="435:4-10319" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=uml</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
   const c = React.createElement
   const ref = React.createRef();
   const [height, setHeight] = React.useState(null)
   let [id] = React.useState(Math.round(Math.random() * 10000000).toString())

  React.useEffect(() =&gt; {
    const handler = event =&gt; {
      if (ref &amp;&amp; ref.current &amp;&amp; event &amp;&amp; event.data &amp;&amp; typeof event.data === &#x27;string&#x27;) {
          const data = JSON.parse(event.data)
          if (id === data.source) {
             console.log(&quot;Message: &quot;, data)
             setHeight(data.height)
          }

      }
    }

    window.addEventListener(&quot;message&quot;, handler)

    // clean up
    return () =&gt; window.removeEventListener(&quot;message&quot;, handler)
  }, []) // empty array =&gt; run only once

   const el = c(&#x27;iframe&#x27;, {ref: ref, style: {height: ( height ? (height + &#x27;px&#x27;) : &#x27;auto&#x27;) },srcDoc: `&lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;PlantUML Viewer&lt;/title&gt;
        &lt;style&gt;html, body {margin: 0; padding: 0; } #plantuml { display: block; max-width: 100%; }&lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;img id=&quot;plantuml&quot; /&gt;
        &lt;script type=&quot;module&quot;&gt;

        function resize() {
          const msg = JSON.stringify({
            source: &quot;${id}&quot;,
            height: document.body.clientHeight
          })
          console.log(&quot;Resize Message&quot;, msg)
          window.parent.postMessage(msg, &#x27;*&#x27;);
        }
        async function encodePlantUML(src) {
          console.log(&quot;encoding&quot;, src)
          const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
          const encoded = module.encode(src)
          console.log(encoded)
          return encoded
        }

        encodePlantUML(&quot;${node.value.replace(/\n/g, &#x27;\\n&#x27;)}&quot;)
        .then(encoded =&gt; {
            const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
            const img = document.getElementById(&#x27;plantuml&#x27;)
            img.setAttribute(&#x27;src&#x27;, url)
            img.onload = resize
        })

        console.log(&quot;PlantUML Viewer.&quot;)
      &lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;`})
   console.log(&quot;PlantViewer iframe ref:&quot;, el.ref.current)
   return el
}
</code></pre></codecell></div></cell><cell startpos="437:1-10321" endpos="439:4-10350" class="code"><div class="cell-content"><codecell class="dir-inline lang-uml local"><span class="meta"><span class="lang">uml</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="uml">[A] -&gt; [B]
</code></pre></codecell></div></cell><cell startpos="441:1-10352" endpos="459:4-10813" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">@startuml
participant participant as Foo
actor       actor       as Foo1
boundary    boundary    as Foo2
control     control     as Foo3
entity      entity      as Foo4
database    database    as Foo5
collections collections as Foo6
queue       queue       as Foo7
Foo -&gt; Foo1 : To actor 
Foo -&gt; Foo2 : To boundary
Foo -&gt; Foo3 : To control
Foo -&gt; Foo4 : To entity
Foo -&gt; Foo5 : To database
Foo -&gt; Foo6 : To collections
Foo -&gt; Foo7 : To queue
@enduml
</code></pre></output></codecell></div></cell></section>
<section depth="2" class="" startpos="461:1-10815" endpos="482:4-11168"><cell startpos="461:1-10815" endpos="461:10-10824"><div class="cell-content"><h2 id="errors">Errors</h2></div></cell><section depth="3" class="" startpos="463:1-10826" endpos="482:4-11168"><cell startpos="463:1-10826" endpos="463:12-10837"><div class="cell-content"><h3 id="runtime">Runtime</h3></div></cell><cell startpos="465:1-10839" endpos="469:4-10954" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Test Error: Broken Viewer&quot;)
}
</code></pre></codecell></div></cell><cell startpos="471:1-10956" endpos="475:4-11074" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=syntaxerror</span></span><pre><code class="js">export const viewer = ({node}) =&gt; {
  throw new Error(&quot;Syntax Error: Broken Viewer&quot;
}
</code></pre></codecell></div></cell><cell startpos="476:1-11075" endpos="478:4-11115" class="code output"><div class="cell-content"><codecell class="lang-testerror local output"><span class="meta"><span class="lang">testerror</span></span><output><pre><code class="testerror">Viewer throws an Error
</code></pre></output></codecell></div></cell><cell startpos="480:1-11117" endpos="482:4-11168" class="code output"><div class="cell-content"><codecell class="lang-syntaxerror local output"><span class="meta"><span class="lang">syntaxerror</span></span><output><pre><code class="syntaxerror">TODO: Viewer has a syntax error
</code></pre></output></codecell></div></cell></section></section>
<section depth="3" class="" startpos="484:1-11170" endpos="491:4-11313"><cell startpos="484:1-11170" endpos="484:11-11180"><div class="cell-content"><h3 id="import">Import</h3></div></cell><cell startpos="486:1-11182" endpos="491:4-11313" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=testerror2</span></span><pre><code class="js">throw new Error(&quot;Test Error: Broken Viewer&quot;)
export const viewer = ({node}) =&gt; {
  return &quot;never&quot;
}
</code></pre></codecell></div></cell></section>
<section depth="2" class="" startpos="493:1-11315" endpos="516:4-11751"><cell startpos="493:1-11315" endpos="493:21-11335"><div class="cell-content"><h2 id="initial-prototype">Initial prototype</h2></div></cell><cell startpos="495:1-11337" endpos="516:4-11751" class="code"><div class="cell-content"><codecell class="lang-html local"><span class="meta"><span class="lang">html</span></span><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;script type=&quot;module&quot;&gt;

    async function getViewer(src) {
      const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
      return module.viewer;
    }

    getViewer(`export const viewer = () =&gt; &quot;foo!&quot;`).then(viewer =&gt; {
       alert(&quot;Got viewer &quot; + !!viewer)
    })

  &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></codecell></div></cell></section>
<section depth="2" class="" startpos="518:1-11753" endpos="574:4-13136"><cell startpos="518:1-11753" endpos="518:15-11767"><div class="cell-content"><h2 id="experiments">Experiments</h2></div></cell><cell startpos="520:1-11769" endpos="549:4-12616" class="code"><div class="cell-content"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#cf5332" class="directive dir-viewer">viewer</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=plantuml2</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rc = React.createElement
  const {useState, useEffect} = React
  const meta = node.properties 
               &amp;&amp; node.properties.meta
  const [url, setUrl] = useState(null)

  async function encodePlantUML(src) {
      console.log(&quot;encoding&quot;, src)
      const module = await import(&quot;https://cdn.skypack.dev/plantuml-encoder&quot;);
      const encoded = module.encode(src) //.replace(/\n/g, &#x27;\\n&#x27;))
      console.log(encoded)
      return encoded
  }

  const src = node.value
  useEffect(async ()=&gt; {
    const encoded = await encodePlantUML(node.data.value)
    const url = &quot;https://plantuml.com/plantuml/svg/&quot; + encoded
    setUrl(url)
  },[src])

  return rc(&#x27;div&#x27;, {
    className: &#x27;lit-viewer-plantuml2&#x27;,
  }, url ? rc(&#x27;img&#x27;, {
    src: url,
  }) : &quot;Loading...&quot;)
}
</code></pre></codecell></div></cell><cell startpos="551:1-12618" endpos="555:4-12674" class="code"><div class="cell-content"><codecell class="dir-inline lang-plantuml2 local"><span class="meta"><span class="lang">plantuml2</span><span style="color:black;background-color:#b96da2" class="directive dir-inline">inline</span></span><pre><code class="plantuml2">@startuml
class Example
@enduml
</code></pre></codecell></div></cell><cell startpos="556:1-12675" endpos="574:4-13136" class="code output"><div class="cell-content"><codecell class="lang-uml local output"><span class="meta"><span class="lang">uml</span></span><output><pre><code class="uml">@startuml
participant participant as Foo
actor       actor       as Foo1
boundary    boundary    as Foo2
control     control     as Foo3
entity      entity      as Foo4
database    database    as Foo5
collections collections as Foo6
queue       queue       as Foo7
Foo -&gt; Foo1 : To actor 
Foo -&gt; Foo2 : To boundary
Foo -&gt; Foo3 : To control
Foo -&gt; Foo4 : To entity
Foo -&gt; Foo5 : To database
Foo -&gt; Foo6 : To collections
Foo -&gt; Foo7 : To queue
@enduml
</code></pre></output></codecell></div></cell></section></div></div><div id="backlinks"><h4>Backlinks (4)</h4><ol><li><a title="Executing code cells" href="/execute_code_cells.html">Executing code cells</a></li><li><a title="Theme Example" href="/meta/styling_and_themes.html">Theme Example</a></li><li><a title="Renderer" href="/renderer/renderer.html">Renderer</a></li><li><a title="🔥 Scratch ⚠️ Pad 🔬" href="/scratch_pad.html">🔥 Scratch ⚠️ Pad 🔬</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>