<html data-reactroot=""><head><title>components</title><meta name="litsrc" value="components/components.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="app"><div id="header"><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a><span>|</span></li><li class="MenuItems"><menu class=""><li class="MenuTitle">File</li></menu><menu class=""><li class="MenuTitle">Cell</li></menu><menu class=""><li class="MenuTitle">Section</li></menu><menu class=""><li class="MenuTitle">Help</li></menu></li></menu></div><div id="content"><section name="react-components"><cell startpos="3:1-2" endpos="3:19-20"><h1 id="react-components">React Components</h1></cell><section name="table-of-contents"><cell startpos="5:1-22" endpos="5:21-42"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#document">Document</a></p>
</li>
<li>
<p><a href="#header">Header</a></p>
</li>
<li>
<p><a href="#app">App</a></p>
</li>
<li>
<p><a href="#selection-context">Selection Context</a></p>
</li>
<li>
<p><a href="#cell">Cell</a></p>
<ul>
<li><a href="#cellmenu">CellMenu</a></li>
</ul>
</li>
<li>
<p><a href="#editor">Editor</a></p>
</li>
<li>
<p><a href="#icons">Icons</a></p>
</li>
<li>
<p><a href="#code">Code</a></p>
</li>
<li>
<p><a href="#link">Link</a></p>
</li>
<li>
<p><a href="#backlinks">Backlinks</a></p>
</li>
</ul></cell><section name="document"><cell startpos="7:1-44" endpos="7:12-55"><h2 id="document">Document</h2></cell><cell startpos="9:1-57" endpos="11:4-83" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="header"><cell startpos="13:1-85" endpos="13:10-94"><h2 id="header">Header</h2></cell><cell startpos="15:1-96" endpos="140:4-3495" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx">import React, { useState } from &#x27;react&#x27;
import * as clipboard from &quot;clipboard-polyfill&quot;

import SelectionContext from &#x27;./SelectionContext&#x27;
import { Identity } from &#x27;../utils/functions&#x27;
import { getConsoleForNamespace } from &#x27;../utils/console&#x27;


const console = getConsoleForNamespace(&#x27;Header&#x27;)

const setDebug = ev =&gt; {
  ev.preventDefault()
  const key = &#x27;litDebug&#x27;
  const example = &#x27;*,fs,client,Cell,sections,etc...&#x27;
  const storage = typeof localStorage !== &#x27;undefined&#x27; &amp;&amp; localStorage
  const val = prompt(key, storage.getItem(key) || example)
  storage.setItem( key, val )
  console.log(`Set ${key} to &quot;${val}&quot;`)
  return false
}

const showInspector = ev =&gt; {
  console.log(&#x27;Show mobile inspector&#x27;)
}

const Menu = props =&gt; {
  console.log(&#x27;&lt;Menu/&gt;&#x27;, props.title, props)

  const [open, setOpen] = useState(props.horizontal)
  const toggleOpen = _ =&gt; setOpen(!open)

  const classes = [
    props.horizontal ? &#x27;horizontal&#x27; : null,
    open ? &#x27;open&#x27; : null,
  ].filter(Identity).join(&#x27; &#x27;)

  const handleClickTitle = ev =&gt; {
    ev.stopPropagation()
    if (props.onClick) props.onClick()
    else if (props.href) location.href = props.href
    else toggleOpen()
    return false
  }

  const catchClicks = ev =&gt; {
    ev.stopPropagation()
    if (!props.horizontal) {
      toggleOpen()
    }
    return false
  }

  const disabled = !props.onClick &amp;&amp; !props.href &amp;&amp; !props.children

  return &lt;menu className={classes} disabled={disabled} onClick={catchClicks}&gt;
    &lt;li className={&quot;MenuTitle&quot;} key=&quot;menu-title&quot; onClick={handleClickTitle} &gt;
      { props.href
        ? &lt;a href={props.href}&gt;{props.title}&lt;/a&gt;
        : props.title}
      { open &amp;&amp; props.horizontal &amp;&amp; &lt;span&gt;|&lt;/span&gt; }
    &lt;/li&gt;
    { open &amp;&amp; &lt;li className=&quot;MenuItems&quot;&gt;{ props.children }&lt;/li&gt; }
  &lt;/menu&gt;
}



export const Header = props =&gt; {
  console.log(&#x27;&lt;Header/&gt;&#x27;, props)

  const resetFile = ctx =&gt; async ev =&gt; {
    console.log(&quot;Reset File:&quot;, ctx.file)
    if (confirm(`Are you sure you want to delete the local copy of &quot;${ctx.file}&quot;`)) {
      await ctx.fs.unlink(lit.location.src)
      console.log(&quot;Deleted &quot;, ctx.file, &quot;reloading page&quot;)
      location.reload()
    }
  }

  const copyToClipboard = ctx =&gt; ev =&gt; {
    clipboard.writeText(ctx.src)
    console.log(&quot;Copied src to clipboard&quot;)
  }

  return &lt;SelectionContext.Consumer&gt;{(ctx) =&gt; {
    return &lt;Menu title=&quot;Home&quot; horizontal href={props.root}&gt;
    &lt;Menu title=&quot;File&quot;&gt;
      &lt;span disabled&gt;New&lt;/span&gt;
      &lt;span disabled&gt;Open&lt;/span&gt;
      &lt;span disabled&gt;Save&lt;/span&gt;
      &lt;span onClick={copyToClipboard(ctx)}&gt;Copy&lt;/span&gt;
      &lt;span onClick={resetFile(ctx)}&gt;Reset&lt;/span&gt;
      &lt;span disabled&gt;Delete&lt;/span&gt;
    &lt;/Menu&gt;
    &lt;Menu title=&quot;Cell&quot;&gt;
      &lt;span disabled&gt;Add&lt;/span&gt;
      &lt;span disabled&gt;Remove&lt;/span&gt;
      &lt;span disabled&gt;Edit&lt;/span&gt;
      &lt;span disabled&gt;Execute&lt;/span&gt;
      &lt;span disabled&gt;Reset&lt;/span&gt;
      &lt;Menu title=&quot;Move&quot;&gt;
        &lt;span&gt;Up&lt;/span&gt;
        &lt;span&gt;Down&lt;/span&gt;
      &lt;/Menu&gt;
      &lt;Menu title=&quot;Copy&quot;&gt;
        &lt;span&gt;Source&lt;/span&gt;
        &lt;span&gt;Cell&lt;/span&gt;
      &lt;/Menu&gt;
    &lt;/Menu&gt;
    &lt;Menu title=&quot;Section&quot;&gt;
      &lt;span disabled&gt;Collapse&lt;/span&gt;
      &lt;span disabled&gt;Remove&lt;/span&gt;
      &lt;Menu title=&quot;Move&quot;&gt;
        &lt;span&gt;Up&lt;/span&gt;
        &lt;span&gt;Down&lt;/span&gt;
      &lt;/Menu&gt;
    &lt;/Menu&gt;
    &lt;Menu title=&quot;Help&quot;&gt;
      &lt;span onClick={setDebug}&gt;Debug&lt;/span&gt;
    &lt;/Menu&gt;
  &lt;/Menu&gt;
  }}
&lt;/SelectionContext.Consumer&gt;
}
</code></pre></codecell></cell><section name="app"><cell startpos="141:1-3496" endpos="141:7-3502"><h2 id="app">App</h2></cell><cell startpos="143:1-3504" endpos="213:4-5997" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx">import React, {useState} from &#x27;react&#x27;
import path from &#x27;path&#x27;
import SelectionContext from &#x27;./SelectionContext&#x27;
import patchSource from &#x27;../utils/unist-util-patch-source&#x27;
import { processor } from &#x27;../renderer&#x27;
import { getConsoleForNamespace } from &#x27;../utils/console&#x27;
import filter from &#x27;unist-util-filter&#x27;
import {atPos} from &#x27;../utils/unist-util-select-position&#x27;
import {selectAll} from &#x27;unist-util-select&#x27;

const console = getConsoleForNamespace(&#x27;App&#x27;)

const App = ({file, fs, result}) =&gt; {

    const [srcAndRes, setSrcAndRes] = useState({
        src: file.contents.toString(),
        res: result
    })
    const [res, setResult] = useState(result)
    const [selectedCell, setSelectedCell] = useState(null)
    
    const setSrcWrapper = async (pos, cellSource) =&gt; {
        console.log(&quot;&lt;App/&gt; Set src wrapper&quot;, pos, cellSource)
        const patchedSrc = patchSource(srcAndRes.src, pos, cellSource.trimEnd())
        
        file.contents = patchedSrc
        const processedFile = await processor(fs).process(file)
        console.log(&quot;Processed client&quot;, processedFile)
        setSrcAndRes({
            src: patchedSrc,
            res: processedFile.result
        })

        try {
            await fs.writeFile(file.path, patchedSrc, {encoding: &#x27;utf8&#x27;})
        } catch (err) {
            console.log(&quot;Failed to write file source to fs&quot;, file.path, err)
        }
        
        const tmpEnd = {line: pos.start.line + cellSource.split(&#x27;\n&#x27;).length }
        const tmpPos = {start: pos.start, end: tmpEnd }
        const tree = filter(processedFile.data.ast, atPos(tmpPos))
        const nodes = selectAll(&#x27;code&#x27;, tree)
        console.log(&quot;[CodeCells in Change (pos)]&quot;, tmpPos, file.path, tree, nodes)
        for (const codeCell of nodes) {
            const filename = codeCell.data &amp;&amp; codeCell.data.meta &amp;&amp; codeCell.data.meta.filename
            if (filename) {
                const filepath = path.join( path.dirname(file.path), filename)
                await fs.writeFile(filepath, codeCell.value)
                console.log(`Wrote codefile ${filename} to &quot;${filepath}&quot; on disk`)
            }
       }
    }

    const state = {
      src: srcAndRes.src, 
      selectedCell, 
      setSelectedCell, 
      setSrc: setSrcWrapper
    }

    console.log(&#x27;&lt;App/&gt; render&#x27;, selectedCell)

    return &lt;SelectionContext.Provider value={state}&gt;
        &lt;div id=&quot;content&quot;&gt;{srcAndRes.res}&lt;/div&gt;
    &lt;/SelectionContext.Provider&gt;
}

export default App
</code></pre></codecell></cell><section name=""><cell startpos="214:1-5998" endpos="214:4-6001"><h2 id=""></h2></cell><section name="selection-context"><cell startpos="217:1-6004" endpos="217:21-6024"><h2 id="selection-context">Selection Context</h2></cell><cell startpos="219:1-6026" endpos="221:4-6060" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="cell"><cell startpos="222:1-6061" endpos="222:8-6068"><h2 id="cell">Cell</h2></cell><cell startpos="224:1-6070" endpos="226:4-6092" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="cellmenu"><cell startpos="228:1-6094" endpos="228:13-6106"><h3 id="cellmenu">CellMenu</h3></cell><cell startpos="230:1-6108" endpos="280:4-7742" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">CellMenu.jsx</span></span><pre><code class="jsx">import React, {useState} from &quot;react&quot;
import { MenuIcon, EditIcon, ExecIcon, CloseIcon, SaveIcon } from &#x27;./Icons&#x27;
import { getConsoleForNamespace } from &#x27;../utils/console&#x27;

const console = getConsoleForNamespace(&#x27;CellMenu&#x27;)

const wrapHandler = fn =&gt; ev =&gt; {
    console.log(&quot;Cell menu wrapper&quot;, fn, ev)
    ev.preventDefault()
    ev.stopPropagation()
    if (typeof fn === &#x27;function&#x27;){
        const resp = fn(ev)
        console.log(&quot;Cell menu wrapper fn executed&quot;, resp)
    }
    return false
}

const CellMenu = props =&gt; {

    const [open, setOpen] = useState(false)
    const toggleOpen = wrapHandler(ev =&gt; {
        console.log(&quot;Toggle CellMenu&quot;, open)
        setOpen(!open)
    })

    const items = [
        {title: &quot;Execute&quot;, icon: ExecIcon, handler: wrapHandler(props.execute)}
    ]

    if (!props.editing) items.push({title: &quot;Edit&quot;, icon: EditIcon, handler: wrapHandler(props.toggleEditing)})
    else {
        items.push({title: &quot;Cancel&quot;, icon: CloseIcon, handler: wrapHandler(props.toggleEditing)})
        items.push({title: &quot;Save&quot;, icon: SaveIcon, handler: wrapHandler(props.save)})
    }

    return &lt;menu&gt;
        &lt;ul className=&quot;menu__items&quot;&gt;
            { open &amp;&amp; items.map( item =&gt; {
                const Icon = item.icon
                return &lt;li title={item.title} key={item.title} onClick={item.handler}&gt;&lt;Icon/&gt;&lt;/li&gt;
            })}
            { !open 
                ? &lt;li title=&quot;Open&quot; key=&quot;open&quot; onClick={toggleOpen}&gt;&lt;MenuIcon/&gt;&lt;/li&gt;
                : &lt;li title=&quot;Close&quot; key=&quot;close&quot;onClick={toggleOpen}&gt;&lt;CloseIcon/&gt;&lt;/li&gt; }
        &lt;/ul&gt;
    &lt;/menu&gt;
}

export default CellMenu
</code></pre></codecell></cell><section name="editor"><cell startpos="281:1-7743" endpos="281:10-7752"><h2 id="editor">Editor</h2></cell><cell startpos="283:1-7754" endpos="335:4-9368" class="code"><codecell><span class="meta"><span class="lang">jax</span><span class="repl"></span><span class="filename">Editor.jsx</span></span><pre><code class="jax">import React from &#x27;react&#x27;
import {EditorState, EditorView, basicSetup} from &quot;@codemirror/basic-setup&quot;
import {Compartment} from &#x27;@codemirror/state&#x27;

// import {html} from &quot;@codemirror/lang-html&quot;
// import {oneDark} from &quot;@codemirror/theme-one-dark&quot;

//import {esLint} from &quot;@codemirror/lang-javascript&quot;
// @ts-ignore
//import Linter from &quot;eslint4b-prebuilt&quot;
//import {linter} from &quot;@codemirror/lint&quot;

//import {StreamLanguage} from &quot;@codemirror/stream-parser&quot;
//import {javascript} from &quot;@codemirror/legacy-modes/mode/javascript&quot;

const lineWrapping = new Compartment

export default class Editor extends React.Component {
    constructor(props) {
        super(props)
        this.editorRef = React.createRef();
        this.editorState = window.cms = EditorState.create({
            doc: props.src, 
            extensions: [
                basicSetup,
                EditorView.lineWrapping,
                EditorView.updateListener.of(this.onUpdate.bind(this))
            //   html(),
            //   oneDark
            //  linter(esLint(new Linter)),
            //  StreamLanguage.define(javascript),
            ]
        })
    }

    onUpdate(viewUpdate) {
        if (this.props.update &amp;&amp; typeof this.props.update === &#x27;function&#x27;) {
            this.props.update(viewUpdate.state.doc.toString())
        }
    }

    componentDidMount() {
        this.view = window.cmv = new EditorView({
            state: this.editorState, 
            parent: this.editorRef.current
        })
    }
    render() {
        return &lt;div className=&quot;editor&quot; ref={this.editorRef}&gt;&lt;/div&gt;
    }
}
</code></pre></codecell></cell><section name="icons"><cell startpos="337:1-9370" endpos="337:9-9378"><h2 id="icons">Icons</h2></cell><cell startpos="339:1-9380" endpos="353:4-10070" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">Icons.jsx</span></span><pre><code class="jsx">import React from &#x27;react&#x27;;
import { FontAwesomeIcon } from &#x27;@fortawesome/react-fontawesome&#x27;
import { faBars, faPlay, faEdit, faTimes, faSave } from &#x27;@fortawesome/free-solid-svg-icons&#x27;

export const Icon = (props) =&gt; {
  return &lt;FontAwesomeIcon icon={props.name} /&gt;
}

export const MenuIcon = props =&gt; (&lt;FontAwesomeIcon icon={faBars} {...props} /&gt;)
export const EditIcon = props =&gt; (&lt;FontAwesomeIcon icon={faEdit} {...props} /&gt;)
export const ExecIcon = props =&gt; (&lt;FontAwesomeIcon icon={faPlay} {...props} /&gt;)
export const CloseIcon = props =&gt; (&lt;FontAwesomeIcon icon={faTimes} {...props} /&gt;)
export const SaveIcon = props =&gt; (&lt;FontAwesomeIcon icon={faSave} {...props} /&gt;)
</code></pre></codecell></cell><section name="code"><cell startpos="355:1-10072" endpos="355:8-10079"><h2 id="code">Code</h2></cell><cell startpos="357:1-10081" endpos="377:4-10801" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">CodeMeta.jsx</span></span><pre><code class="jsx">import React from &#x27;react&#x27;

export const CodeMeta = props =&gt; {
        return &lt;span className=&quot;meta&quot;&gt;
            &lt;span className=&quot;lang&quot;&gt;{props.meta.lang}&lt;/span&gt;
            &lt;span className=&quot;repl&quot;&gt;{props.meta.repl}&lt;/span&gt;
            &lt;span className=&quot;filename&quot;&gt;{props.meta.filename}&lt;/span&gt;

            {props.meta.tags &amp;&amp; &lt;ul className=&quot;tags&quot;&gt;{
                props.meta.tags.map( (tag, i) =&gt; &lt;li key={tag+i}&gt;&lt;span className=&quot;tag&quot;&gt;{tag}&lt;/span&gt;&lt;/li&gt;)
            }&lt;/ul&gt;}

            {props.meta.directives &amp;&amp; &lt;ul className=&quot;directives&quot;&gt;{
                
props.meta.directives.map( (dir, i) =&gt; &lt;li key={dir+1}&gt;&lt;span className=&quot;directive&quot;&gt;{dir}&lt;/span&gt;&lt;/li&gt;)
            }&lt;/ul&gt;}
        &lt;/span&gt;
}

</code></pre></codecell></cell><cell startpos="380:1-10804" endpos="436:4-12875" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">base/Codeblock.jsx</span></span><pre><code class="jsx">import React from &#x27;react&#x27;
import {log, level} from &#x27;../../utils/console&#x27;
import { getConsoleForNamespace } from &#x27;../../utils/console&#x27;
import Highlight from &#x27;react-highlight.js&#x27;
import {CodeMeta} from &#x27;../CodeMeta&#x27;
const console = getConsoleForNamespace(&#x27;codeblocks&#x27;)


const viewers = {
  csv: val =&gt; {
    // return &lt;pre&gt;//CSV Viewer\n{val}&lt;/pre&gt;

    const rows = val.split(&quot;\n&quot;).map( (row,i) =&gt; {
       const cols = row.split(&quot;,&quot;).map( (col,j) =&gt; &lt;td key={j}&gt;{col}&lt;/td&gt;)
       return &lt;tr key={i}&gt;{cols}&lt;/tr&gt;
    })

    return &lt;table&gt;{rows}&lt;/table&gt;
  },
  html: val =&gt; &lt;div dangerouslySetInnerHTML={{__html: val}}&gt;&lt;/div&gt;,
  svg: val =&gt; &lt;div dangerouslySetInnerHTML={{__html: val}}&gt;&lt;/div&gt;,
  uri: val =&gt; &lt;iframe src={val}&gt;&lt;/iframe&gt;,
}

const getViewer = meta =&gt; {
  return meta &amp;&amp; (meta.isOutput || (meta.directives &amp;&amp; meta.directives.indexOf(&#x27;inline&#x27;) &gt;= 0)) &amp;&amp; viewers[meta.lang]
}

export default class Codeblock extends React.Component {
    render() {
        
        const codeNode = this.props.node.children
                            &amp;&amp; this.props.node.children.length == 1
                            &amp;&amp; this.props.node.children[0].tagName === &#x27;code&#x27;
                            ? this.props.node.children[0] 
                            : null;
        const meta = codeNode ? codeNode.properties.meta : null
        const viewer = getViewer(meta)
       
        if (codeNode) {const source = codeNode.children[0].value
            console.log(&quot;[Codeblock]&quot;, meta)
            return &lt;codecell&gt;
                { meta &amp;&amp; &lt;CodeMeta meta={meta}/&gt; }
                { viewer 
                  ? viewer(source)
                  : meta &amp;&amp; meta.isOutput
                    ? &lt;output&gt;&lt;Highlight language={meta.lang}&gt;{source}&lt;/Highlight&gt;&lt;/output&gt;
                    : &lt;Highlight language={meta.lang}&gt;{source}&lt;/Highlight&gt; }
            &lt;/codecell&gt;
        } else {
            console.log(&quot;Default codeblock&quot;, this.props.node.children[0])
            return &lt;codecell&gt;&lt;pre&gt;{this.props.children}&lt;/pre&gt;&lt;/codecell&gt;
        }
    }
}
</code></pre></codecell></cell><section name="link"><cell startpos="438:1-12877" endpos="438:8-12884"><h2 id="link">Link</h2></cell><cell startpos="440:1-12886" endpos="458:4-13361" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">base/Link.jsx</span></span><pre><code class="jsx">import React from &#x27;react&#x27;
import { getConsoleForNamespace } from &#x27;../../utils/console&#x27;

const console = getConsoleForNamespace(&#x27;Link&#x27;)

const Link = props =&gt; {
    const title = props.node.properties.title
    console.log(&quot;&lt;Link/&gt;&quot;, props)
    return &lt;a className={props.className}
        href={props.href}
        title={title}
        wikilink={props.wikilink ? &#x27;true&#x27; : undefined}&gt;
            {props.children}
        &lt;/a&gt;
}

export default Link
</code></pre></codecell></cell><section name="backlinks"><cell startpos="460:1-13363" endpos="460:13-13375"><h2 id="backlinks">Backlinks</h2></cell><cell startpos="462:1-13377" endpos="478:4-13867" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename">Backlinks.jsx</span></span><pre><code class="jsx">import React from &#x27;react&#x27;
import path from &#x27;path&#x27;

export default class Backlinks extends React.Component {
    render() {
        return &lt;&gt;
            &lt;h4&gt;{`Backlinks (${this.props.links.length})`}&lt;/h4&gt;
            &lt;ol&gt;
                {this.props.links.map( (link) =&gt; {
                    return  &lt;li key={link.url}&gt;&lt;a title={link.title} href={path.join(this.props.root, link.url)}&gt;{link.title}&lt;/a&gt;&lt;/li&gt;
                })}
            &lt;/ol&gt;
        &lt;/&gt;
    }
}
</code></pre></codecell></cell></section></section></section></section></section></section></section></section></section></section></section></section></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>