<html data-reactroot=""><head><title>components</title><meta name="litsrc" value="components/components.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="app"><div id="header"><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a><span>|</span></li><li class="MenuItems"><menu class=""><li class="MenuTitle">File</li></menu><menu class=""><li class="MenuTitle">Cell</li></menu><menu class=""><li class="MenuTitle">Section</li></menu><menu class=""><li class="MenuTitle">Help</li></menu></li></menu></div><div id="content"><section name="react-components"><cell startpos="3:1-2" endpos="5:7-28"><h1 id="react-components">React Components</h1><p>A list</p></cell><section name="table-of-contents"><cell startpos="7:1-30" endpos="7:21-50"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#document">Document</a></p>
</li>
<li>
<p><a href="#header">Header</a></p>
</li>
<li>
<p><a href="#app">App</a></p>
</li>
<li>
<p><a href="#selection-context">Selection Context</a></p>
</li>
<li>
<p><a href="#cell">Cell</a></p>
<ul>
<li><a href="#cellmenu">CellMenu</a></li>
</ul>
</li>
<li>
<p><a href="#editor">Editor</a></p>
</li>
<li>
<p><a href="#icons">Icons</a></p>
</li>
<li>
<p><a href="#code">Code</a></p>
</li>
<li>
<p><a href="#link">Link</a></p>
</li>
<li>
<p><a href="#backlinks">Backlinks</a></p>
</li>
</ul></cell><section name="document"><cell startpos="9:1-52" endpos="9:12-63"><h2 id="document">Document</h2></cell><cell startpos="11:1-65" endpos="13:4-91" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="header"><cell startpos="15:1-93" endpos="15:10-102"><h2 id="header">Header</h2></cell><cell startpos="17:1-104" endpos="19:4-128" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="app"><cell startpos="20:1-129" endpos="20:7-135"><h2 id="app">App</h2></cell><cell startpos="22:1-137" endpos="92:4-2630" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx">import React, {useState} from &#x27;react&#x27;
import path from &#x27;path&#x27;
import SelectionContext from &#x27;./SelectionContext&#x27;
import patchSource from &#x27;../utils/unist-util-patch-source&#x27;
import { processor } from &#x27;../renderer&#x27;
import { getConsoleForNamespace } from &#x27;../utils/console&#x27;
import filter from &#x27;unist-util-filter&#x27;
import {atPos} from &#x27;../utils/unist-util-select-position&#x27;
import {selectAll} from &#x27;unist-util-select&#x27;

const console = getConsoleForNamespace(&#x27;App&#x27;)

const App = ({file, fs, result}) =&gt; {

    const [srcAndRes, setSrcAndRes] = useState({
        src: file.contents.toString(),
        res: result
    })
    const [res, setResult] = useState(result)
    const [selectedCell, setSelectedCell] = useState(null)
    
    const setSrcWrapper = async (pos, cellSource) =&gt; {
        console.log(&quot;&lt;App/&gt; Set src wrapper&quot;, pos, cellSource)
        const patchedSrc = patchSource(srcAndRes.src, pos, cellSource.trimEnd())
        
        file.contents = patchedSrc
        const processedFile = await processor(fs).process(file)
        console.log(&quot;Processed client&quot;, processedFile)
        setSrcAndRes({
            src: patchedSrc,
            res: processedFile.result
        })

        try {
            await fs.writeFile(file.path, patchedSrc, {encoding: &#x27;utf8&#x27;})
        } catch (err) {
            console.log(&quot;Failed to write file source to fs&quot;, file.path, err)
        }
        
        const tmpEnd = {line: pos.start.line + cellSource.split(&#x27;\n&#x27;).length }
        const tmpPos = {start: pos.start, end: tmpEnd }
        const tree = filter(processedFile.data.ast, atPos(tmpPos))
        const nodes = selectAll(&#x27;code&#x27;, tree)
        console.log(&quot;[CodeCells in Change (pos)]&quot;, tmpPos, file.path, tree, nodes)
        for (const codeCell of nodes) {
            const filename = codeCell.data &amp;&amp; codeCell.data.meta &amp;&amp; codeCell.data.meta.filename
            if (filename) {
                const filepath = path.join( path.dirname(file.path), filename)
                await fs.writeFile(filepath, codeCell.value)
                console.log(`Wrote codefile ${filename} to &quot;${filepath}&quot; on disk`)
            }
       }
    }

    const state = {
      src: srcAndRes.src, 
      selectedCell, 
      setSelectedCell, 
      setSrc: setSrcWrapper
    }

    console.log(&#x27;&lt;App/&gt; render&#x27;, selectedCell)

    return &lt;SelectionContext.Provider value={state}&gt;
        &lt;div id=&quot;content&quot;&gt;{srcAndRes.res}&lt;/div&gt;
    &lt;/SelectionContext.Provider&gt;
}

export default App
</code></pre></codecell></cell><section name=""><cell startpos="93:1-2631" endpos="93:4-2634"><h2 id=""></h2></cell><section name="selection-context"><cell startpos="96:1-2637" endpos="96:21-2657"><h2 id="selection-context">Selection Context</h2></cell><cell startpos="98:1-2659" endpos="100:4-2693" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="cell"><cell startpos="101:1-2694" endpos="101:8-2701"><h2 id="cell">Cell</h2></cell><cell startpos="103:1-2703" endpos="105:4-2725" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="cellmenu"><cell startpos="107:1-2727" endpos="107:13-2739"><h3 id="cellmenu">CellMenu</h3></cell><cell startpos="109:1-2741" endpos="111:4-2767" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="editor"><cell startpos="112:1-2768" endpos="112:10-2777"><h2 id="editor">Editor</h2></cell><cell startpos="114:1-2779" endpos="116:4-2803" class="code"><codecell><span class="meta"><span class="lang">jax</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jax"></code></pre></codecell></cell><section name="icons"><cell startpos="118:1-2805" endpos="118:9-2813"><h2 id="icons">Icons</h2></cell><cell startpos="120:1-2815" endpos="122:4-2838" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="code"><cell startpos="124:1-2840" endpos="124:8-2847"><h2 id="code">Code</h2></cell><cell startpos="126:1-2849" endpos="128:4-2875" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><cell startpos="131:1-2878" endpos="133:4-2910" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="link"><cell startpos="135:1-2912" endpos="135:8-2919"><h2 id="link">Link</h2></cell><cell startpos="137:1-2921" endpos="139:4-2948" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell><section name="backlinks"><cell startpos="141:1-2950" endpos="141:13-2962"><h2 id="backlinks">Backlinks</h2></cell><cell startpos="143:1-2964" endpos="145:4-2991" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="repl"></span><span class="filename"></span></span><pre><code class="jsx"></code></pre></codecell></cell></section></section></section></section></section></section></section></section></section></section></section></section></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>