<html data-reactroot=""><head><title>testing/esm_viewer_repl.lit</title><meta name="litsrc" value="testing/esm_viewer_repl.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu><div class="lit-messages"></div></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="96:4-2197"><cell startpos="1:1-0" endpos="3:48-78"><div class="cell-content"><h1 id="testingesm_viewer_repllit">testing/esm_viewer_repl.lit</h1><p>File not <em>yet</em> found, edit this to change that.</p></div></cell><section depth="3" class="" startpos="4:1-79" endpos="96:4-2197"><cell startpos="4:1-79" endpos="16:72-297"><div class="cell-content"><h3 id="viewer-repl">Viewer REPL</h3><p>What if <strong>REPLs</strong> were just custom viewers <a href="renderer/viewers.html?file=renderer/viewers.lit" title="renderer/viewers" wikilink="true">renderer/viewers</a>? Implementing clientside execution via custom <code>!viewer</code>.</p><p>useEffect for execution on load otherwise require button press to exec.</p></div></cell><cell startpos="18:1-299" endpos="49:4-1205" class="code"><div class="cell-content"><codecell class="dir-plugin lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#c5476f" class="directive dir-plugin">plugin</span><span class="attribute attr-of" style="color:black;background-color:#00dd70">of=esm</span></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rce = React.createElement
  const {useState, useEffect} = React
  const [resp, setResp] = useState(null)
  const [run, setRun] = useState(0)
  
  const exec = ev =&gt; {
    ev &amp;&amp; ev.stopPropagation()
    setRun(run+1)
    load(node.data.value)
    return false
  }

  useEffect( args =&gt; {
    if(run===0 &amp;&amp; node.properties.meta.exec===&quot;onload&quot;)
       exec()
  },[])

  async function load(src) {
    const val = `//run: ${run}\n${src}`
    const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
    if (typeof module.returns === &#x27;function&#x27;) setResp(await module.returns(run))
    else if (module.returns) setResp(module.returns)
  }

  const btn = rce(&#x27;button&#x27;, {onClick: exec}, &quot;Run &quot; + run)
  const t = rce(&#x27;div&#x27;, null, [btn, resp])
  return t
}
if(typeof module !== &quot;undefined&quot;) module.exports.viewer = viewer
</code></pre></codecell></div></cell><cell startpos="50:1-1206" endpos="56:4-1312" class="code"><div class="cell-content"><codecell class="dir-below lang-esm local"><span class="meta"><span class="lang">esm</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="esm">function foo(baz) {
  alert(&quot;foo II&quot;)
  return &quot;bar:&quot; + baz
}
export const returns = foo
</code></pre><div><button>Run 0</button></div></codecell></div></cell><cell startpos="57:1-1313" endpos="66:4-1517" class="code"><div class="cell-content"><codecell class="dir-below lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-viewer" style="color:black;background-color:#cf5332">viewer=esm</span></span><pre><code class="js">import confetti from &#x27;https://cdn.skypack.dev/canvas-confetti&#x27;

export const returns = run =&gt; confetti({
  origin: {y: 0},
  spread: 55,
  particleCount: 100,
  ticks: 1000,
})
</code></pre><div><button>Run 0</button></div></codecell></div></cell><cell startpos="68:1-1519" endpos="68:37-1555"><div class="cell-content"><p>Setting <code>exec</code> attribute to <code>onload</code></p></div></cell><cell startpos="70:1-1557" endpos="76:4-1699" class="code"><div class="cell-content"><codecell class="dir-below lang-esm local"><span class="meta"><span class="lang">esm</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span><span class="attribute attr-exec" style="color:black;background-color:#02fb89">exec=onload</span></span><pre><code class="esm">function output(num) {
  alert(&quot;execd onload!&quot;)
  return &quot;done: &quot; + new Date()
}
export const returns = output()
</code></pre><div><button>Run 0</button></div></codecell></div></cell><cell startpos="79:1-1702" endpos="79:66-1767"><div class="cell-content"><p>Cannot <em>yet</em> output raw DOM nodes, due to react setup of viewers.</p></div></cell><cell startpos="81:1-1769" endpos="88:4-1936" class="code"><div class="cell-content"><codecell class="dir-below lang-esm local"><span class="meta"><span class="lang">esm</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="esm">function output(num) {
  const dom = document.createElement(&quot;pre&quot;)
  dom.innerHTML = `Run number ${num}`
  return dom
}
export const returns = output
</code></pre><div><button>Run 0</button></div></codecell></div></cell><cell startpos="90:1-1938" endpos="90:155-2092"><div class="cell-content"><p>So far so good, the only issue is that output is entirely ephemeral, how would we enable document modification, ie persist the output as an attached cell.</p></div></cell><cell startpos="92:1-2094" endpos="96:4-2197" class="code"><div class="cell-content"><codecell class="dir-below lang-esm local"><span class="meta"><span class="lang">esm</span><span style="color:white;background-color:#5948c3" class="directive dir-below">below</span></span><pre><code class="esm">import git from &#x27;https://cdn.skypack.dev/isomorphic-git&#x27;

export const returns = git 
</code></pre><div><button>Run 0</button></div></codecell></div></cell></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="ðŸ”¬ Tests, experiments and investigations" href="/testing/index.html">ðŸ”¬ Tests, experiments and investigations</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script async="" src="/web.bundle.js"></script></body></html>