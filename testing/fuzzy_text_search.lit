# Fuzzy text search

Related

- [[testing/compact_manifest]]

## Fuse.js

https://fusejs.io/

```js !collapse #intro
return (async (fn) => {
  const { default: Fuse } = await import(
    "https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.esm.js"
  );
  const manifest = await fetch("/manifest.json").then((res) => res.json());
  const fuse = new Fuse(manifest.nodes, {
    includeScore: true,
    keys: ["title", "id"],
  });

  // 3. Now search!
  return fuse.search("../../..",{limit:5});
})();

```
```js > md

const t = Date.now()
return (async (fn) => {
  const { default: Fuse } = await import(
    "https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.esm.js"
  );
  // const manifest = await fetch("/manifest.json").then((res) => res.json());

  const fullLocal = await (async (fn) => {
    const path = lit.utils.path;
    const all = []
    const visit = async (root) => {
      const list = await lit.fs.readdir(root);
      return Promise.all(
        list.map(async (key) => {
          const pathname = path.join(root, key);
          const stat = await lit.fs.stat(pathname);
          let contents;
          if (key === ".git" || !key) {
          } else if (stat.type === "dir") await visit(pathname);
          else if (pathname.endsWith('.lit')) contents = (await lit.fs.readFile(pathname, { encoding: "utf8",localOnly: true }))//.slice(0,10);
          const item = { pathname, type: stat.type, contents }
          all.push(item);
          return item
        })
      );
    };

    await visit("/")
    return all
  })();

  // return fullLocal

  const fuse = new Fuse(fullLocal, {
    ignoreLocation: true,
    includeScore: true,
    includeMatches: true,
    ignoreFieldNorm: true,
    keys: ["pathname", "contents"],
  });


  // 3. Now search!
const query = "agora"
  return `**Results for search *"${query}"*. In ${(Date.now()-t) / 1000} seconds.**\n\n` + fuse.search(query, { limit: 15 })
        //.map(x=>x.matches.map(x=>x.indices))
        .map(x=>[x.score, x.item.pathname,x.refIndex])
        .map(([score,pathname,index]) => `- [${pathname}](${pathname}) ${score}`)
        .join('\n');
})();

```
```>md attached=true updated=1621862681905
**Results for search *"agora"*.**

- [/testing/fuzzy_text_search.lit](/testing/fuzzy_text_search.lit) 0.0006
- [/articles/ideas_for.lit](/articles/ideas_for.lit) 0.0006
- [/testing/lightningfs.lit](/testing/lightningfs.lit) 0.001
- [/testing/log/2021-05-23.lit](/testing/log/2021-05-23.lit) 0.001
- [/scratch_pad.lit](/scratch_pad.lit) 0.24
- [/prismjs_and_a_simple_editor.lit](/prismjs_and_a_simple_editor.lit) 0.24
- [/testing/web_workers.lit](/testing/web_workers.lit) 0.24
- [/testing/autoformatting_cell_source.lit](/testing/autoformatting_cell_source.lit) 0.24
- [/testing/isomorphic_git.lit](/testing/isomorphic_git.lit) 0.24
- [/testing/importing_js_modules.lit](/testing/importing_js_modules.lit) 0.24
- [/testing/serviceworker.lit](/testing/serviceworker.lit) 0.24
- [/testing/runkit.lit](/testing/runkit.lit) 0.24
- [/divergence_from_markdown.lit](/divergence_from_markdown.lit) 0.36
- [/testing/local_remote_files.lit](/testing/local_remote_files.lit) 0.36
- [/meta/github_workflows.lit](/meta/github_workflows.lit) 0.36
```





## FuzzySet

https://github.com/Glench/fuzzyset.js

```js
return import('https://cdn.skypack.dev/fuzzyset').then( FuzzySet => {

  const f = new FuzzySet.default()
  f.add("the text of mine")
  f.add("the text of someone else")
  f.add("other texts")
  return f.get("text of")
})

```
```>txt attached=true updated=1621778112764
[ [ 0.4375, 'the text of mine' ] ]
```