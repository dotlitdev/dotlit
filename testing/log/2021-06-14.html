<html data-reactroot=""><head><title>2021-06-14</title><meta name="litsrc" value="/testing/log/2021-06-14.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><div><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"></li></menu></div><div class="lit-messages"></div></div><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/sunburst.min.css"/><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="351:4-10414"><cell startpos="1:1-0" endpos="1:13-12"><div class="cell-content"><h1 id="2021-06-14">2021-06-14</h1></div></cell><section depth="2" class="" startpos="3:1-14" endpos="351:4-10414"><cell startpos="3:1-14" endpos="6:73-300"><div class="cell-content"><h2 id="a-geo-hash">A Geo Hash</h2><blockquote>
<p>Earth&#x27;s circumference is the distance around Earth. Measured around the Equator, it is 40,075.017 km (24,901.461 mi). Measured around the poles, the circumference is 40,007.863 km (24,859.734 mi).
— <a class="external" href="https://en.m.wikipedia.org/wiki/Earth%27s_circumference" filepath="/testing/log/2021-06-14.lit" root="" data="[object Object]" canonical="https://en.m.wikipedia.org/wiki/Earth%27s_circumference">Wikipedia<span class="linkIcon">↗</span></a></p>
</blockquote></div></cell><cell startpos="8:1-302" endpos="13:4-411" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return 40075017 / Math.pow(2,25)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">13.8h ago</span></span></span><output><pre><code class="txt">1.1943285763263702
</code></pre></output></codecell></div></cell><cell startpos="15:1-413" endpos="15:132-544"><div class="cell-content"><p>The circumference <code>c</code> of the earth at the equator in meters, divided by two, twenty five times is roughly one point two meters <code>s</code>.</p></div></cell><cell startpos="17:1-546" endpos="26:4-803" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const c = 40075017
const s = 1.1943285763263702
const n = c / s
const dlon = 360 / n
return `${n} segments of ${dlon} degrees longitude`
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">23h ago</span></span></span><output><pre><code class="txt">33554432 segments of 0.000010728836059570312 degrees longitude
</code></pre></output></codecell></div></cell><cell startpos="28:1-805" endpos="30:100-987"><div class="cell-content"><p>If for each division we stored &quot;left&quot; (0) or &quot;right&quot; (1) as a binary with 25 bits</p><p>Which if we always picked the &quot;right&quot; half of the split would give a maximum binary string like so:</p></div></cell><cell startpos="32:1-989" endpos="37:4-1103" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return parseInt(&quot;111111111111111111111111&quot;, 2);
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">1d ago</span></span></span><output><pre><code class="txt">16777215
</code></pre></output></codecell></div></cell><cell startpos="39:1-1105" endpos="39:52-1156"><div class="cell-content"><p>Coincidentally the max hex representation. is then:</p></div></cell><cell startpos="41:1-1158" endpos="46:4-1253" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return (16777215).toString(16)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">23.8h ago</span></span></span><output><pre><code class="txt">ffffff
</code></pre></output></codecell></div></cell><cell startpos="50:1-1257" endpos="245:4-6863" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = 360 / n
const dLat = 180 / n

const binToInt = str =&gt; parseInt(str,2)
const intToHex = num =&gt; num.toString(16)

const normLat = lat =&gt; lat + 90
const normLon = lon =&gt; lon + 180

const geo2hash = (lat,lon) =&gt; {
  const bins = [&#x27;&#x27;,&#x27;&#x27;]
  let [a,b] = [normLat(lat), normLon(lon)]
  console.log({normalised: [a,b]})
  let [minLatS,maxLatS,minLonS,maxLonS] = [0,180,0,360]
  for (var I=0;I&lt;x;I++) {
    const latDiv = minLatS + (maxLatS-minLatS)/2
    const lonDiv = minLonS + (maxLonS-minLonS)/2
    console.log({I, d: [minLatS,maxLatS,minLonS,maxLonS], divs:[latDiv,lonDiv]})
    if (a &lt; latDiv){
      maxLatS = maxLatS - ((maxLatS-minLatS)/2)
      bins[0] += &quot;0&quot;
    } else {
      minLatS = minLatS + ((maxLatS-minLatS)/2)
      bins[0] += &quot;1&quot;
    }
    if (b &lt; lonDiv){
      maxLonS = maxLonS - ((maxLonS-minLonS)/2)
      bins[1] += &quot;0&quot;
    } else {
      minLonS = minLonS + ((maxLonS-minLonS)/2)
      bins[1] += &quot;1&quot;
    }
    console.log(bins)
  }
  const ints = bins.map( bin =&gt; binToInt(bin))
  const hexs = ints.map( i =&gt; intToHex(i))
  console.log({lat,lon,dLon,dLat,n,x,ints,hexs, bins})
  return hexs.join(&#x27;x&#x27;)
}

return geo2hash(30,30)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">7m ago</span></span></span><output><pre><code class="txt">{ normalised: [ 120, 210 ] }
{ I: 0, d: [ 0, 180, 0, 360 ], divs: [ 90, 180 ] }
[ &#x27;1&#x27;, &#x27;1&#x27; ]
{ I: 1, d: [ 90, 180, 180, 360 ], divs: [ 135, 270 ] }
[ &#x27;10&#x27;, &#x27;10&#x27; ]
{ I: 2, d: [ 90, 135, 180, 270 ], divs: [ 112.5, 225 ] }
[ &#x27;101&#x27;, &#x27;100&#x27; ]
{ I: 3, d: [ 112.5, 135, 180, 225 ], divs: [ 123.75, 202.5 ] }
[ &#x27;1010&#x27;, &#x27;1001&#x27; ]
{ I: 4,
  d: [ 112.5, 123.75, 202.5, 225 ],
  divs: [ 118.125, 213.75 ] }
[ &#x27;10101&#x27;, &#x27;10010&#x27; ]
{ I: 5,
  d: [ 118.125, 123.75, 202.5, 213.75 ],
  divs: [ 120.9375, 208.125 ] }
[ &#x27;101010&#x27;, &#x27;100101&#x27; ]
{ I: 6,
  d: [ 118.125, 120.9375, 208.125, 213.75 ],
  divs: [ 119.53125, 210.9375 ] }
[ &#x27;1010101&#x27;, &#x27;1001010&#x27; ]
{ I: 7,
  d: [ 119.53125, 120.9375, 208.125, 210.9375 ],
  divs: [ 120.234375, 209.53125 ] }
[ &#x27;10101010&#x27;, &#x27;10010101&#x27; ]
{ I: 8,
  d: [ 119.53125, 120.234375, 209.53125, 210.9375 ],
  divs: [ 119.8828125, 210.234375 ] }
[ &#x27;101010101&#x27;, &#x27;100101010&#x27; ]
{ I: 9,
  d: [ 119.8828125, 120.234375, 209.53125, 210.234375 ],
  divs: [ 120.05859375, 209.8828125 ] }
[ &#x27;1010101010&#x27;, &#x27;1001010101&#x27; ]
{ I: 10,
  d: [ 119.8828125, 120.05859375, 209.8828125, 210.234375 ],
  divs: [ 119.970703125, 210.05859375 ] }
[ &#x27;10101010101&#x27;, &#x27;10010101010&#x27; ]
{ I: 11,
  d: [ 119.970703125, 120.05859375, 209.8828125, 210.05859375 ],
  divs: [ 120.0146484375, 209.970703125 ] }
[ &#x27;101010101010&#x27;, &#x27;100101010101&#x27; ]
{ I: 12,
  d: [ 119.970703125, 120.0146484375, 209.970703125, 210.05859375 ],
  divs: [ 119.99267578125, 210.0146484375 ] }
[ &#x27;1010101010101&#x27;, &#x27;1001010101010&#x27; ]
{ I: 13,
  d: [ 119.99267578125, 120.0146484375, 209.970703125, 210.0146484375 ],
  divs: [ 120.003662109375, 209.99267578125 ] }
[ &#x27;10101010101010&#x27;, &#x27;10010101010101&#x27; ]
{ I: 14,
  d: 
   [ 119.99267578125,
     120.003662109375,
     209.99267578125,
     210.0146484375 ],
  divs: [ 119.9981689453125, 210.003662109375 ] }
[ &#x27;101010101010101&#x27;, &#x27;100101010101010&#x27; ]
{ I: 15,
  d: 
   [ 119.9981689453125,
     120.003662109375,
     209.99267578125,
     210.003662109375 ],
  divs: [ 120.00091552734375, 209.9981689453125 ] }
[ &#x27;1010101010101010&#x27;, &#x27;1001010101010101&#x27; ]
{ I: 16,
  d: 
   [ 119.9981689453125,
     120.00091552734375,
     209.9981689453125,
     210.003662109375 ],
  divs: [ 119.99954223632812, 210.00091552734375 ] }
[ &#x27;10101010101010101&#x27;, &#x27;10010101010101010&#x27; ]
{ I: 17,
  d: 
   [ 119.99954223632812,
     120.00091552734375,
     209.9981689453125,
     210.00091552734375 ],
  divs: [ 120.00022888183594, 209.99954223632812 ] }
[ &#x27;101010101010101010&#x27;, &#x27;100101010101010101&#x27; ]
{ I: 18,
  d: 
   [ 119.99954223632812,
     120.00022888183594,
     209.99954223632812,
     210.00091552734375 ],
  divs: [ 119.99988555908203, 210.00022888183594 ] }
[ &#x27;1010101010101010101&#x27;, &#x27;1001010101010101010&#x27; ]
{ I: 19,
  d: 
   [ 119.99988555908203,
     120.00022888183594,
     209.99954223632812,
     210.00022888183594 ],
  divs: [ 120.00005722045898, 209.99988555908203 ] }
[ &#x27;10101010101010101010&#x27;, &#x27;10010101010101010101&#x27; ]
{ I: 20,
  d: 
   [ 119.99988555908203,
     120.00005722045898,
     209.99988555908203,
     210.00022888183594 ],
  divs: [ 119.99997138977051, 210.00005722045898 ] }
[ &#x27;101010101010101010101&#x27;, &#x27;100101010101010101010&#x27; ]
{ I: 21,
  d: 
   [ 119.99997138977051,
     120.00005722045898,
     209.99988555908203,
     210.00005722045898 ],
  divs: [ 120.00001430511475, 209.9999713897705 ] }
[ &#x27;1010101010101010101010&#x27;, &#x27;1001010101010101010101&#x27; ]
{ I: 22,
  d: 
   [ 119.99997138977051,
     120.00001430511475,
     209.9999713897705,
     210.00005722045898 ],
  divs: [ 119.99999284744263, 210.00001430511475 ] }
[ &#x27;10101010101010101010101&#x27;, &#x27;10010101010101010101010&#x27; ]
{ I: 23,
  d: 
   [ 119.99999284744263,
     120.00001430511475,
     209.9999713897705,
     210.00001430511475 ],
  divs: [ 120.00000357627869, 209.99999284744263 ] }
[ &#x27;101010101010101010101010&#x27;, &#x27;100101010101010101010101&#x27; ]
{ I: 24,
  d: 
   [ 119.99999284744263,
     120.00000357627869,
     209.99999284744263,
     210.00001430511475 ],
  divs: [ 119.99999821186066, 210.0000035762787 ] }
[ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ]
{ lat: 30,
  lon: 30,
  dLon: 0.000010728836059570312,
  dLat: 0.000005364418029785156,
  n: 33554432,
  x: 25,
  ints: [ 22369621, 19573418 ],
  hexs: [ &#x27;1555555&#x27;, &#x27;12aaaaa&#x27; ],
  bins: [ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ] }
1555555x12aaaaa
</code></pre></output></codecell></div></cell><cell startpos="247:1-6865" endpos="322:4-9650" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = 360 / n
const dLat = 180 / n
const blank = Array(x).fill(&quot;0&quot;).join(&#x27;&#x27;)

const hash2geo = hash =&gt; {
  const hexs = hash.split(&#x27;x&#x27;)
  const ints = hexs.map(h =&gt; parseInt(h,16))
  const bins = ints.map( i =&gt; i.toString(2)).map(b =&gt; blank.slice(0, 0-b.length) + b)
  
  let [minLat,maxLat] = [0, n]
  let [minLon,maxLon] = [0, n]
  for (var I=0;I&lt;x;I++) {
    const a = parseInt(bins[0][I])
    const b = parseInt(bins[1][I])

    if (a) {
       minLat = (minLat + ((maxLat-minLat)/2))
    } else {
       maxLat = (maxLat - (maxLat-minLat)/2)
    }
    if (b) {
       minLon = (minLon + ((maxLon-minLon)/2))
    } else {
       maxLon = (maxLon - (maxLon-minLon)/2)
    }
    console.log({I,d: [minLat,maxLat,minLon,maxLon]})
  }

  [minLat,maxLat] = [minLat,maxLat].map(y=&gt;(y*dLat)-90)
  [minLon,maxLon] = [minLon,maxLon].map(y=&gt;(y*dLon)-180)
  
  return {x,hash,ints,hexs,bins, minLat,maxLat,minLon,maxLon}
}
return hash2geo(&quot;1555555x12aaaaa&quot;)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">1m ago</span></span></span><output><pre><code class="txt">{ I: 0, d: [ 16777216, 33554432, 16777216, 33554432 ] }
{ I: 1, d: [ 16777216, 25165824, 16777216, 25165824 ] }
{ I: 2, d: [ 20971520, 25165824, 16777216, 20971520 ] }
{ I: 3, d: [ 20971520, 23068672, 18874368, 20971520 ] }
{ I: 4, d: [ 22020096, 23068672, 18874368, 19922944 ] }
{ I: 5, d: [ 22020096, 22544384, 19398656, 19922944 ] }
{ I: 6, d: [ 22282240, 22544384, 19398656, 19660800 ] }
{ I: 7, d: [ 22282240, 22413312, 19529728, 19660800 ] }
{ I: 8, d: [ 22347776, 22413312, 19529728, 19595264 ] }
{ I: 9, d: [ 22347776, 22380544, 19562496, 19595264 ] }
{ I: 10, d: [ 22364160, 22380544, 19562496, 19578880 ] }
{ I: 11, d: [ 22364160, 22372352, 19570688, 19578880 ] }
{ I: 12, d: [ 22368256, 22372352, 19570688, 19574784 ] }
{ I: 13, d: [ 22368256, 22370304, 19572736, 19574784 ] }
{ I: 14, d: [ 22369280, 22370304, 19572736, 19573760 ] }
{ I: 15, d: [ 22369280, 22369792, 19573248, 19573760 ] }
{ I: 16, d: [ 22369536, 22369792, 19573248, 19573504 ] }
{ I: 17, d: [ 22369536, 22369664, 19573376, 19573504 ] }
{ I: 18, d: [ 22369600, 22369664, 19573376, 19573440 ] }
{ I: 19, d: [ 22369600, 22369632, 19573408, 19573440 ] }
{ I: 20, d: [ 22369616, 22369632, 19573408, 19573424 ] }
{ I: 21, d: [ 22369616, 22369624, 19573416, 19573424 ] }
{ I: 22, d: [ 22369620, 22369624, 19573416, 19573420 ] }
{ I: 23, d: [ 22369620, 22369622, 19573418, 19573420 ] }
{ I: 24, d: [ 22369621, 22369622, 19573418, 19573419 ] }
{ x: 25,
  hash: &#x27;1555555x12aaaaa&#x27;,
  ints: [ 22369621, 19573418 ],
  hexs: [ &#x27;1555555&#x27;, &#x27;12aaaaa&#x27; ],
  bins: [ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ],
  minLat: 29.999992847442627,
  maxLat: 30.000003576278687,
  minLon: 19573418,
  maxLon: 19573419 }
</code></pre></output></codecell></div></cell><cell startpos="324:1-9652" endpos="351:4-10414" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const x = 25
const n = Math.pow(2, x)
const dLon = 360 / n
const dLat = 180 / n
const mLon = 40075017
const mLat = 40007863

const geo2hash = (lat,lon) =&gt; {
  const nLat = Math.floor((lat+90)/dLat)
  const nLon = Math.floor((lon+180)/dLon)
  console.log({nLat,nLon})
  return `${nLat.toString(16)}x${nLon.toString(16)}`
}
const hash2geo = hash =&gt; {
  const [hLat,hLon] = hash.split(&#x27;x&#x27;).map(x=&gt;parseInt(x,16))
  const lat = (hLat * dLat) - 90
  const lon = (hLon * dLon) - 180
  return { lat: [lat, lat+dLat], lon: [lon,lon+dLon]}
}

return hash2geo(geo2hash(30,30))
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">6.7h ago</span></span></span><output><pre><code class="txt">{ nLat: 22369621, nLon: 19573418 }
{ lat: [ 29.999998211860657, 30.000003576278687 ],
  lon: [ 29.999992847442627, 30.000003576278687 ] }
</code></pre></output></codecell></div></cell></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="meta/files_and_links.lit" href="/meta/files_and_links.html">meta/files_and_links.lit</a></li></ol></div><script>;(function () {
                var src = '//cdn.jsdelivr.net/npm/eruda';
                if (!/eruda=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
                document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
                document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
            })();</script><script async="" src="/web.bundle.js"></script></body></html>