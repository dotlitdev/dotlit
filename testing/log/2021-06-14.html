<html data-reactroot=""><head><title>2021-06-14</title><meta name="litsrc" value="/testing/log/2021-06-14.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><div><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"></li></menu></div><div class="lit-messages"></div></div><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/sunburst.min.css"/><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="220:4-5741"><cell startpos="1:1-0" endpos="1:13-12"><div class="cell-content"><h1 id="2021-06-14">2021-06-14</h1></div></cell><section depth="2" class="" startpos="3:1-14" endpos="220:4-5741"><cell startpos="3:1-14" endpos="6:73-300"><div class="cell-content"><h2 id="a-geo-hash">A Geo Hash</h2><blockquote>
<p>Earth&#x27;s circumference is the distance around Earth. Measured around the Equator, it is 40,075.017 km (24,901.461 mi). Measured around the poles, the circumference is 40,007.863 km (24,859.734 mi).
— <a class="external" href="https://en.m.wikipedia.org/wiki/Earth%27s_circumference" filepath="/testing/log/2021-06-14.lit" root="" data="[object Object]" canonical="https://en.m.wikipedia.org/wiki/Earth%27s_circumference">Wikipedia<span class="linkIcon">↗</span></a></p>
</blockquote></div></cell><cell startpos="8:1-302" endpos="13:4-411" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return 40075017 / Math.pow(2,25)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">3.4h ago</span></span></span><output><pre><code class="txt">1.1943285763263702
</code></pre></output></codecell></div></cell><cell startpos="15:1-413" endpos="15:136-548"><div class="cell-content"><p>The circumference <code>c</code> of the the earth at the equator in meters, divided by two, twenty five times is roughly one point two meters <code>s</code>.</p></div></cell><cell startpos="17:1-550" endpos="26:4-807" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const c = 40075017
const s = 1.1943285763263702
const n = c / s
const dlon = 360 / n
return `${n} segments of ${dlon} degrees longitude`
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">12.6h ago</span></span></span><output><pre><code class="txt">33554432 segments of 0.000010728836059570312 degrees longitude
</code></pre></output></codecell></div></cell><cell startpos="28:1-809" endpos="30:100-991"><div class="cell-content"><p>If for each division we stored &quot;left&quot; (0) or &quot;right&quot; (1) as a binary with 25 bits</p><p>Which if we always picked the &quot;right&quot; half of the split would give a maximum binary string like so:</p></div></cell><cell startpos="32:1-993" endpos="37:4-1107" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return parseInt(&quot;111111111111111111111111&quot;, 2);
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">13.7h ago</span></span></span><output><pre><code class="txt">16777215
</code></pre></output></codecell></div></cell><cell startpos="39:1-1109" endpos="39:52-1160"><div class="cell-content"><p>Coincidentally the max hex representation. is then:</p></div></cell><cell startpos="41:1-1162" endpos="46:4-1257" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return (16777215).toString(16)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">13.4h ago</span></span></span><output><pre><code class="txt">ffffff
</code></pre></output></codecell></div></cell><cell startpos="50:1-1261" endpos="86:4-2131" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = mLon / n
const dLat = mLat / n

const binToInt = str =&gt; parseInt(str,2)
const intToHex = num =&gt; num.toString(16)

const normLat = lat =&gt; lat + 90
const normLon = lon =&gt; lon + 180

const geo2hash = (lat,lon) =&gt; {
  const bins = [&#x27;&#x27;,&#x27;&#x27;]
  let [a,b] = [normLat(lat) / dLat, normLon(lon) / dLon]
  let S = n
  for (var I=0;I&lt;x;I++) {
    S = S / 2
    bins[0] += ((a &lt; S) ? &quot;0&quot; : &quot;1&quot;)
    bins[1] += ((b &lt; S) ? &quot;0&quot; : &quot;1&quot;)
  }
  const ints = bins.map( bin =&gt; binToInt(bin))
  const hexs = ints.map( i =&gt; intToHex(i))
  console.log({ints,hexs, bins})
  return hexs.join(&#x27;x&#x27;)
}

return geo2hash(30,30)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">10m ago</span></span></span><output><pre><code class="txt">{ ints: [ 127, 255 ],
  hexs: [ &#x27;7f&#x27;, &#x27;ff&#x27; ],
  bins: [ &#x27;0000000000000000001111111&#x27;, &#x27;0000000000000000011111111&#x27; ] }
7fxff
</code></pre></output></codecell></div></cell><cell startpos="88:1-2133" endpos="220:4-5741" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = mLon / n
const dLat = mLat / n
const blank = Array(x).fill(&quot;0&quot;).join(&#x27;&#x27;)

const denorm = (v,d) =&gt; v-d
const hash2geo = hash =&gt; {
  const hexs = hash.split(&#x27;x&#x27;)
  const ints = hexs.map(h =&gt; parseInt(h,16))
  const bins = ints.map( i =&gt; i.toString(2)).map(b =&gt; blank.slice(0, 0-b.length) + b)
  let S = n
  let [minLat,maxLat] = [0, 180]
  let [minLon,maxLon] = [0, 360]
  for (var I=0;I&lt;x;I++) {
    const a = parseInt(bins[0][I])
    const b = parseInt(bins[1][I])
    S = S / 2
    if (a) minLat = (minLat + ((maxLat-minLat)/2))
    else maxLat = (maxLat - (maxLat-minLat)/2)
    if (b) minLon = (minLon + ((maxLon-minLon)/2))
    else maxLon = (maxLon - (maxLon-minLon)/2)
    console.log({I,d: [minLat,maxLat,minLon,maxLon]})
  }

  // [minLat,maxLat] = [minLat,maxLat].map(y=&gt;denorm(y,90))
  // [minLon,maxLon] = [minLon,maxLon].map(y=&gt;denorm(y,180))
  
  return {ints,hexs,bins, minLat,maxLat,minLon,maxLon}
}
return hash2geo(&quot;7fxff&quot;)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">2m ago</span></span></span><output><pre><code class="txt">{ I: 0, minLat: 0, maxLat: 90, minLon: 0, maxLon: 180 }
{ I: 1, minLat: 0, maxLat: 45, minLon: 0, maxLon: 90 }
{ I: 2, minLat: 0, maxLat: 22.5, minLon: 0, maxLon: 45 }
{ I: 3, minLat: 0, maxLat: 11.25, minLon: 0, maxLon: 22.5 }
{ I: 4, minLat: 0, maxLat: 5.625, minLon: 0, maxLon: 11.25 }
{ I: 5, minLat: 0, maxLat: 2.8125, minLon: 0, maxLon: 5.625 }
{ I: 6, minLat: 0, maxLat: 1.40625, minLon: 0, maxLon: 2.8125 }
{ I: 7, minLat: 0, maxLat: 0.703125, minLon: 0, maxLon: 1.40625 }
{ I: 8, minLat: 0, maxLat: 0.3515625, minLon: 0, maxLon: 0.703125 }
{ I: 9,
  minLat: 0,
  maxLat: 0.17578125,
  minLon: 0,
  maxLon: 0.3515625 }
{ I: 10,
  minLat: 0,
  maxLat: 0.087890625,
  minLon: 0,
  maxLon: 0.17578125 }
{ I: 11,
  minLat: 0,
  maxLat: 0.0439453125,
  minLon: 0,
  maxLon: 0.087890625 }
{ I: 12,
  minLat: 0,
  maxLat: 0.02197265625,
  minLon: 0,
  maxLon: 0.0439453125 }
{ I: 13,
  minLat: 0,
  maxLat: 0.010986328125,
  minLon: 0,
  maxLon: 0.02197265625 }
{ I: 14,
  minLat: 0,
  maxLat: 0.0054931640625,
  minLon: 0,
  maxLon: 0.010986328125 }
{ I: 15,
  minLat: 0,
  maxLat: 0.00274658203125,
  minLon: 0,
  maxLon: 0.0054931640625 }
{ I: 16,
  minLat: 0,
  maxLat: 0.001373291015625,
  minLon: 0,
  maxLon: 0.00274658203125 }
{ I: 17,
  minLat: 0,
  maxLat: 0.0006866455078125,
  minLon: 0.001373291015625,
  maxLon: 0.00274658203125 }
{ I: 18,
  minLat: 0.00034332275390625,
  maxLat: 0.0006866455078125,
  minLon: 0.0020599365234375,
  maxLon: 0.00274658203125 }
{ I: 19,
  minLat: 0.000514984130859375,
  maxLat: 0.0006866455078125,
  minLon: 0.00240325927734375,
  maxLon: 0.00274658203125 }
{ I: 20,
  minLat: 0.0006008148193359375,
  maxLat: 0.0006866455078125,
  minLon: 0.002574920654296875,
  maxLon: 0.00274658203125 }
{ I: 21,
  minLat: 0.0006437301635742188,
  maxLat: 0.0006866455078125,
  minLon: 0.0026607513427734375,
  maxLon: 0.00274658203125 }
{ I: 22,
  minLat: 0.0006651878356933594,
  maxLat: 0.0006866455078125,
  minLon: 0.0027036666870117188,
  maxLon: 0.00274658203125 }
{ I: 23,
  minLat: 0.0006759166717529297,
  maxLat: 0.0006866455078125,
  minLon: 0.0027251243591308594,
  maxLon: 0.00274658203125 }
{ I: 24,
  minLat: 0.0006812810897827148,
  maxLat: 0.0006866455078125,
  minLon: 0.0027358531951904297,
  maxLon: 0.00274658203125 }
{ ints: [ 127, 255 ],
  hexs: [ &#x27;7f&#x27;, &#x27;ff&#x27; ],
  bins: [ &#x27;0000000000000000001111111&#x27;, &#x27;0000000000000000011111111&#x27; ],
  minLat: 0.0006812810897827148,
  maxLat: 0.0006866455078125,
  minLon: 0.0027358531951904297,
  maxLon: 0.00274658203125 }
</code></pre></output></codecell></div></cell></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="meta/files_and_links.lit" href="/meta/files_and_links.html">meta/files_and_links.lit</a></li></ol></div><script>;(function () {
                var src = '//cdn.jsdelivr.net/npm/eruda';
                if (!/eruda=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
                document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
                document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
            })();</script><script async="" src="/web.bundle.js"></script></body></html>