<html data-reactroot=""><head><title>2021-06-14</title><meta name="litsrc" value="/testing/log/2021-06-14.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><meta name="apple-mobile-web-app-capable" content="yes"/><link rel="apple-touch-icon" href="/assets/lit-logo.png"/><link rel="icon" href="/assets/lit-logo.png"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children" disabled=""><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span><span class="led led-grey"></span><span class="led led-grey"></span></li></menu></li></menu></div><style>body {
  --bg: white;
  --bg-secondary-color: #efefef;
    
  --text-color: black;
  --text-secondary-color: grey;
  --text-primary-color: #9999f7;
  --text-highlight-bg: yellow;
  --text-highlight-color: black;

  --divider-subtle: #efefef;
  --medium-space: 0.4em;
  --code-bg-color: black;
  --code-text-color: white;
  --box-bg-opacity: 0.05;
}</style><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/sunburst.min.css"/><div id="content"><section id="2021-06-14" depth="1" class="" startpos="1:1-0" endpos="1:13-12"><div startpos="1:1-0" endpos="1:13-12" class="cell"><div class="cell-content"><h1 id="2021-06-14">2021-06-14</h1></div></div><section id="rube-a-geo-hash" depth="2" class="" startpos="3:1-14" endpos="189:4-5032"><div startpos="3:1-14" endpos="189:4-5032" class="cell"><div class="cell-content"><h2 id="rube-a-geo-hash"><em>Rube</em>: A Geo Hash</h2></div></div><div startpos="5:1-37" endpos="8:73-382" class="cell"><div class="cell-content"><blockquote>
<p>Earth&#x27;s circumference is the distance around Earth. Measured around the Equator, it is 40,075.017 km (24,901.461 mi). Measured around the poles, the circumference is 40,007.863 km (24,859.734 mi).
— <a class="external" href="https://en.m.wikipedia.org/wiki/Earth%27s_circumference" filepath="/testing/log/2021-06-14.lit" root="" data="[object Object]">Wikipedia<span class="linkIcon">↗</span></a></p>
</blockquote><p>Post ref: <a class="external" href="https://en.m.wikipedia.org/wiki/Geohash" filepath="/testing/log/2021-06-14.lit" root="" data="[object Object]">Wikipedia — GeoHash<span class="linkIcon">↗</span></a></p></div></div><div startpos="10:1-384" endpos="12:4-426" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return 40075017 / Math.pow(2,25)
</code></pre></div></div></div><div startpos="13:1-427" endpos="15:4-493" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="txt">1.1943285763263702
</code></pre></output></div></div></div><div startpos="17:1-495" endpos="17:132-626" class="cell"><div class="cell-content"><p>The circumference <code>c</code> of the earth at the equator in meters, divided by two, twenty five times is roughly one point two meters <code>s</code>.</p></div></div><div startpos="19:1-628" endpos="25:4-774" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const c = 40075017
const s = 1.1943285763263702
const n = c / s
const dlon = 360 / n
return `${n} segments of ${dlon} degrees longitude`
</code></pre></div></div></div><div startpos="26:1-775" endpos="28:4-885" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="txt">33554432 segments of 0.000010728836059570312 degrees longitude
</code></pre></output></div></div></div><div startpos="30:1-887" endpos="32:100-1069" class="cell"><div class="cell-content"><p>If for each division we stored &quot;left&quot; (0) or &quot;right&quot; (1) as a binary with 25 bits</p><p>Which if we always picked the &quot;right&quot; half of the split would give a maximum binary string like so:</p></div></div><div startpos="34:1-1071" endpos="36:4-1128" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return parseInt(&quot;111111111111111111111111&quot;, 2);
</code></pre></div></div></div><div startpos="37:1-1129" endpos="39:4-1185" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.9w ago</span></span></span><output><pre><code class="txt">16777215
</code></pre></output></div></div></div><div startpos="41:1-1187" endpos="41:52-1238" class="cell"><div class="cell-content"><p>Coincidentally the max hex representation. is then:</p></div></div><div startpos="43:1-1240" endpos="45:4-1280" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return (16777215).toString(16)
</code></pre></div></div></div><div startpos="46:1-1281" endpos="48:4-1335" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="txt">ffffff
</code></pre></output></div></div></div><div startpos="52:1-1339" endpos="98:4-2515" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = 360 / n
const dLat = 180 / n

const binToInt = str =&gt; parseInt(str,2)
const intToHex = num =&gt; num.toString(16)

const normLat = lat =&gt; lat + 90
const normLon = lon =&gt; lon + 180

const geo2hash = (lat,lon) =&gt; {
  const bins = [&#x27;&#x27;,&#x27;&#x27;]
  let [a,b] = [normLat(lat), normLon(lon)]
  console.log({normalised: [a,b]})
  let [minLatS,maxLatS,minLonS,maxLonS] = [0,180,0,360]
  for (var I=0;I&lt;x;I++) {
    const latDiv = minLatS + (maxLatS-minLatS)/2
    const lonDiv = minLonS + (maxLonS-minLonS)/2
    //console.log({I, d: [minLatS,maxLatS,minLonS,maxLonS], divs:[latDiv,lonDiv]})
    if (a &lt; latDiv){
      maxLatS = latDiv
      bins[0] += &quot;0&quot;
    } else {
      minLatS = latDiv
      bins[0] += &quot;1&quot;
    }
    if (b &lt; lonDiv){
      maxLonS = lonDiv
      bins[1] += &quot;0&quot;
    } else {
      minLonS = lonDiv
      bins[1] += &quot;1&quot;
    }
    //console.log(bins)
  }
  const ints = bins.map( bin =&gt; binToInt(bin))
  const hexs = ints.map( i =&gt; intToHex(i))
  console.log({lat,lon,dLon,dLat,n,x,ints,hexs, bins})
  return hexs.join(&#x27;x&#x27;)
}
const hash = geo2hash(30,30)
return {hash}
</code></pre></div></div></div><div startpos="99:1-2516" endpos="111:4-2869" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.7w ago</span></span></span><output><pre><code class="txt">{ normalised: [ 120, 210 ] }
{ lat: 30,
  lon: 30,
  dLon: 0.000010728836059570312,
  dLat: 0.000005364418029785156,
  n: 33554432,
  x: 25,
  ints: [ 22369621, 19573418 ],
  hexs: [ &#x27;1555555&#x27;, &#x27;12aaaaa&#x27; ],
  bins: [ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ] }
{ hash: &#x27;1555555x12aaaaa&#x27; }
</code></pre></output></div></div></div><div startpos="113:1-2871" endpos="160:4-4155" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const mLon = 40075017
const mLat = 40007863
const x = 25
const n = Math.pow(2, x)
const dLon = 360 / n
const dLat = 180 / n
const blank = Array(x).fill(&quot;0&quot;).join(&#x27;&#x27;)

const hash2geo = (hash, x = 25) =&gt; {
  const hexs = hash.split(&#x27;x&#x27;)
  const ints = hexs.map(h =&gt; parseInt(h,16))
  const bins = ints.map( i =&gt; i.toString(2)).map(b =&gt; blank.slice(0, 0-b.length) + b)
  
  let [minLat,maxLat] = [0, 180]
  let [minLon,maxLon] = [0, 360]
  
  for (var I=0;I&lt;x;I++) {
    const a = parseInt(bins[0][I])
    const b = parseInt(bins[1][I])
    const latDiv = minLat + (maxLat-minLat)/2
  const lonDiv = minLon + (maxLon-minLon)/2
    //console.log({I,a,b,d: [minLat,maxLat,minLon,maxLon]})
    if (a) {
       minLat = latDiv
    } else {
       maxLat = latDiv
    }
    if (b) {
       minLon = lonDiv
    } else {
       maxLon = lonDiv
    }
  }
  // console.log({d: [minLat,maxLat,minLon,maxLon]})
  // console.log(minLat-90, maxLat-90, minLon-180,maxLon-180)
  minLat = minLat - 90
  maxLat = maxLat - 90
  minLon = minLon - 180
  maxLon = maxLon - 180
  
  return {x, hash, ints, hexs, bins, minLat, maxLat, minLon, maxLon}
}
return [
   &quot;To within a meter (25 divisions)&quot;,hash2geo(&quot;1555555x12aaaaa&quot;), 
   &quot;Only 5 divisions (tbd precision)&quot;,hash2geo(&quot;1555555x12aaaaa&quot;, 5)
]
</code></pre></div></div></div><div startpos="161:1-4156" endpos="182:4-4851" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.7w ago</span></span></span><output><pre><code class="txt">[ &#x27;To within a meter (25 divisions)&#x27;,
  { x: 25,
    hash: &#x27;1555555x12aaaaa&#x27;,
    ints: [ 22369621, 19573418 ],
    hexs: [ &#x27;1555555&#x27;, &#x27;12aaaaa&#x27; ],
    bins: [ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ],
    minLat: 29.999998211860657,
    maxLat: 30.000003576278687,
    minLon: 29.999992847442627,
    maxLon: 30.000003576278687 },
  &#x27;Only 5 divisions (tbd precision)&#x27;,
  { x: 5,
    hash: &#x27;1555555x12aaaaa&#x27;,
    ints: [ 22369621, 19573418 ],
    hexs: [ &#x27;1555555&#x27;, &#x27;12aaaaa&#x27; ],
    bins: [ &#x27;1010101010101010101010101&#x27;, &#x27;1001010101010101010101010&#x27; ],
    minLat: 28.125,
    maxLat: 33.75,
    minLon: 22.5,
    maxLon: 33.75 } ]
</code></pre></output></div></div></div><div startpos="183:1-4852" endpos="186:4-4970" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">// what precision is 5 divisions (at the equator in longitude, in km)
return 40075017 / Math.pow(2,5) / 1000
</code></pre></div></div></div><div startpos="187:1-4971" endpos="189:4-5032" class="code output  cell"><div class="cell-content"><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.7w ago</span></span></span><output><pre><code class="txt">1252.34428125
</code></pre></output></div></div></div></section><section id="ignore-but-but-but-we-get-the-same-hash-is-the-above-just-a-rubegoldberg-machine" depth="2" class="" startpos="194:1-5037" endpos="242:95-6685"><div startpos="194:1-5037" endpos="242:95-6685" class="cell"><div class="cell-content"><h2 id="ignore-but-but-but-we-get-the-same-hash-is-the-above-just-a-rubegoldberg-machine"><del>Ignore</del> But, but, but... we get the same hash... is the above just a rubegoldberg machine!?</h2></div></div><div startpos="196:1-5134" endpos="196:121-5254" class="cell"><div class="cell-content"><p>This was an intermediary implementation which naively converts to a hex hash and does not divide progressively as above.</p></div></div><div startpos="198:1-5256" endpos="236:4-6354" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const geo2hash = (lat,lon, x = 25) =&gt; {
  const n = Math.pow(2, x)
  const dLon = 360 / n
  const dLat = 180 / n
  const nLat = Math.floor((lat+90)/dLat)
  const nLon = Math.floor((lon+180)/dLon)
  const hash = `${nLat.toString(16)}x${nLon.toString(16)}`
  //console.log({hash,nLat,nLon})
  return hash
}
const hash2geo = (hash, x = 25) =&gt; {
  const n = Math.pow(2, x)
  const dLon = 360 / n
  const dLat = 180 / n
  const [hLat,hLon] = hash.split(&#x27;x&#x27;).map(x=&gt;parseInt(x,16))
  const lat = (hLat * dLat) - 90
  const lon = (hLon * dLon) - 180
  return { lat: [lat, lat+dLat], lon: [lon,lon+dLon]}
}

const lat = 30
const lon = 30
const hash = geo2hash(lat,lon)
const geo25 = hash2geo(hash)
const hash5 = geo2hash(lat,lon,5)
const geo5 = hash2geo(hash5, 5)
return {lat,lon,hash,geo25,hash5,geo5}
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.7w ago</span></span></span><output><pre><code class="txt">{ lat: 30,
  lon: 30,
  hash: &#x27;1555555x12aaaaa&#x27;,
  geo25: 
   { lat: [ 29.999998211860657, 30.000003576278687 ],
     lon: [ 29.999992847442627, 30.000003576278687 ] },
  hash5: &#x27;15x12&#x27;,
  geo5: { lat: [ 28.125, 33.75 ], lon: [ 22.5, 33.75 ] } }
</code></pre></output></div></div></div><div startpos="238:1-6356" endpos="242:95-6685" class="cell"><div class="cell-content"><p>... so far, I&#x27;m thinking <em><strong>yes</strong></em> 😞</p><p>it&#x27;s worth noting though that in its current form you would need to have gotten the hash at the desired precision before storing, as a hash25 cant be decoded to a geo5 (in its current state) ...</p><p>Also since it&#x27;s based in degrees, bins will not be of uniform size... which is likely desired.</p></div></div></section></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title="meta/files_and_links.lit" href="/meta/files_and_links.html">meta/files_and_links.lit</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script async="" src="/web.bundle.js"></script></body></html>