# testing/runkit.lit

Experimenting using RunKit as a custom repl for nodejs. 

## Table of Contents

## Embed

Lets start with just the simple [demo embed,](https://runkit.com/docs/embed) adding the embed script and a container below.

```script https://embed.runkit.com !inline
// inject https://embed.runkit.com
```

```html !inline
<!-- anywhere else on your page -->
<div id="my-element">A container to hold the embed. <br/>Run #init cell below ðŸ‘‡ to populate it.</div>
```



```js #init !collapse
return RunKit.createNotebook({
    // the parent element for the new notebook
    element: document.getElementById("my-element"),
    onEvaluate: (...args) => alert(JSON.stringify([...args])),
    // specify the source of the notebook
    source: "// GeoJSON!\nvar getJSON = require(\"async-get-json\");\n\nawait getJSON(\"https://storage.googleapis.com/maps-devrel/google.json\");"
})
```
```>txt attached=true updated=1621026584476
{ onEvaluate: [Function: onEvaluate],
  onLoad: undefined,
  onResize: undefined,
  onSave: undefined,
  onURLChanged: undefined,
  UUID: 4,
  name: 'runkit-embed-4',
  URL: null,
  endpointURL: null }
```

## Endpoint

react bindings for simple embed: https://github.com/runkitdev/react-runkit and trying out https://runkit.com/docs/endpoint


```jsx babel=true react=true repl=js !below #react #endpoint 
return (async fn => {

  const React = lit.utils.React
  const Embed = (await import('https://cdn.skypack.dev/runkit-embed-react')).default

  const helloSource = `exports.endpoint = function(request, response) {
    response.end("Hello world! From .lit and Nodejs thanks to RunKit.");
}`

  const onLoad = (...args) => console.log(JSON.stringify([...args]))

  return <Embed
            mode='endpoint'
            readOnly={true}
            evaluateOnLoad={true}
            // hidesActionButton={true}
            source={ helloSource } 
            // ref='embed'
            onLoad={ onLoad } 
          />

})()
```

```uri !below
https://2mkz0r1anfrl.runkit.sh/
```
## Viewer plug-in

```jsx rk.jsx !collapse !plugin type=viewer of=runkit
import Embed from 'https://cdn.skypack.dev/runkit-embed-react'

export const viewer = ({node,React}) => {
  const {useState} = React
  const [url, setUrl] = useState(false)
  const meta = node?.properties?.meta || {}
  const endpoint = meta.attrs && meta.attrs.mode === 'endpoint'

  const onLoad = async (rk) => {
     if (endpoint)
       setUrl(await rk.getEndpointURL())
  }

  return url || <Embed
            mode={endpoint ? 'endpoint' : 'default'}
            readOnly={endpoint}
            evaluateOnLoad={endpoint}
            hidesActionButton={endpoint}
            source={ node.data.value } 
            // ref='embed'
            onLoad={ onLoad } 
          />

}
```

```runkit !inline
console.log("Hello world! From .lit and Nodejs thanks to RunKit.")
```
```runkit !below mode=endpoint
exports.endpoint = function(req, res) {
    res.end("Hello world! From .lit and Nodejs thanks to RunKit.");
}
````

## REPL endpoint plug-in `node`

```js !plugin type=repl of=node
export const repl = (src, meta, node) => {
  if (!window.__runkitNodeEnpoint) {
    RunKit.createNotebook({
    // the parent element for the new notebook
    element: document.getElementById("my-element"),
    node: 'endpoint',
    onLoad: async (rk) => { 
      window.__runkitNodeEnpoint = await rk.getEndpointURL
    },
    evaluateOnLoad: true,
    // specify the source of the notebook
    source: `module.exports = function(req,res) {res.end("pong!")}`
}) 
    return "Setting up repl endpoint"
  } else {
    return true
  }
}
```
```js repl=node
console.log("Hello world! From .lit and Nodejs thanks to RunKit.")
```
```>txt attached=true updated=1621027436357
TODO
```