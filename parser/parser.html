<html data-reactroot=""><head><title>Parser</title><meta name="litsrc" value="/parser/parser.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><div><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"></li></menu></div><div class="lit-messages"></div></div><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/sunburst.min.css"/><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="5:21-185"><cell startpos="1:1-0" endpos="3:154-163"><div class="cell-content"><h1 id="parser">Parser</h1><p>Built atop the <a class="local" href="../unified.html" title="unified" wikilink="true" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="/unified.lit">unified</a> ecosystem, specifically <a class="local" href="../remark.html" title="remark" wikilink="true" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="/remark.lit">remark</a>, which takes <code>.lit</code> <a class="local" href="../markdown.html" title="Markdown" wikilink="true" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="/markdown.lit">Markdown</a> source and outputs <code>mdast</code> (Markdown Abstract Syntax Tree)</p></div></cell><section depth="2" class="" startpos="5:1-165" endpos="5:21-185"><cell startpos="5:1-165" endpos="5:21-185"><div class="cell-content"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a class="fragment" href="#implementation-1" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#implementation-1">Implementation<span class="linkIcon">§</span></a></p>
</li>
<li>
<p><a class="fragment" href="#extensions" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#extensions">Extensions<span class="linkIcon">§</span></a></p>
<ul>
<li><a class="fragment" href="#frontmatter" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#frontmatter">Frontmatter<span class="linkIcon">§</span></a></li>
<li><a class="fragment" href="#sections" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#sections">Sections<span class="linkIcon">§</span></a></li>
<li><a class="fragment" href="#cells" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#cells">Cells<span class="linkIcon">§</span></a></li>
<li><a class="fragment" href="#codeblocks" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#codeblocks">Codeblocks<span class="linkIcon">§</span></a></li>
<li><a class="fragment" href="#markdown-blocks" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#markdown-blocks">Markdown blocks<span class="linkIcon">§</span></a></li>
<li><a class="fragment" href="#links" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#links">Links<span class="linkIcon">§</span></a></li>
</ul>
</li>
<li>
<p><a class="fragment" href="#ast-to-string" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="#ast-to-string">AST to String<span class="linkIcon">§</span></a></p>
</li>
</ul></div></cell></section></section>
<section depth="2" class="" startpos="13:1-312" endpos="16:4-374"><cell startpos="13:1-312" endpos="13:19-330"><div class="cell-content"><h2 id="implementation-1">Implementation</h2></div></cell><cell startpos="15:1-332" endpos="16:4-374" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; index.js</span></span><pre><code class="js"></code></pre></codecell></div></cell></section>
<section depth="2" class="" startpos="18:1-376" endpos="23:4-460"><cell startpos="18:1-376" endpos="18:14-389"><div class="cell-content"><h2 id="extensions">Extensions</h2></div></cell><section depth="3" class="" startpos="19:1-390" endpos="23:4-460"><cell startpos="19:1-390" endpos="20:17-422"><div class="cell-content"><h3 id="frontmatter">Frontmatter</h3><p><em>Implementation</em></p></div></cell><cell startpos="22:1-424" endpos="23:4-460" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; frontmatter.js</span></span><pre><code class="js"></code></pre></codecell></div></cell></section></section>
<section depth="3" class="" startpos="25:1-462" endpos="41:4-735"><cell startpos="25:1-462" endpos="27:74-549"><div class="cell-content"><h3 id="sections">Sections</h3><p>Sections are automatically created from the nested structure of Headings.</p></div></cell><cell startpos="29:1-551" endpos="32:4-614" class="code"><div class="cell-content"><codecell class="lang-md local"><span class="meta"><span class="lang">md</span></span><pre><code class="md"># Headline (root section)
## Subtitle (child section)
</code></pre></codecell></div></cell><cell startpos="34:1-616" endpos="34:34-649"><div class="cell-content"><p>They can be collapse/folded (tbd)</p></div></cell><cell startpos="36:1-651" endpos="38:4-684" class="code"><div class="cell-content"><codecell class="lang-md local"><span class="meta"><span class="lang">md</span></span><pre><code class="md"># &gt;Headline (collapsed)
</code></pre></codecell></div></cell><cell startpos="39:1-685" endpos="39:17-701"><div class="cell-content"><p><em>Implementation</em></p></div></cell><cell startpos="40:1-702" endpos="41:4-735" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; sections.js</span></span><pre><code class="js"></code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="43:1-737" endpos="45:60-807"><cell startpos="43:1-737" endpos="45:60-807"><div class="cell-content"><h3 id="cells">Cells</h3><p><em>Currently implemented as part of <strong>Sections</strong>, see above.</em></p></div></cell></section>
<section depth="3" class="" startpos="47:1-809" endpos="131:4-2984"><cell startpos="47:1-809" endpos="49:17-841"><div class="cell-content"><h3 id="codeblocks">Codeblocks</h3><p><em>Implementation</em></p></div></cell><cell startpos="51:1-843" endpos="52:4-878" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; codeblocks.js</span></span><pre><code class="js"></code></pre></codecell></div></cell><cell startpos="53:1-879" endpos="131:4-2984" class="code"><div class="cell-content"><codecell class="tag-meta tag-tostring lang-js local"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#033165" class="tag">meta</span><span style="color:black;background-color:#ccb166" class="tag">tostring</span></span><pre><code class="js">// const meta = this.children[0].children[0].properties.meta

const prefix = p =&gt; str =&gt; p + str
const tag = prefix(&quot;#&quot;)
const dir = prefix(&quot;!&quot;)
const attr = ([key,value]) =&gt; `${key}=${value}`

const metaToString = (meta) =&gt; {
  const parts = [];
  const dirs = meta.directives || []
  const tags = meta.tags || []
  const attrs = meta.attrs || {}

  parts.push(meta.isOutput &amp;&amp; &quot;&gt;&quot;);
  parts.push(meta.lang);
  parts.push(meta.filename || meta.uri);
  
  dirs.forEach( d =&gt; parts.push(dir(d)))
  Object.entries(attrs).forEach( (e) =&gt; parts.push(attr(e)))
  tags.forEach( t =&gt; parts.push(tag(t)))

  if (meta.source) {
    parts.push(&quot;&lt;&quot;)
    parts.push(metaToString(meta.source))
  }

  if (meta.output) {
    parts.push(&quot;&gt;&quot;)
    parts.push(metaToString(meta.output))
  }

  return parts.filter((x) =&gt; x).join(&quot; &quot;);
};

const input = &quot;js index.jsx !foo #bar baz=qux\\ zig &lt; source.jsx &gt; json output.json #faz !raz&quot;
const meta = lit.parser.utils.parseMeta({meta: input})
console.log(input)
console.log(meta)
return metaToString(meta)
return lit.parser.utils 
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">1.9w ago</span></span></span><output><pre><code class="txt">js index.jsx !foo #bar baz=qux\ zig &lt; source.jsx &gt; json output.json #faz !raz
{ attrs: { baz: &#x27;qux\\ zig&#x27; },
  lang: &#x27;js&#x27;,
  filename: &#x27;index.jsx&#x27;,
  directives: [ &#x27;foo&#x27; ],
  tags: [ &#x27;bar&#x27; ],
  baz: &#x27;qux\\ zig&#x27;,
  isOutput: false,
  output: 
   { attrs: {},
     lang: &#x27;json&#x27;,
     filename: &#x27;output.json&#x27;,
     tags: [ &#x27;faz&#x27; ],
     directives: [ &#x27;raz&#x27; ],
     isOutput: false,
     output: undefined,
     hasOutput: false,
     hasSource: false,
     source: undefined,
     raw: &#x27;json output.json #faz !raz&#x27; },
  hasOutput: true,
  hasSource: true,
  source: 
   { attrs: {},
     lang: &#x27;txt&#x27;,
     filename: &#x27;source.jsx&#x27;,
     isOutput: false,
     output: undefined,
     hasOutput: false,
     hasSource: false,
     source: undefined,
     raw: &#x27;txt source.jsx&#x27; },
  raw: &#x27;js index.jsx !foo #bar baz=qux\\ zig &lt; source.jsx &gt; json output.json #faz !raz&#x27;,
  fromSource: &#x27;source.jsx&#x27; }
js index.jsx !foo baz=qux\ zig #bar &lt; txt source.jsx &gt; json output.json !raz #faz
</code></pre></output></codecell></div></cell></section>
<section depth="3" class="" startpos="134:1-2987" endpos="139:4-3059"><cell startpos="134:1-2987" endpos="136:17-3024"><div class="cell-content"><h3 id="markdown-blocks">Markdown blocks</h3><p><em>Implementation</em></p></div></cell><cell startpos="138:1-3026" endpos="139:4-3059" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; mdblocks.js</span></span><pre><code class="js"></code></pre></codecell></div></cell></section>
<section depth="3" class="" startpos="141:1-3062" endpos="146:4-3121"><cell startpos="141:1-3062" endpos="143:17-3089"><div class="cell-content"><h3 id="links">Links</h3><p><em>Implementation</em></p></div></cell><cell startpos="145:1-3091" endpos="146:4-3121" class="code"><div class="cell-content"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span class="source">&lt; links.js</span></span><pre><code class="js"></code></pre></codecell></div></cell></section>
<section depth="2" class="" startpos="148:1-3123" endpos="160:4-3646"><cell startpos="148:1-3123" endpos="152:168-3471"><div class="cell-content"><h2 id="ast-to-string">AST to String</h2><ul class="contains-task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled=""/> <!-- -->#TODO refactor save (update src) to operate on AST directly and stringify as below, instead of the cureent <a class="local" href="../utils/unist-patch-source.html" title="../utils/unist-patch-source" wikilink="true" filepath="/parser/parser.lit" root="" data="[object Object]" canonical="/utils/unist-patch-source.lit">../utils/unist-patch-source</a> implementaction.</p>
<p>This is complicated by the fact that new cell source can in effect result in previous and next cell semantic/structure changes, hence the patch source implementation</p>
</li>
</ul></div></cell><cell startpos="153:1-3472" endpos="160:4-3646" class="code"><div class="cell-content"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span></span><pre><code class="js">const {toMarkdown, ungroupSections}
      = lit.parser.utils
const unGroup = ungroupSections()()
const tree = unGroup(lit.ast)
const md = toMarkdown(tree)
return md
</code></pre></codecell></div></cell></section></div></div><div id="backlinks"><h4>Backlinks (2)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li><li><a title="Links" href="/testing/links.html">Links</a></li></ol></div><script>;(function () {
                var src = '//cdn.jsdelivr.net/npm/eruda';
                if (!/eruda=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
                document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
                document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
            })();</script><script async="" src="/web.bundle.js"></script></body></html>