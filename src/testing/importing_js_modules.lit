# Importing JS Modules

## Table of Contents 

## References

- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules
- https://github.com/WICG/import-maps
- https://github.com/tc39/proposal-import-meta
- https://v8.dev/features/modules

```js #destructuring
const x = {
  default: "a",
  b: "42",
  c: () => {},
};
const { default: y, b: z } = x;
return { y, z };

```
```>txt attached=true updated=1621550583088
{ y: 'a', z: '42' }
```

## Skypack





```js #skypack
const skypack = (pkg) => import(`https://cdn.skypack.dev/${pkg}`);
return skypack("canvas-confetti");

```
```>txt attached=true updated=1621550294972
{ create: [Function: confettiCannon],
  default: { [Function: fire] reset: [Function], create: [Function: confettiCannon] } }
```
```js #skypack
const skypack = (pkg) => import(`https://cdn.skypack.dev/${pkg}`);

return skypack("canvas-confetti").then((pkg) => {
  const { default: fire } = pkg;
  return fire();
});

```
```>txt attached=true updated=1621551049304
undefined
```
```js #skypack
const skypack = (pkg) => import(`https://cdn.skypack.dev/${pkg}`);

// I like async await
return (async (fn) => {
  const { default: fire } = await skypack("canvas-confetti");
  return fire();
})();

```
```>txt attached=true updated=1621551042809
undefined
```

## Unpkg



```js #unpkg
const unpkg = (pkg) => import(`https://unpkg.com/${pkg}?module`);
return unpkg("canvas-confetti");

```
```>txt attached=true updated=1621550434223
{ create: [Function: confettiCannon],
  default: { [Function: fire] reset: [Function], create: [Function: confettiCannon] } }
```
```js #unpkg
const unpkg = (pkg) => import(`https://unpkg.com/${pkg}?module`);
return unpkg("canvas-confetti").then((pkg) => {
  return pkg.default();
});

```
```>txt attached=true updated=1621583914027
undefined
```



## Native ES Module REPL
```>js ../plugins/repls/module.js !plugin type=repl of=module !collapse 
export const repl = async (src, meta) => {
  const { btoa } = lit.utils.safeEncoders;
  const { transform } = lit.utils;
  const filename = (meta && meta.filename) || "untitled.js";
  let babel;
  try {
    babel = transform(filename, src);

    const s = `/*${Date.now()}*/` + babel.code;
    const console = "fake me";
    const m = await import(`data:text/javascript;base64,${btoa(s)}`);
    if (typeof m.default === "function") {
      const res = await m.default.call({ console });
      return lit.utils.inspect(res);
    } else return lit.utils.inspect(m);
  } catch (err) {
    return err.message;
  }
};

```
```js repl=module
import fire from "https://cdn.skypack.dev/canvas-confetti";

export const success = "yes";
export const issue =
  "module caching means it only executes once, had to add a cachebusting comment.";

export default () => import.meta
export const cons = typeof console !== "undefined" ? console : null;
fire();

```
```>txt attached=true updated=1621634694908
{ url: 'data:text/javascript;base64,LyoxNjIxNjM0Njk0MDczKi9pbXBvcnQgZmlyZSBmcm9tICJodHRwczovL2Nkbi5za3lwYWNrLmRldi9jYW52YXMtY29uZmV0dGkiOwpleHBvcnQgY29uc3Qgc3VjY2VzcyA9ICJ5ZXMiOwpleHBvcnQgY29uc3QgaXNzdWUgPSAibW9kdWxlIGNhY2hpbmcgbWVhbnMgaXQgb25seSBleGVjdXRlcyBvbmNlLCBoYWQgdG8gYWRkIGEgY2FjaGVidXN0aW5nIGNvbW1lbnQuIjsKZXhwb3J0IGRlZmF1bHQgKCgpID0+IGltcG9ydC5tZXRhKTsKZXhwb3J0IGNvbnN0IGNvbnMgPSB0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIgPyBjb25zb2xlIDogbnVsbDsKZmlyZSgpOw==' }
```


```js repl=module
import foo from '/notfound.js'
export default foo
```
```>txt attached=true updated=1621599982721
Module name, '/notfound.js' does not resolve to a valid URL.
```
```>txt  updated=1621596754673
Module name, '/notfound' does not resolve to a valid URL.
```
```>txt  updated=1621596671506
Module specifier, 'notfound' does not start with "/", "./", or "../". Referenced from data:text/javascript;base64,LyoxNjIxNTk2NjcxNDkzKi9pbXBvcnQgZm9vIGZyb20gJ25vdGZvdW5kJzsKZXhwb3J0IGRlZmF1bHQgZm9vOw==
```
```js repl=module
export default async function (...args) {
  return { args, console, ctx: this };
};

```
```>txt attached=true updated=1621599908036
{ args: [],
  console: 
   { debug: [Function],
     error: [Function],
     log: [Function],
     info: [Function],
     warn: [Function],
     clear: [Function],
     dir: [Function],
     dirxml: [Function: dirxml],
     table: [Function],
     trace: [Function: trace],
     assert: [Function],
     count: [Function],
     countReset: [Function],
     profile: [Function: profile],
     profileEnd: [Function: profileEnd],
     time: [Function],
     timeLog: [Function],
     timeEnd: [Function],
     timeStamp: [Function: timeStamp],
     takeHeapSnapshot: [Function: takeHeapSnapshot],
     group: [Function],
     groupCollapsed: [Function],
     groupEnd: [Function],
     record: [Function: record],
     recordEnd: [Function: recordEnd],
     screenshot: [Function: screenshot] },
  ctx: { console: 'fake me' } }
```

```js repl=module
export default fn => console.screenshot(document.body)
```
```>txt attached=true updated=1621600683102
undefined
```

```js repl=module
const { inspect } = lit.utils;
const { wait } = lit.utils.fns;

export default async (fn) => {
  // https://github.com/whatwg/console/issues/120
  console.record();
  await wait(1000);
  console.log("tick", new Date());
  await wait(1000);
  console.log("tock", new Date());
  return console.recordEnd.toString();
};

```
```>txt attached=true updated=1621600089887
'function recordEnd() {\n    [native code]\n}'
```

## Local modules

This assumes you have the experimental service worker ([[testing/ServiceWorker]]) enabled to vend files in the local filesystem via Web fetch API.

```>js custom-module.mjs
export default (fn) => "Great Success!";

```

```js repl=module
import foo from './custom-module.mjs'
export default foo()
```
```>txt attached=true updated=1621634357357
Module name, './custom-module.mjs' does not resolve to a valid URL.
```

```js
return fetch('./custom-module.js').then(res => res.text())
```
```>txt attached=true updated=1621633764280
export default fn => "Great Success!"
```
```>txt  updated=1621633305283
Module name, './custom-module' does not resolve to a valid URL.
```










