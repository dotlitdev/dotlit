# Fuzzy text search

Related

- [[testing/compact_manifest]]

## Fuse.js

https://fusejs.io/

```js !collapse #intro
return (async (fn) => {
  const { default: Fuse } = await import(
    "https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.esm.js"
  );
  const manifest = await fetch("/manifest.json").then((res) => res.json());
  const fuse = new Fuse(manifest.nodes, {
    includeScore: true,
    keys: ["title", "id"],
  });

  // 3. Now search!
  return fuse.search("../../..",{limit:5});
})();

```
```js > md
return (async (fn) => {
  const { default: Fuse } = await import(
    "https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.esm.js"
  );
  // const manifest = await fetch("/manifest.json").then((res) => res.json());

  const fullLocal = await (async (fn) => {
    const path = lit.utils.path;
    const all = []
    const visit = async (root) => {
      const list = await lit.fs.readdir(root);
      return Promise.all(
        list.map(async (key) => {
          const pathname = path.join(root, key);
          const stat = await lit.fs.stat(pathname);
          let contents;
          if (key === ".git") {
          } else if (false && stat.type === "dir") await visit(pathname);
          else if (pathname.endsWith('.lit')) contents = (await lit.fs.readFile(pathname, { encoding: "utf8",localOnly: true }))//.slice(0,10);
          const item = { pathname, type: stat.type, contents }
          all.push(item);
          return item
        })
      );
    };

    await visit("/")
    return all
  })();

  return fullLocal

  const fuse = new Fuse(fullLocal, {
    //ignoreLocation: true,
    includeScore: true,
    //includeMatches: true,
    keys: ["pathname", "contents"],
  });


  // 3. Now search!
  return fuse.search("agora", { limit: 5 })
        //.map(x=>x.matches.map(x=>x.indices))
        .map(x=>[x.score, x.item.pathname,x.refIndex])
        .map(([score,pathname,index]) => `- [${pathname}](${pathname}) ${score}`)
        .join('\n');
})();

```
```>md attached=true updated=1621812863331
[ { pathname: '/testing', type: 'dir', contents: undefined },
  { pathname: '/index.lit', type: 'file', contents: undefined },
  { pathname: '/', type: 'dir', contents: undefined },
  { pathname: '/meta', type: 'dir', contents: undefined },
  { pathname: '/throwaway', type: 'dir', contents: undefined },
  { pathname: '/articles', type: 'dir', contents: undefined },
  { pathname: '/cli', type: 'dir', contents: undefined },
  { pathname: '/client', type: 'dir', contents: undefined },
  { pathname: '/6d', type: 'dir', contents: undefined },
  { pathname: '/dummy', type: 'dir', contents: undefined },
  { pathname: '/renderer', type: 'dir', contents: undefined },
  { pathname: '/repl', type: 'dir', contents: undefined },
  { pathname: '/utils', type: 'dir', contents: undefined },
  { pathname: '/404.lit', type: 'file', contents: undefined },
  { pathname: '/functions.lit', type: 'file', contents: undefined },
  { pathname: '/execute_code_cells.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/persist_to_github.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/plugin_system.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/repls.lit', type: 'file', contents: undefined },
  { pathname: '/scratch_pad.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/wiki-links.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/filesystem', type: 'dir', contents: undefined },
  { pathname: '/divergence_from_markdown.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/meta.lit', type: 'file', contents: undefined },
  { pathname: '/parser', type: 'dir', contents: undefined },
  { pathname: '/plugins', type: 'dir', contents: undefined },
  { pathname: '/serviceworker.js',
    type: 'file',
    contents: undefined },
  { pathname: '/prismjs_and_a_simple_editor.lit',
    type: 'file',
    contents: undefined },
  { pathname: '/index.js', type: 'file', contents: undefined },
  { pathname: '/taking_notes.lit',
    type: 'file',
    contents: undefined } ]
```




## FuzzySet

https://github.com/Glench/fuzzyset.js

```js
return import('https://cdn.skypack.dev/fuzzyset').then( FuzzySet => {

  const f = new FuzzySet.default()
  f.add("the text of mine")
  f.add("the text of someone else")
  f.add("other texts")
  return f.get("text of")
})

```
```>txt attached=true updated=1621778112764
[ [ 0.4375, 'the text of mine' ] ]
```