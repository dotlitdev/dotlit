<html data-reactroot=""><head><title>execute_code_cells</title><meta name="litsrc" value="execute_code_cells.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="header"><div><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children"><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children"><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span></li></menu></li></menu><div class="messages"><div class="message">Viewer Error: Cannot find module &#x27;data:text/javascript;base64,ZXhwb3J0IGNvbnN0IHZpZXdlciA9ICh7bm9kZSwgUmVhY3R9KSA9PiB7CiAgY29uc3QgcmNlID0gUmVhY3QuY3JlYXRlRWxlbWVudAogIGNvbnN0IHt1c2VTdGF0ZSwgdXNlRWZmZWN0fSA9IFJlYWN0CiAgY29uc3QgW3Jlc3AsIHNldFJlc3BdID0gdXNlU3RhdGUobnVsbCkKICBjb25zdCBbcnVuLCBzZXRSdW5dID0gdXNlU3RhdGUoMCkKICBjb25zdCBleGVjID0gKCkgPT4gc2V0UnVuKHJ1bisxKQogIGNvbnN0IGV4ZWMyID0gKCkgPT4gbG9hZChub2RlLmRhdGEudmFsdWUpCiAgdXNlRWZmZWN0KGFzeW5jICgpID0+IHsKICAgICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWQoc3JjKSB7CiAgICAgICAgICBjb25zdCB2YWwgPSBgLy9ydW46ICR7cnVufVxuJHtzcmN9YAogICAgICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgaW1wb3J0KGBkYXRhOnRleHQvamF2YXNjcmlwdDtiYXNlNjQsJHsgYnRvYShzcmMpfWApOwogICAgICAgICBpZiAodHlwZW9mIG1vZHVsZS5yZXR1cm5zID09PSAnZnVuY3Rpb24nKSBzZXRSZXNwKGF3YWl0IG1vZHVsZS5yZXR1cm5zKHJ1bikpCiAgICAgICAgIGVsc2UgaWYgKG1vZHVsZS5yZXR1cm5zKSBzZXRSZXNwKG1vZHVsZS5yZXR1cm5zKQogICAgICB9CgogICAgIHRyeSB7CiAgICAgICAgbG9hZChub2RlLmRhdGEudmFsdWUpCiAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgYWxlcnQoZXJyLm1lc3NhZ2UgfHwgZXJyLnRvU3RyaW5nKCkpCiAgICAgfQogIH0sIFtydW5dKQoKICBjb25zdCBidG4gPSByY2UoJ2J1dHRvbicsIHtvbkNsaWNrOiBleGVjfSwgIlJ1biAiICsgcnVuKQogIGNvbnN0IHQgPSByY2UoJ2RpdicsIG51bGwsIFtidG4sIHJlc3BdKQogIHJldHVybiB0Cn0=&#x27;
Require stack:
- /home/runner/work/dotlit/dotlit/src/renderer/extractViewers.js
- /home/runner/work/dotlit/dotlit/src/renderer/index.jsx
- /home/runner/work/dotlit/dotlit/src/cli/generate.js
- /home/runner/work/dotlit/dotlit/src/cli/index.js
- /home/runner/work/dotlit/dotlit/src/index.js</div><div class="message">Viewer Error: Cannot find module &#x27;data:text/javascript;base64,ZXhwb3J0IGNvbnN0IHZpZXdlciA9ICh7bm9kZSwgUmVhY3R9KSA9PiB7CiAgY29uc3QgcmNlID0gUmVhY3QuY3JlYXRlRWxlbWVudAogIGNvbnN0IHt1c2VTdGF0ZSwgdXNlRWZmZWN0fSA9IFJlYWN0CiAgY29uc3QgW3Jlc3AsIHNldFJlc3BdID0gdXNlU3RhdGUobnVsbCkKICBjb25zdCBbcnVuLCBzZXRSdW5dID0gdXNlU3RhdGUoMCkKICAKICBjb25zdCBleGVjID0gZXYgPT4gewogICAgZXYgJiYgZXYuc3RvcFByb3BhZ2F0aW9uKCkKICAgIHNldFJ1bihydW4rMSkKICAgIGxvYWQobm9kZS5kYXRhLnZhbHVlKQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICB1c2VFZmZlY3QoIGFyZ3MgPT4gewogICAgaWYocnVuPT09MCAmJiBub2RlLnByb3BlcnRpZXMubWV0YS5leGVjPT09Im9ubG9hZCIpCiAgICAgICBleGVjKCkKICB9LFtdKQoKICBhc3luYyBmdW5jdGlvbiBsb2FkKHNyYykgewogICAgY29uc3QgdmFsID0gYC8vcnVuOiAke3J1bn1cbiR7c3JjfWAKICAgIGNvbnN0IG1vZHVsZSA9IGF3YWl0IGltcG9ydChgZGF0YTp0ZXh0L2phdmFzY3JpcHQ7YmFzZTY0LCR7IGJ0b2Eoc3JjKX1gKTsKICAgIGlmICh0eXBlb2YgbW9kdWxlLnJldHVybnMgPT09ICdmdW5jdGlvbicpIHNldFJlc3AoYXdhaXQgbW9kdWxlLnJldHVybnMocnVuKSkKICAgIGVsc2UgaWYgKG1vZHVsZS5yZXR1cm5zKSBzZXRSZXNwKG1vZHVsZS5yZXR1cm5zKQogIH0KCiAgY29uc3QgYnRuID0gcmNlKCdidXR0b24nLCB7b25DbGljazogZXhlY30sICJSdW4gIiArIHJ1bikKICBjb25zdCB0ID0gcmNlKCdkaXYnLCBudWxsLCBbYnRuLCByZXNwXSkKICByZXR1cm4gdAp9&#x27;
Require stack:
- /home/runner/work/dotlit/dotlit/src/renderer/extractViewers.js
- /home/runner/work/dotlit/dotlit/src/renderer/index.jsx
- /home/runner/work/dotlit/dotlit/src/cli/generate.js
- /home/runner/work/dotlit/dotlit/src/cli/index.js
- /home/runner/work/dotlit/dotlit/src/index.js</div></div></div></div><div id="content"><section depth="1" class="" startpos="1:1-0" endpos="3:21-46"><cell startpos="1:1-0" endpos="1:25-24"><h1 id="executing-code-cells">Executing <code>code</code> cells</h1></cell><section depth="2" class="" startpos="3:1-26" endpos="3:21-46"><cell startpos="3:1-26" endpos="3:21-46"><h2 id="table-of-contents">Table of Contents</h2><ul>
<li>
<p><a href="#bugs--and-to-do-">Bugs üêú and To do ‚úÖ<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a href="#examples">Examples<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a href="#typescript">TypeScript<span class="linkIcon">¬ß</span></a></li>
<li><a href="#async-and-promises">Async and Promises<span class="linkIcon">¬ß</span></a></li>
<li><a href="#react-jsx">React <code>jsx</code><span class="linkIcon">¬ß</span></a></li>
<li><a href="#output-markdown">Output Markdown<span class="linkIcon">¬ß</span></a></li>
<li><a href="#meta-lit-global-and-ast">Meta: <code>lit</code> global and AST<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
<li>
<p><a href="#what-if">What if...<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a href="#first-pass">First pass<span class="linkIcon">¬ß</span></a></li>
<li><a href="#version-2">Version 2<span class="linkIcon">¬ß</span></a></li>
<li><a href="#module-from-string-%F0%9F%A5%B2">Module from string ü•≤<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
</ul></cell></section></section>
<section depth="2" class="" startpos="5:2-49" endpos="10:47-238"><cell startpos="5:2-49" endpos="10:47-238"><h2 id="bugs--and-to-do-">Bugs üêú and To do ‚úÖ</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <!-- -->executed cell gets replaced with its output</li>
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <!-- -->more robust outputs<!-- -->
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <!-- -->replace &quot;connected&quot; output on exec</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Extract transpilation as <a href="transfomers.html?file=transfomers.lit" title="Transfomers" wikilink="true">Transfomers</a></li>
</ul></cell></section>
<section depth="2" class="" startpos="12:1-240" endpos="45:4-648"><cell startpos="12:1-240" endpos="12:12-251"><h2 id="examples">Examples</h2></cell><cell startpos="18:1-257" endpos="24:4-375" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">console.log(document.referrer)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">3.8 days ago</span></span></span><output><pre><code class="txt">https://dotlit.org/
undefined
</code></pre></output></codecell></cell><section depth="3" class="" startpos="31:1-382" endpos="45:4-648"><cell startpos="31:1-382" endpos="31:15-396"><h3 id="typescript">TypeScript</h3></cell><cell startpos="33:1-398" endpos="45:4-648" class="code"><codecell class="lang-ts local"><span class="meta"><span class="lang">ts</span><span class="repl">js</span><span class="filename">test.ts</span><ul class="attributes"></ul></span><pre><code class="ts">type Options = {[key: number]: string}
const fn = (opts : Options) =&gt; {
  const str:string = 12 
  // need linting to make this useful
  return str
}

return fn()
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">5.8 days ago</span></span></span><output><pre><code class="txt">12
</code></pre></output></codecell></cell></section></section>
<section depth="3" class="" startpos="53:1-656" endpos="68:4-945"><cell startpos="53:1-656" endpos="53:23-678"><h3 id="async-and-promises">Async and Promises</h3></cell><cell startpos="55:1-680" endpos="68:4-945" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="filename">test.js</span><ul class="attributes"></ul></span><pre><code class="js">const wait = (ms) =&gt; {
  return new Promise(resolve =&gt; {
    setTimeout( () =&gt; {
      resolve(new Date())
    }, ms)
     
  })
}
return wait(1000)
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.4 days ago</span></span></span><output><pre><code class="txt">Thu Apr 22 2021 00:44:01 GMT+0100 (BST)
</code></pre></output></codecell></cell></section>
<section depth="3" class="" startpos="78:1-955" endpos="168:4-3008"><cell startpos="78:1-955" endpos="78:16-970"><h3 id="react-jsx">React <code>jsx</code></h3></cell><cell startpos="80:1-972" endpos="91:4-1199" class="code"><codecell class="lang-jsx local"><span class="meta"><span class="lang">jsx</span><span class="repl">js</span><span class="filename">test.jsx</span><ul class="attributes"></ul></span><pre><code class="jsx">import React from &#x27;https://cdn.skypack.dev/react&#x27;

const Component = props =&gt; {
  return &lt;div&gt;&lt;/div&gt;
}

return &lt;Component/&gt;
</code></pre></codecell><codecell class="dir-error lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="directives"><li style="color:white;background-color:#5c4d28"><span class="directive dir-error">error</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">5.8 days ago</span></span></span><output><pre><code class="txt">undefined
</code></pre></output></codecell></cell><cell startpos="93:1-1201" endpos="109:4-1567" class="code"><codecell class="lang-jsx local"><span class="meta"><span class="lang">jsx</span><span class="repl">js</span><span class="filename">test.jsx</span><ul class="attributes"></ul></span><pre><code class="jsx">return (async args =&gt; {

  const React = lit.utils.React
  const { useState } = React
  
  const Clicker = props =&gt; {
    const [c,setC] = useState(0)
    //console.log(React, useState, c)
    const click = e =&gt; setC(c+1)

    return &lt;button onClick={click}&gt;{ &quot;Click me: &quot; + c}&lt;/button&gt;
  }

  return &lt;Clicker/&gt;
})()
</code></pre></codecell></cell><cell startpos="113:1-1571" endpos="130:4-1869" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">return (async args =&gt; {

  const confetti = await 
  import(&#x27;https://cdn.skypack.dev/canvas-confetti&#x27;)

  confetti.default({
     origin: {y: 0},
     spread: 55,
     particleCount: 100,
     ticks: 1000,
  })
  return &quot;yay ü•≥&quot;
})()
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">4.9 days ago</span></span></span><output><pre><code class="txt">yay ü•≥
</code></pre></output></codecell></cell><cell startpos="132:1-1871" endpos="168:4-3008" class="code"><codecell class="dir-collapse lang-js local collapsed"><span class="meta"><span class="lang">js</span><span class="filename">current_viewport</span><span class="output">&gt; svg</span><ul class="directives"><li style="color:black;background-color:#da5323"><span class="directive dir-collapse">collapse</span></li></ul><ul class="attributes"></ul></span><pre><code class="js">const b = document.body
const ch = b.clientHeight
const cw = b.clientWidth
const sh = b.scrollHeight
const st = b.scrollTop

const a = cw / ch 
const sa = cw / sh
const c = (ch/2)+st
const cp = c / sh

const h = cw
const w = h * sa
const vt = h * (st/sh)
const vw = w
const vh = h * (ch/sh)
const x = (h/2) - w


const svg = `&lt;svg style=&quot;max-width: 100%;&quot; width=&quot;${h}&quot; height=&quot;${h}&quot;&gt;
  &lt;rect x=&quot;${x}&quot; width=&quot;${w}&quot; height=&quot;${h}&quot; style=&quot;fill:rgb(255,255,255);stroke-width:1;stroke:rgb(0,0,0)&quot; /&gt;
  &lt;rect x=&quot;${x}&quot; y=&quot;${vt}&quot; width=&quot;${vw}&quot; height=&quot;${vh}&quot; style=&quot;fill:rgb(255,255,255);stroke-width:3;stroke:rgb(255,0,0)&quot; /&gt;
&lt;/svg&gt;`

return svg

return {
   ch,cw,sh,st,c,cp,a 
}
</code></pre></codecell><codecell class="lang-svg local output"><span class="meta"><span class="lang">svg</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">5.4 days ago</span></span></span><div><svg style="max-width: 100%;" width="390" height="390">
  <rect x="151.05316382548398" width="43.94683617451604" height="390" style="fill:rgb(255,255,255);stroke-width:1;stroke:rgb(0,0,0)" />
  <rect x="151.05316382548398" y="159.67350476740828" width="43.94683617451604" height="74.82230569199653" style="fill:rgb(255,255,255);stroke-width:3;stroke:rgb(255,0,0)" />
</svg>
</div></codecell></cell></section>
<section depth="3" class="" startpos="182:1-3022" endpos="204:4-3318"><cell startpos="182:1-3022" endpos="182:20-3041"><h3 id="output-markdown">Output Markdown</h3></cell><cell startpos="184:1-3043" endpos="191:4-3209" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; md</span><ul class="attributes"></ul></span><pre><code class="js">console.log(&quot;A __*result*__: **`&quot; +  42/13 + &quot;`**&quot;)
return 42
</code></pre></codecell><codecell class="lang-md local output"><span class="meta"><span class="lang">md</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.4 days ago</span></span></span><div class="md-block">
<p>A <strong><em>result</em></strong>: <strong><code>3.230769230769231</code></strong>
42</p>
</div></codecell></cell><cell startpos="199:1-3217" endpos="204:4-3318" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; json</span><ul class="attributes"></ul></span><pre><code class="js">return { foo: &#x27;bar&#x27;}
</code></pre></codecell><codecell class="lang-json local output"><span class="meta"><span class="lang">json</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.7 days ago</span></span></span><output><pre><code class="json">{ foo: &#x27;bar&#x27; }
</code></pre></output></codecell></cell></section>
<section depth="3" class="" startpos="213:1-3327" endpos="395:4-6682"><cell startpos="213:1-3327" endpos="213:31-3357"><h3 id="meta-lit-global-and-ast">Meta: <code>lit</code> global and AST</h3></cell><cell startpos="239:1-3383" endpos="283:4-4472" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; ast_info !collapse</span><ul class="attributes"></ul></span><pre><code class="js">return this
</code></pre></codecell><codecell class="dir-collapse lang-ast_info local collapsed output"><span class="meta"><span class="lang">ast_info</span><ul class="directives"><li style="color:black;background-color:#da5323"><span class="directive dir-collapse">collapse</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">5.5 days ago</span></span></span><output><pre><code class="ast_info">{ type: &#x27;root&#x27;,
  children: 
   [ { type: &#x27;section&#x27;,
       data: [Object],
       depth: 1,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 2,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 2,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 3,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 3,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 3,
       children: [Object],
       position: [Object] },
     { type: &#x27;section&#x27;,
       data: [Object],
       depth: 3,
       children: [Object],
       position: [Object] } ],
  position: 
   { start: { line: 1, column: 1, offset: 0 },
     end: { line: 315, column: 1, offset: 4807 } } }
</code></pre></output></codecell></cell><cell startpos="290:1-4479" endpos="298:4-4721" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; litlocation !collapse</span><ul class="attributes"></ul></span><pre><code class="js">return lit.location
</code></pre></codecell><codecell class="dir-collapse lang-litlocation local collapsed output"><span class="meta"><span class="lang">litlocation</span><ul class="directives"><li style="color:black;background-color:#da5323"><span class="directive dir-collapse">collapse</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.4 days ago</span></span></span><output><pre><code class="litlocation">{ src: &#x27;execute_code_cells.lit&#x27;,
  root: &#x27;/&#x27;,
  base: &#x27;https://dotlit.org/&#x27;,
  query: { file: &#x27;execute_code_cells.lit&#x27; } }
</code></pre></output></codecell></cell><cell startpos="301:1-4724" endpos="328:4-5522" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; lit_utils !collapse</span><ul class="attributes"></ul></span><pre><code class="js">return lit.utils
</code></pre></codecell><codecell class="dir-collapse lang-lit_utils local collapsed output"><span class="meta"><span class="lang">lit_utils</span><ul class="directives"><li style="color:black;background-color:#da5323"><span class="directive dir-collapse">collapse</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.4 days ago</span></span></span><output><pre><code class="lit_utils">{ select: 
   { matches: [Function: matches],
     selectAll: [Function: selectAll],
     select: [Function: select] },
  path: 
   { resolve: [Function: resolve],
     normalize: [Function: normalize],
     isAbsolute: [Function: isAbsolute],
     join: [Function: join],
     relative: [Function: relative],
     _makeLong: [Function: _makeLong],
     dirname: [Function: dirname],
     basename: [Function: basename],
     extname: [Function: extname],
     format: [Function: format],
     parse: [Function: parse],
     sep: &#x27;/&#x27;,
     delimiter: &#x27;:&#x27;,
     win32: null,
     posix: [Circular] },
  vfile: [Function: VFile],
  delete: [Function: _delete],
  read: [Function: read] }
</code></pre></output></codecell></cell><cell startpos="331:1-5525" endpos="347:4-5948" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><span class="output">&gt; headings !collapse</span><ul class="attributes"></ul></span><pre><code class="js">return lit.utils
          .select
          .selectAll(&#x27;heading&#x27;, ast)
          .map( h =&gt; `${h.depth} ${h.data.id }`)
</code></pre></codecell><codecell class="dir-collapse lang-headings local collapsed output"><span class="meta"><span class="lang">headings</span><ul class="directives"><li style="color:black;background-color:#da5323"><span class="directive dir-collapse">collapse</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">6.3 days ago</span></span></span><output><pre><code class="headings">[ &#x27;1 executing-code-cells&#x27;,
  &#x27;2 table-of-contents&#x27;,
  &#x27;2 bugs--and-to-do-&#x27;,
  &#x27;2 examples&#x27;,
  &#x27;3 typescript&#x27;,
  &#x27;3 async-and-promises&#x27;,
  &#x27;3 react-jsx&#x27;,
  &#x27;3 output-markdown&#x27;,
  &#x27;3 meta-lit-global-and-ast&#x27; ]
</code></pre></output></codecell></cell><cell startpos="350:1-5951" endpos="364:4-6196" class="code"><codecell class="dir-inline lang-html local"><span class="meta"><span class="lang">html</span><ul class="directives"><li style="color:black;background-color:#b96da2"><span class="directive dir-inline">inline</span></li></ul><ul class="attributes"></ul></span><div><style>
codecell.collapsed.dir-collapse li span.dir-collapse {
  display: none;
}
codecell.dir-error pre {
  border: 2px solid red;
}

codecell.dir-error li span.dir-error {
  background-color: red;
  color: white;
}
</style>
</div></codecell></cell><cell startpos="366:1-6198" endpos="382:4-6488" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">
const b = document.body
const ch = b.clientHeight
const sh = b.scrollHeight
const st = b.scrollTop

const c = (ch/2)+st
const cp = c / sh

return {
   ch,sh,st,c,cp
}
</code></pre></codecell><codecell class="lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">5.4 days ago</span></span></span><output><pre><code class="txt">{ ch: 664, sh: 3475, st: 2811, c: 3143, cp: 0.9044604316546763 }
</code></pre></output></codecell></cell><cell startpos="383:1-6489" endpos="385:39-6544"><p>Trying out git</p><p>See more at <a href="testing/isomorphic_git.html?file=testing/isomorphic_git.lit" title="testing/Isomorphic Git" wikilink="true">testing/Isomorphic Git</a></p></cell><cell startpos="387:1-6546" endpos="395:4-6682" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">return (async args =&gt; {

  const git = (await 
  import(&#x27;https://cdn.skypack.dev/isomorphic-git&#x27;)).default

  return git 
})()
</code></pre></codecell></cell></section>
<section depth="2" class="" startpos="398:1-6685" endpos="452:4-8026"><cell startpos="398:1-6685" endpos="402:56-6813"><h2 id="what-if">What if...</h2><p><strong>REPLs</strong> were just custom viewers <a href="renderer/viewers.html?file=renderer/viewers.lit" title="renderer/viewers" wikilink="true">renderer/viewers</a>?</p><p>Implementing clientside execution via custom <code>!viewer</code>.</p></cell><section depth="3" class="" startpos="404:1-6815" endpos="452:4-8026"><cell startpos="404:1-6815" endpos="404:15-6829"><h3 id="first-pass">First pass</h3></cell><cell startpos="406:1-6831" endpos="433:4-7710" class="code"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><ul class="directives"><li style="color:black;background-color:#cf5332"><span class="directive dir-viewer">viewer</span></li></ul><ul class="attributes"><li style="color:black;background-color:#00dd70"><span class="attribute attr-of">of=esm</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rce = React.createElement
  const {useState, useEffect} = React
  const [resp, setResp] = useState(null)
  const [run, setRun] = useState(0)
  const exec = () =&gt; setRun(run+1)
  const exec2 = () =&gt; load(node.data.value)
  useEffect(async () =&gt; {
       async function load(src) {
          const val = `//run: ${run}\n${src}`
          const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
         if (typeof module.returns === &#x27;function&#x27;) setResp(await module.returns(run))
         else if (module.returns) setResp(module.returns)
      }

     try {
        load(node.data.value)
     } catch (err) {
        alert(err.message || err.toString())
     }
  }, [run])

  const btn = rce(&#x27;button&#x27;, {onClick: exec}, &quot;Run &quot; + run)
  const t = rce(&#x27;div&#x27;, null, [btn, resp])
  return t
}
</code></pre></codecell></cell><cell startpos="435:1-7712" endpos="441:4-7819" class="code"><codecell class="dir-below lang-esm2 local"><span class="meta"><span class="lang">esm2</span><ul class="directives"><li style="color:white;background-color:#5948c3"><span class="directive dir-below">below</span></li></ul><ul class="attributes"></ul></span><pre><code class="esm2">function foo(baz) {
  alert(&quot;foo II&quot;)
  return &quot;bar:&quot; + baz
}
export const returns = foo
</code></pre></codecell></cell><cell startpos="443:1-7821" endpos="452:4-8026" class="code"><codecell class="dir-below lang-js local"><span class="meta"><span class="lang">js</span><ul class="directives"><li style="color:white;background-color:#5948c3"><span class="directive dir-below">below</span></li></ul><ul class="attributes"><li style="color:black;background-color:#cf5332"><span class="attribute attr-viewer">viewer=esm2</span></li></ul></span><pre><code class="js">import confetti from &#x27;https://cdn.skypack.dev/canvas-confetti&#x27;

export const returns = run =&gt; confetti({
  origin: {y: 0},
  spread: 55,
  particleCount: 100,
  ticks: 1000,
})
</code></pre></codecell></cell></section></section>
<section depth="3" class="" startpos="454:1-8028" endpos="518:4-9642"><cell startpos="454:1-8028" endpos="456:72-8114"><h3 id="version-2">Version 2</h3><p>useEffect for execution on load otherwise require button press to exec.</p></cell><cell startpos="458:1-8116" endpos="488:4-8958" class="code"><codecell class="dir-viewer lang-js local"><span class="meta"><span class="lang">js</span><ul class="directives"><li style="color:black;background-color:#cf5332"><span class="directive dir-viewer">viewer</span></li></ul><ul class="attributes"><li style="color:black;background-color:#00dd70"><span class="attribute attr-of">of=esm2</span></li></ul></span><pre><code class="js">export const viewer = ({node, React}) =&gt; {
  const rce = React.createElement
  const {useState, useEffect} = React
  const [resp, setResp] = useState(null)
  const [run, setRun] = useState(0)
  
  const exec = ev =&gt; {
    ev &amp;&amp; ev.stopPropagation()
    setRun(run+1)
    load(node.data.value)
    return false
  }

  useEffect( args =&gt; {
    if(run===0 &amp;&amp; node.properties.meta.exec===&quot;onload&quot;)
       exec()
  },[])

  async function load(src) {
    const val = `//run: ${run}\n${src}`
    const module = await import(`data:text/javascript;base64,${ btoa(src)}`);
    if (typeof module.returns === &#x27;function&#x27;) setResp(await module.returns(run))
    else if (module.returns) setResp(module.returns)
  }

  const btn = rce(&#x27;button&#x27;, {onClick: exec}, &quot;Run &quot; + run)
  const t = rce(&#x27;div&#x27;, null, [btn, resp])
  return t
}
</code></pre></codecell></cell><cell startpos="490:1-8960" endpos="490:38-8997"><p>Setting <code>exec</code> attribute to <code>onload</code></p></cell><cell startpos="492:1-8999" endpos="498:4-9142" class="code"><codecell class="dir-below lang-esm2 local"><span class="meta"><span class="lang">esm2</span><ul class="directives"><li style="color:white;background-color:#5948c3"><span class="directive dir-below">below</span></li></ul><ul class="attributes"><li style="color:black;background-color:#02fb89"><span class="attribute attr-exec">exec=onload</span></li></ul></span><pre><code class="esm2">function output(num) {
  alert(&quot;execd onload!&quot;)
  return &quot;done: &quot; + new Date()
}
export const returns = output()
</code></pre></codecell></cell><cell startpos="501:1-9145" endpos="501:66-9210"><p>Cannot <em>yet</em> output raw DOM nodes, due to react setup of viewers.</p></cell><cell startpos="503:1-9212" endpos="510:4-9380" class="code"><codecell class="dir-below lang-esm2 local"><span class="meta"><span class="lang">esm2</span><ul class="directives"><li style="color:white;background-color:#5948c3"><span class="directive dir-below">below</span></li></ul><ul class="attributes"></ul></span><pre><code class="esm2">function output(num) {
  const dom = document.createElement(&quot;pre&quot;)
  dom.innerHTML = `Run number ${num}`
  return dom
}
export const returns = output
</code></pre></codecell></cell><cell startpos="512:1-9382" endpos="512:155-9536"><p>So far so good, the only issue is that output is entirely ephemeral, how would we enable document modification, ie persist the output as an attached cell.</p></cell><cell startpos="514:1-9538" endpos="518:4-9642" class="code"><codecell class="dir-below lang-esm2 local"><span class="meta"><span class="lang">esm2</span><ul class="directives"><li style="color:white;background-color:#5948c3"><span class="directive dir-below">below</span></li></ul><ul class="attributes"></ul></span><pre><code class="esm2">import git from &#x27;https://cdn.skypack.dev/isomorphic-git&#x27;

export const returns = git 
</code></pre></codecell></cell></section>
<section depth="3" class="" startpos="521:1-9645" endpos="558:4-10476"><cell startpos="521:1-9645" endpos="523:81-9752"><h3 id="module-from-string-ü•≤">Module from string ü•≤</h3><p>Instead of importing datauri for viewers and transformers use module constructor</p></cell><cell startpos="524:1-9753" endpos="536:4-9991" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">return module
</code></pre></codecell><codecell class="dir-error lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="directives"><li style="color:white;background-color:#5c4d28"><span class="directive dir-error">error</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">8.5 hours ago</span></span></span><output><pre><code class="txt">function toString() {
    [native code]
}
untitled.js:2:30
untitled.js:4:63
module code@untitled.js:4:139
evaluate@[native code]
moduleEvaluation@[native code]
</code></pre></output></codecell></cell><cell startpos="538:1-9993" endpos="558:4-10476" class="code"><codecell class="lang-js local"><span class="meta"><span class="lang">js</span><ul class="attributes"></ul></span><pre><code class="js">function requireFromString(src, filename) {
  var Module = module.constructor;
  var m = new Module();
  m._compile(src, filename);
  return m.exports;
}

console.log(requireFromString(&#x27;module.exports = { test: 1}&#x27;, &#x27;&#x27;));
</code></pre></codecell><codecell class="dir-error lang-txt local output"><span class="meta"><span class="lang">txt</span><ul class="directives"><li style="color:white;background-color:#5c4d28"><span class="directive dir-error">error</span></li></ul><ul class="attributes"></ul><span class="updatedAt">Updated <span class="Time relative">8.5 hours ago</span></span></span><output><pre><code class="txt">function toString() {
    [native code]
}
requireFromString@untitled.js:3:22
untitled.js:9:30
untitled.js:11:63
module code@untitled.js:11:139
evaluate@[native code]
moduleEvaluation@[native code]
</code></pre></output></codecell></cell></section></div></div><div id="backlinks"><h4>Backlinks (3)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li><li><a title="Title TBD (repl/index.lit)" href="/repl/index.html">Title TBD (repl/index.lit)</a></li><li><a title="Statch Pad" href="/scratch_pad.html">Statch Pad</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>