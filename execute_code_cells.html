<html data-reactroot=""><head><title>Executing code cells</title><meta name="litsrc" value="/execute_code_cells.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="/style.css"/></head><body><div id="lit-app"><div id="lit-header"><menu class="horizontal open has-children"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class="has-children" disabled=""><li class="MenuTitle">File</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Cell</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Section</li></menu><menu class="has-children" disabled=""><li class="MenuTitle">Help</li></menu><menu class="has-children right"><li class="MenuTitle"><span class="led led-grey"></span><span class="led led-grey"></span><span class="led led-grey"></span></li></menu></li></menu></div><style>body {
  --bg: white;
  --bg-secondary-color: #efefef;
    
  --text-color: black;
  --text-secondary-color: grey;
  --text-primary-color: #9999f7;
  --text-highlight-bg: yellow;
  --text-highlight-color: black;

  --divider-subtle: #efefef;
  --medium-space: 0.4em;
  --code-bg-color: black;
  --code-text-color: white;
  --box-bg-opacity: 0.05;
}</style><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/sunburst.min.css"/><div id="content"><section id="executing-code-cells" depth="1" class="" startpos="1:1-0" endpos="3:21-46"><div startpos="1:1-0" endpos="1:25-24" class="cell"><div class="cell-content"><h1>Executing <code>code</code> cells</h1></div></div><section id="table-of-contents" depth="2" class="" startpos="3:1-26" endpos="3:21-46"><div startpos="3:1-26" endpos="3:21-46" class="cell"><div class="cell-content"><h2>Table of Contents</h2><ul>
<li>
<p><a class="fragment" href="#bugs--and-to-do-" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#bugs--and-to-do-">Bugs üêú and To do ‚úÖ<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a class="fragment" href="#examples" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#examples">Examples<span class="linkIcon">¬ß</span></a></p>
<ul>
<li>
<p><a class="fragment" href="#async-and-promises" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#async-and-promises">Async and Promises<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a class="fragment" href="#transpiling" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#transpiling">Transpiling<span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a class="fragment" href="#react-jsx" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#react-jsx">React <code>jsx</code><span class="linkIcon">¬ß</span></a></p>
</li>
<li>
<p><a class="fragment" href="#outputs" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#outputs">Outputs<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a class="fragment" href="#raw-svg-string" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#raw-svg-string">Raw <code>svg</code> string<span class="linkIcon">¬ß</span></a></li>
<li><a class="fragment" href="#markdown" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#markdown">Markdown<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
<li>
<p><a class="fragment" href="#meta-lit-global-and-ast" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#meta-lit-global-and-ast">Meta: <code>lit</code> global and AST<span class="linkIcon">¬ß</span></a></p>
<ul>
<li><a class="fragment" href="#mutating-self" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#mutating-self">Mutating Self<span class="linkIcon">¬ß</span></a></li>
</ul>
</li>
<li>
<p><a class="fragment" href="#dynamic-imports" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="#dynamic-imports">Dynamic imports<span class="linkIcon">¬ß</span></a></p>
</li>
</ul>
</li>
</ul></div></div></section></section>
<section id="bugs--and-to-do-" depth="2" class="" startpos="5:2-49" endpos="10:47-241"><div startpos="5:2-49" endpos="10:47-241" class="cell"><div class="cell-content"><h2>Bugs üêú and To do ‚úÖ</h2><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <del>executed cell gets replaced with its output.</del></li>
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <!-- -->more robust outputs<!-- -->
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="" disabled=""/> <!-- -->replace &quot;connected&quot; output on exec</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Extract transpilation as <a class="local" href="transfomers.html" title="Transfomers" wikilink="true" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="/transfomers.lit">Transfomers</a></li>
</ul></div></div></section>
<section id="examples" depth="2" class="" startpos="12:1-243" endpos="83:4-1153"><div startpos="12:1-243" endpos="12:12-254" class="cell"><div class="cell-content"><h2>Examples</h2></div></div><div startpos="18:1-260" endpos="24:4-387" class="code   cell"><div class="cell-content"><div class="tag-example lang-js local codecell"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#b12511" class="tag">example</span></span><pre><code class="js">console.log(document.referrer)
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">58.9w ago</span></span></span><output><pre><code class="txt">https://dotlit.org/
undefined
</code></pre></output></div></div></div><div startpos="25:1-388" endpos="30:4-501" class="code   cell"><div class="cell-content"><div class="tag-example lang-js local codecell"><span class="meta"><span class="lang">js</span><span style="color:white;background-color:#b12511" class="tag">example</span></span><pre><code class="js">return new Object({foo: &quot;bar&quot;})
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">57.8w ago</span></span></span><output><pre><code class="txt">{ foo: &#x27;bar&#x27; }
</code></pre></output></div></div></div><section id="async-and-promises" depth="3" class="" startpos="48:1-519" endpos="83:4-1153"><div startpos="48:1-519" endpos="48:23-541" class="cell"><div class="cell-content"><h3>Async and Promises</h3></div></div><div startpos="50:1-543" endpos="63:4-808" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><a name="test.js"></a><span class="meta"><span class="lang">js</span><span class="filename">test.js</span></span><pre><code class="js">const wait = (ms) =&gt; {
  return new Promise(resolve =&gt; {
    setTimeout( () =&gt; {
      resolve(new Date())
    }, ms)
     
  })
}
return wait(1000)
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">58.3w ago</span></span></span><output><pre><code class="txt">Wed Apr 28 2021 23:44:37 GMT+0100 (BST)
</code></pre></output></div></div></div><div startpos="65:1-810" endpos="71:4-941" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return fetch(&#x27;https://example.com&#x27;)
       .then( res =&gt; res.status )
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">57.9w ago</span></span></span><output><pre><code class="txt">200
</code></pre></output></div></div></div><div startpos="73:1-943" endpos="83:4-1153" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return (async fn =&gt; {
    const size = await lit.fs.du(&#x27;/&#x27;)
    console.log(&quot;Local filesystem size:&quot;)
    return size
})()
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="txt">Local filesystem size:
423028
</code></pre></output></div></div></div></section></section>
<section id="transpiling" depth="3" class="" startpos="85:1-1155" endpos="101:4-1669"><div startpos="85:1-1155" endpos="87:246-1417" class="cell"><div class="cell-content"><h3>Transpiling</h3><p>The meta syntax for transformers/transpiling is not yet stable, for now use the experimental <code>babel</code> attribute, combined with specifying the source lang in the filename extention. (Currently requires explicitly setting <code>repl</code> to <code>js</code> to execute)</p></div></div><div startpos="89:1-1419" endpos="101:4-1669" class="code   cell"><div class="cell-content"><div class="lang-ts local codecell"><a name="test.ts"></a><span class="meta"><span class="lang">ts</span><span class="repl">js</span><span class="filename">test.ts</span></span><pre><code class="ts">type Options = {[key: number]: string}
const fn = (opts : Options) =&gt; {
  const str:string = 12 
  // need linting to make this useful
  return str
}

return fn()
</code></pre></div><div class="lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span class="updatedAt">Updated <span class="Time relative">59.2w ago</span></span></span><output><pre><code class="txt">12
</code></pre></output></div></div></div></section>
<section id="react-jsx" depth="3" class="" startpos="111:1-1679" endpos="143:4-2527"><div startpos="111:1-1679" endpos="113:217-1912" class="cell"><div class="cell-content"><h3>React <code>jsx</code></h3><p>Using the experimental <code>react</code> attribute, a <em>Cell</em> can define its own content as a component, warning due to needing to use the same React instance as the parent application, the below with dynamic import won&#x27;t work.</p></div></div><div startpos="115:1-1914" endpos="126:4-2141" class="code   cell"><div class="cell-content"><div class="lang-jsx local codecell"><a name="test.jsx"></a><span class="meta"><span class="lang">jsx</span><span class="repl">js</span><span class="filename">test.jsx</span></span><pre><code class="jsx">import React from &#x27;https://cdn.skypack.dev/react&#x27;

const Component = props =&gt; {
  return &lt;div&gt;&lt;/div&gt;
}

return &lt;Component/&gt;
</code></pre></div><div class="dir-error lang-txt local codecell output"><span class="meta"><span class="lang">txt</span><span style="color:white;background-color:red" class="directive dir-error">error</span><span class="updatedAt">Updated <span class="Time relative">57.8w ago</span></span></span><output><pre><code class="txt">undefined
</code></pre></output></div></div></div><div startpos="128:1-2143" endpos="128:57-2199" class="cell"><div class="cell-content"><p>Instead, get <code>React</code> from the utils in the <code>lit</code> global.</p></div></div><div startpos="130:1-2201" endpos="143:4-2527" class="code   cell"><div class="cell-content"><div class="lang-jsx local codecell"><a name="test.jsx"></a><span class="meta"><span class="lang">jsx</span><span class="repl">js</span><span class="filename">test.jsx</span></span><pre><code class="jsx">const React = lit.utils.React
const { useState } = React
  
const Clicker = props =&gt; {
    const [c,setC] = useState(0)
    //console.log(React, useState, c)
    const click = e =&gt; setC(c+1)

    return &lt;button onClick={click}&gt;{ &quot;Click me: &quot; + c}&lt;/button&gt;
}

return &lt;Clicker/&gt;
</code></pre></div></div></div></section>
<section id="outputs" depth="3" class="" startpos="163:1-2547" endpos="204:4-3808"><div startpos="163:1-2547" endpos="165:92-2651" class="cell"><div class="cell-content"><h3>Outputs</h3><p>See <a class="local" href="renderer/viewers.html" title="renderer/Viewers" wikilink="true" filepath="/execute_code_cells.lit" root="" data="[object Object]" canonical="/renderer/viewers.lit">renderer/Viewers</a> for information on built in viewers and how to create custom ones.</p></div></div><section id="raw-svg-string" depth="4" class="" startpos="167:1-2653" endpos="204:4-3808"><div startpos="167:1-2653" endpos="167:22-2674" class="cell"><div class="cell-content"><h4>Raw <code>svg</code> string</h4></div></div><div startpos="168:1-2675" endpos="204:4-3808" class="code   cell"><div class="cell-content"><div class="dir-collapse tag-current_viewport lang-js local collapsed codecell"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span style="color:white;background-color:#192884" class="tag">current_viewport</span><span class="output">&gt; svg</span></span><pre><code class="js">const b = document.body
const ch = b.clientHeight
const cw = b.clientWidth
const sh = b.scrollHeight
const st = b.scrollTop

const a = cw / ch 
const sa = cw / sh
const c = (ch/2)+st
const cp = c / sh

const h = cw
const w = h * sa
const vt = h * (st/sh)
const vw = w
const vh = h * (ch/sh)
const x = (h/2) - w


const svg = `&lt;svg style=&quot;max-width: 100%;&quot; width=&quot;${h}&quot; height=&quot;${h}&quot;&gt;
  &lt;rect x=&quot;${x}&quot; width=&quot;${w}&quot; height=&quot;${h}&quot; style=&quot;fill:rgb(255,255,255);stroke-width:1;stroke:rgb(0,0,0)&quot; /&gt;
  &lt;rect x=&quot;${x}&quot; y=&quot;${vt}&quot; width=&quot;${vw}&quot; height=&quot;${vh}&quot; style=&quot;fill:rgb(255,255,255);stroke-width:3;stroke:rgb(255,0,0)&quot; /&gt;
&lt;/svg&gt;`

return svg

return {
   ch,cw,sh,st,c,cp,a 
}
</code></pre></div><div class="lang-svg local codecell output"><span class="meta"><span class="lang">svg</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><div><svg style="max-width: 100%;" width="390" height="390">
  <rect x="166.8645948945616" width="28.1354051054384" height="390" style="fill:rgb(255,255,255);stroke-width:1;stroke:rgb(0,0,0)" />
  <rect x="166.8645948945616" y="153.51831298557158" width="28.1354051054384" height="47.9023307436182" style="fill:rgb(255,255,255);stroke-width:3;stroke:rgb(255,0,0)" />
</svg>
</div></div></div></div></section></section>
<section id="markdown" depth="4" class="" startpos="206:1-3810" endpos="228:4-4100"><div startpos="206:1-3810" endpos="206:14-3823" class="cell"><div class="cell-content"><h4>Markdown</h4></div></div><div startpos="208:1-3825" endpos="215:4-3991" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; md</span></span><pre><code class="js">console.log(&quot;A __*result*__: **`&quot; +  42/13 + &quot;`**&quot;)
return 42
</code></pre></div><div class="lang-md local codecell output"><span class="meta"><span class="lang">md</span><span class="updatedAt">Updated <span class="Time relative">59.3w ago</span></span></span><div class="md-block">
<p>A <strong><em>result</em></strong>: <strong><code>3.230769230769231</code></strong>
42</p>
</div></div></div></div><div startpos="223:1-3999" endpos="228:4-4100" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json</span></span><pre><code class="js">return { foo: &#x27;bar&#x27;}
</code></pre></div><div class="lang-json local codecell output"><span class="meta"><span class="lang">json</span><span class="updatedAt">Updated <span class="Time relative">59.3w ago</span></span></span><output><pre><code class="json">{ foo: &#x27;bar&#x27; }
</code></pre></output></div></div></div></section>
<section id="meta-lit-global-and-ast" depth="3" class="" startpos="237:1-4109" endpos="443:4-9514"><div startpos="237:1-4109" endpos="239:72-4212" class="cell"><div class="cell-content"><h3>Meta: <code>lit</code> global and AST</h3><p>When executing a <em>Cell</em> <code>this</code> refers to the <code>hast</code> node for that cell.</p></div></div><div startpos="265:1-4238" endpos="286:4-4803" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #this !collapse</span></span><pre><code class="js">return this
</code></pre></div><div class="dir-collapse tag-this lang-json local collapsed codecell output"><span class="meta"><span class="lang">json</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span style="color:white;background-color:#0364e9" class="tag">this</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="json">{ type: &#x27;element&#x27;,
  tagName: &#x27;cell&#x27;,
  properties: { class: &#x27;cell&#x27; },
  children: 
   [ { type: &#x27;element&#x27;,
       tagName: &#x27;pre&#x27;,
       properties: {},
       children: [Object],
       position: [Object] },
     { type: &#x27;element&#x27;,
       tagName: &#x27;pre&#x27;,
       properties: {},
       children: [Object],
       position: [Object] } ],
  position: 
   { start: { line: 265, column: 1, offset: 4245 },
     end: { line: 286, column: 4, offset: 4810 } } }
</code></pre></output></div></div></div><div startpos="287:1-4804" endpos="287:83-4886" class="cell"><div class="cell-content"><p>To get the <code>mdast</code> for the document, you need to refer to the global <code>lit</code> object.</p></div></div><div startpos="289:1-4888" endpos="295:4-5120" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #ast #position !collapse</span></span><pre><code class="js">return lit.ast.position
</code></pre></div><div class="dir-collapse tag-ast tag-position lang-json local collapsed codecell output"><span class="meta"><span class="lang">json</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span style="color:white;background-color:#017a82" class="tag">ast</span><span style="color:black;background-color:#2c9299" class="tag">position</span><span class="updatedAt">Updated <span class="Time relative">57.8w ago</span></span></span><output><pre><code class="json">{ start: { line: 1, column: 1, offset: 0 },
  end: { line: 588, column: 4, offset: 11517 } }
</code></pre></output></div></div></div><div startpos="302:1-5127" endpos="302:76-5202" class="cell"><div class="cell-content"><p>To get info about the location of the current document, see <code>lit.location</code>.</p></div></div><div startpos="304:1-5204" endpos="312:4-5421" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #location !collapse</span></span><pre><code class="js">return lit.location
</code></pre></div><div class="dir-collapse tag-location lang-json local collapsed codecell output"><span class="meta"><span class="lang">json</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span style="color:white;background-color:#714f9f" class="tag">location</span><span class="updatedAt">Updated <span class="Time relative">53.8w ago</span></span></span><output><pre><code class="json">{ src: &#x27;/execute_code_cells.lit&#x27;,
  root: &#x27;/&#x27;,
  base: &#x27;https://dotlit.org/&#x27;,
  query: {} }
</code></pre></output></div></div></div><div startpos="315:1-5424" endpos="387:4-7994" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #utils !collapse</span></span><pre><code class="js">return lit.utils
</code></pre></div><div class="dir-collapse tag-utils lang-json local collapsed codecell output"><span class="meta"><span class="lang">json</span><span style="color:black;background-color:#da5323" class="directive dir-collapse">collapse</span><span style="color:white;background-color:#6a710b" class="tag">utils</span><span class="updatedAt">Updated <span class="Time relative">57.8w ago</span></span></span><output><pre><code class="json">{ React: 
   { Fragment: {},
     StrictMode: {},
     Profiler: {},
     Suspense: {},
     Children: 
      { map: [Function: mapChildren],
        forEach: [Function: forEachChildren],
        count: [Function: countChildren],
        toArray: [Function: toArray],
        only: [Function: onlyChild] },
     Component: [Function: Component],
     PureComponent: [Function: PureComponent],
     __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED: 
      { ReactCurrentDispatcher: [Object],
        ReactCurrentBatchConfig: [Object],
        ReactCurrentOwner: [Object],
        IsSomeRendererActing: [Object],
        assign: [Function: assign],
        ReactDebugCurrentFrame: [Object] },
     cloneElement: [Function: cloneElementWithValidation],
     createContext: [Function: createContext],
     createElement: [Function: createElementWithValidation],
     createFactory: [Function: createFactoryWithValidation],
     createRef: [Function: createRef],
     forwardRef: [Function: forwardRef],
     isValidElement: [Function: isValidElement],
     lazy: [Function: lazy],
     memo: [Function: memo],
     useCallback: [Function: useCallback],
     useContext: [Function: useContext],
     useDebugValue: [Function: useDebugValue],
     useEffect: [Function: useEffect],
     useImperativeHandle: [Function: useImperativeHandle],
     useLayoutEffect: [Function: useLayoutEffect],
     useMemo: [Function: useMemo],
     useReducer: [Function: useReducer],
     useRef: [Function: useRef],
     useState: [Function: useState],
     version: &#x27;17.0.1&#x27; },
  unist: 
   { select: 
      { matches: [Function: matches],
        selectAll: [Function: selectAll],
        select: [Function: select] },
     source: [Function: source],
     filter: [Function: filter],
     visit: { [Function: visit] CONTINUE: true, SKIP: &#x27;skip&#x27;, EXIT: false },
     patchSource: { default: [Getter] } },
  path: 
   { resolve: [Function: resolve],
     normalize: [Function: normalize],
     isAbsolute: [Function: isAbsolute],
     join: [Function: join],
     relative: [Function: relative],
     _makeLong: [Function: _makeLong],
     dirname: [Function: dirname],
     basename: [Function: basename],
     extname: [Function: extname],
     format: [Function: format],
     parse: [Function: parse],
     sep: &#x27;/&#x27;,
     delimiter: &#x27;:&#x27;,
     win32: null,
     posix: [Circular] },
  vfile: [Function: VFile],
  delete: [Function: _delete],
  read: [Function: read] }
</code></pre></output></div></div></div><div startpos="390:1-7997" endpos="390:98-8094" class="cell"><div class="cell-content"><p>Finding nodes in the ast can be done either manually or using some of the <code>unist</code> utils available</p></div></div><div startpos="392:1-8096" endpos="395:4-8210" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #heading #title</span></span><pre><code class="js">const select = lit.utils.unist.select.select
return select(&#x27;heading&#x27;, lit.ast)   
</code></pre></div></div></div><div startpos="397:1-8212" endpos="402:4-8379" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #headings !collapse</span></span><pre><code class="js">return lit.utils
          .unist.select
          .selectAll(&#x27;heading&#x27;, lit.ast)
          .map( h =&gt; `${h.depth} ${h.data.id }`)
</code></pre></div></div></div><div startpos="404:1-8381" endpos="411:4-8623" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="output">&gt; json #sectiontitle !collapse</span></span><pre><code class="js">// get the title of the section containing the currently selected cell
// some utilities still need exposing to achieve this.
const currentPos = {}
const atPosTree = {}
const section = 
return &quot;TBD...&quot;
</code></pre></div></div></div><section id="mutating-self" depth="4" class="" startpos="414:1-8626" endpos="443:4-9514"><div startpos="414:1-8626" endpos="416:159-8804" class="cell"><div class="cell-content"><h4>Mutating Self</h4><p>Code cell execution which modifies the content of a <code>.lit</code> document outwith of its own (attached) output cell, initially itself, but then try an external doc.</p></div></div><div startpos="418:1-8806" endpos="420:4-8879" class="code   cell"><div class="cell-content"><div class="tag-mutateme lang-js local codecell"><span class="meta"><span class="lang">js</span><span style="color:black;background-color:#339883" class="tag">mutateme</span></span><pre><code class="js">// Mutated at Sun May 02 2021 12:59:07 GMT+0100 (BST)
</code></pre></div></div></div><div startpos="424:1-8883" endpos="443:4-9514" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span><span class="attribute attr-selfmutate" style="color:black;background-color:#e35f55">selfmutate=experimental</span></span><pre><code class="js">const src = lit.file.contents
const unist = lit.utils.unist

const select = unist.select.select
const source = unist.source
const patchSource = unist.patchSource.default

const selector = &#x27;code[meta=#mutateme]&#x27;
const node = select(selector, lit.ast)
const pos = node.position

const original = source(pos, src)
const newSrc = &quot;```js #mutateme\n// Mutated at &quot; + new Date() + &quot;\n```&quot;

return patchSource(src, pos, newSrc)
</code></pre></div><div class="dir-warn lang-md local codecell output"><span class="meta"><span class="lang">md</span><span style="color:white;background-color:#037928" class="directive dir-warn">warn</span><span class="updatedAt">Updated <span class="Time relative">57.8w ago</span></span></span><div class="md-block dir-warn">
<p>‚ö†Ô∏è This uses the <em>still</em> experimental <code>selfmutate</code> attribute, and affects content outside of it&#x27;s own attached output cell.</p>
</div></div></div></div></section></section>
<section id="dynamic-imports" depth="3" class="" startpos="445:1-9516" endpos="460:4-9790"><div startpos="445:1-9516" endpos="445:20-9535" class="cell"><div class="cell-content"><h3>Dynamic imports</h3></div></div><div startpos="446:1-9536" endpos="460:4-9790" class="code   cell"><div class="cell-content"><div class="lang-js local codecell"><span class="meta"><span class="lang">js</span></span><pre><code class="js">return (async args =&gt; {

  const confetti = await 
  import(&#x27;https://cdn.skypack.dev/canvas-confetti&#x27;)

  confetti.default({
     origin: {y: 0},
     spread: 55,
     particleCount: 100,
     ticks: 1000,
  })
  return &quot;Wait for it... ü•≥&quot;
})()
</code></pre></div></div></div></section></div></div><div id="backlinks"><h4>Backlinks (5)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li><li><a title="üîå Plugin system" href="/plugin_system.html">üîå Plugin system</a></li><li><a title="REPL" href="/repl/index.html">REPL</a></li><li><a title="REPLs" href="/repls.html">REPLs</a></li><li><a title="üî• Scratch ‚ö†Ô∏è Pad üî¨" href="/scratch_pad.html">üî• Scratch ‚ö†Ô∏è Pad üî¨</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script async="" src="/web.bundle.js"></script></body></html>