<html data-reactroot=""><head><title>client</title><meta name="litsrc" value="client/client.lit"/><meta name="litroot" value="/"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/railscasts.css"/><link rel="stylesheet" href="/style.css"/></head><body><div id="app"><div id="header"><menu class="horizontal open"><li class="MenuTitle"><a href="/">Home</a></li><li class="MenuItems"><menu class=""><li class="MenuTitle">File<span>›</span></li></menu><menu class=""><li class="MenuTitle">Cell<span>›</span></li></menu><menu class=""><li class="MenuTitle">Section<span>›</span></li></menu><menu class=""><li class="MenuTitle">Help<span>›</span></li></menu></li></menu></div><div id="content"><section name="client"><cell startpos="1:1-0" endpos="1:9-8"><h1 id="client">Client</h1></cell><cell startpos="3:1-10" endpos="97:4-2875" class="code"><codecell><span class="meta"><span class="lang">jsx</span><span class="source">&lt; index.jsx</span></span><pre><code class="jsx">const React = require(&#x27;react&#x27;)
const ReactDOM = require(&#x27;react-dom&#x27;)
const vfile = require(&#x27;vfile&#x27;)
const path = require(&#x27;path&#x27;)
const qs = require(&#x27;querystring-es3&#x27;)
const FS = require(&#x27;@isomorphic-git/lightning-fs&#x27;)
const select = require(&#x27;unist-util-select&#x27;)

const parser = require(&#x27;../parser&#x27;)
const renderer = require(&#x27;../renderer&#x27;)
const App = require(&#x27;../components/App&#x27;).default
const { Header } = require(&#x27;../components/Header&#x27;)
const { extendFs } = require(&#x27;../utils/fs-promises-utils&#x27;)

const { getMeta } = require(&#x27;../utils/functions&#x27;)
import { getConsoleForNamespace } from &#x27;../utils/console&#x27;

const console = getConsoleForNamespace(&#x27;client&#x27;)

const query = qs.parse(location.search.slice(1))
const litsrc = getMeta(&#x27;src&#x27;, &#x27;&#x27;)
const litroot = getMeta(&#x27;root&#x27;, &#x27;&#x27;)
const litbase = getMeta(&#x27;base&#x27;, &#x27;/&#x27;)
const baseUrl =`${location.protocol}//${location.host}${litroot ? path.join(path.dirname(location.pathname), litroot) : litbase}`

const lfs = (new FS(baseUrl)).promises 
const fs = extendFs(lfs, litroot)


const lit = {
    location: {
        src: litsrc,
        root: litroot,
        base: baseUrl,
        query: query,
    },
    parser,
    renderer,
    fs,
    utils: {
        select,
        path,
        vfile,
    }
}

if (typeof window !== &#x27;undefined&#x27;) window.lit = lit
console.log(&#x27;.lit Notebook client initializing...&#x27;)
console.log(`lit:`, lit)

;(async () =&gt; {
    let src = litsrc
    if (src === &#x27;404.lit&#x27; &amp;&amp; query.file) src = query.file
    console.log(`Checking local (${baseUrl}) filesystem for: ${src}`)
    let contents, file, stat;
    try { stat = await lit.fs.stat(&#x27;/&#x27; + src) } catch(err) {}
    if (stat) {
        console.log(`Local file &quot;${ &#x27;/&#x27; + src}&quot; exists, loading that instead.`, stat)
        contents = await lit.fs.readFile(&#x27;/&#x27; +  src, {encoding: &#x27;utf8&#x27;})
    } else {
        console.log(&quot;Fetching file content&quot;, litroot, litsrc, path.join(litroot, litsrc))
        const resp = await fetch(path.join(litroot, litsrc))
        console.log(&quot;Fetch resp&quot;, resp)
        contents = await resp.text()
    }
    console.log(contents)
    file = await vfile({path: src, contents})

    
    const processedFile = await renderer.processor(fs).process(file)
    console.log(&quot;Processed client&quot;, processedFile)
    window.lit.ast = processedFile.data.ast

    try {
        lit.notebook = &lt;App 
            fs={lit.fs}
            file={processedFile}
            result={processedFile.result}
        /&gt;
    } catch(err) {
        console.error(&quot;Error instantiating App&quot;, err)
    }
    console.log(&#x27;notebook&#x27;, window.lit.notebook)
    
    try {
        ReactDOM.hydrate(window.lit.notebook, document.getElementById(&#x27;app&#x27;))
        ReactDOM.hydrate(&lt;Header root={litroot} /&gt;, document.getElementById(&#x27;header&#x27;))
    } catch (err) {
        console.error(&quot;Error hydrating App&quot;, err)
    }

   
})()
</code></pre></codecell></cell></section></div></div><div id="backlinks"><h4>Backlinks (1)</h4><ol><li><a title=".lit" href="/index.html">.lit</a></li></ol></div><script src="//cdn.jsdelivr.net/npm/eruda"></script><script>eruda.init();</script><script src="/web.bundle.js"></script></body></html>